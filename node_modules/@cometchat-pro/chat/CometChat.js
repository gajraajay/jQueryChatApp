!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var s in n)("object"==typeof exports?exports:e)[s]=n[s]}}(window,function(){return function(n){var s={};function r(e){if(s[e])return s[e].exports;var t=s[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=n,r.c=s,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=36)}([function(e,t,n){"use strict";t.__esModule=!0;var s,r,o,i=n(4);t.constants={DEFAULT_STORE:"cometchat",MSG_VER_PRE:"store-ver-pre",MSG_VER_POST:"store-ver-post"},t.DEFAULT_VALUES={MSGS_LIMIT:30,MSGS_MAX_LIMIT:100,CALL_TIMEOUT:45,DEFAULT_MSG_ID:0,DEFAULT_MAX_TYPING_INDICATOR_LIMIT:5},(s=t.GroupType||(t.GroupType={})).Public="public",s.Private="private",s.Protected="protected",s.Password="password",t.GROUP_TYPE={PUBLIC:"public",PRIVATE:"private",PROTECTED:"password",PASSWORD:"password"},(r=t.GroupMemberScope||(t.GroupMemberScope={})).Admin="admin",r.Moderator="moderator",r.Member="member",t.GROUP_MEMBER_SCOPE={ADMIN:"admin",MODERATOR:"moderator",PARTICIPANT:"participant"},t.XMPP={host:"encke.cometchat.com",port:7443,bind_url:"/ws/",deafult_password:"CometChat",jid_string:"[%s]%s@%s/%s",bare_jid_string:"[%s]%s@%s",username_string:"[%s]%s",muc_jid_string:"[%s]%s@%s.%s",xmpp_resource:"javascripts_"+(new Date).getTime(),CONVERSATION:{TYPE:{CHAT:"chat",GROUP_CHAT:"groupchat"}}},t.LOCAL_STORE={COMMON_STORE:"common_store",MESSAGE_LISTENERS_LIST:"message_listeners_list",USERS_STORE:"users_store",MESSAGES_STORE:"messages_store",STORE_STRING:"%s:%s"},t.ResponseConstants={RESPONSE_KEYS:{KEY_DATA:"data",KEY_META:"meta",KEY_CURSOR:"cursor",KEY_ACTION:"action",KEY_MESSAGE:"message",KEY_ERROR:"error",KEY_ERROR_DETAILS:"details",KEY_ERROR_CODE:"code",KEY_ERROR_MESSAGE:"message",KEY_AUTH_TOKEN:"authToken",KEY_WS_CHANNEL:"wsChannel",KEY_IDENTITY:"identity",KEY_SERVICE:"identity",KEY_ENTITIES:"entities",KEY_ENTITITY:"entity",KEY_ATTACHMENTS:"attachments",CODE_REQUEST_OK:200,CODE_BAD_REQUEST:401}},t.DELIVERY_RECEIPTS={RECEIVER_ID:"receiverId",RECEIVER_TYPE:"type",RECIPIENT:"recipient",MESSAGE_ID:"messageId",RECEIVED:"delivered",DELIVERED_AT:"deliveredAt",ID:"id",TIME:"time"},t.READ_RECEIPTS={RECEIVER_ID:"receiverId",RECEIVER_TYPE:"type",RECIPIENT:"recipient",MESSAGE_ID:"messageId",READ:"read",READ_AT:"readAt",ID:"id",TIME:"time"},t.MessageConstatnts={XMPP_KEYS:{FROM:"from",TO:"to",TYPE:"type",TYPE_USER:"chat",TYPE_GROUP:"groupchat"},TYPE:{TEXT:"text",MEDIA:"media",IMAGE:"image",VIDEO:"video",AUDIO:"audio",FILE:"file",CUSTOM:"custom"},CATEGORY:{MESSAGE:"message",ACTION:"action",CALL:"call"},RECEIVER_TYPE:{USER:"user",GROUP:"group"},KEYS:{ATTATCHMENT:"attatchment",ATTATCHMENTS:"attachments",ACTION:"action",TYPE:"type",DATA:"data",ID:"id",MUID:"muid",SENDER:"sender",RECEIVER:"receiver",CATEGORY:"category",RECEIVER_TYPE:"receiverType",SENT_AT:"sentAt",STATUS:"status",TEXT:"text",URL:"url",METADATA:"metadata",RECEIPTS:"receipts",CUSTOM_DATA:"customData",CUSTOM_SUB_TYPE:"subType"},KNOWN_MEDIA_TYPE:{IMAGE:[],VIDEO:[],AUDIO:[],FILE:[]},PAGINATION:{AFFIX:{APPEND:"append",PREPEND:"prepend"},CURSOR_FILEDS:{ID:"id",SENT_AT:"sentAt"},CURSOR_AFFIX_DEFAULT:"prepend",CURSOR_FIELD_DEFAULT:"sentAt",KEYS:{PER_PAGE:"per_page",CURSOR_AFFIX:"cursorAffix",AFFIX:"affix",CURSOR_FIELD:"cursorField",CURSOR_VALUE:"cursorValue",UID:"uid",SENT_AT:"sentAt",ID:"id",CURRENT_PAGE:"page"}}},t.ATTACHMENTS_CONSTANTS={KEYS:{EXTENSION:"extension",MIME_TYPE:"mimeType",NAME:"name",SIZE:"size",URL:"url"}},(o=t.MessageCategory||(t.MessageCategory={})).ACTION="action",o.MESSAGE="message",o.CALL="call",t.TYPING_NOTIFICATION={RECEIVER_ID:"receiverId",RECEIVER_TYPE:"receiverType",META:"metadata",KEYS:{TYPING_NOTIFICATION:"typingNotification",TIMESTAMP:"timestamp"},ACTIONS:{STARTED:"started",ENDED:"ended"}},t.ActionConstatnts={ACTION_SUBJECTS:{ACTION_ON:"on",ACTION_BY:"by",ACTION_FOR:"for"},ACTION_ENTITY_TYPE:{GROUP_USER:"groupuser",USER:"user",GROUP:"group"},ACTION_KEYS:{ACTION_CREATED:"created",ACTION_UPDATED:"updated",ACTION_DELETED:"deleted",ENTITY:"entity",ENTITY_TYPE:"entityType",TYPE_MEMBER_JOINED:"joined",TYPE_MEMBER_LEFT:"left",TYPE_MEMBER_KICKED:"kicked",TYPE_MEMBER_BANNED:"banned",TYPE_MEMBER_UNBANNED:"unbanned",TYPE_MEMBER_INVITED:"invited",ACTION_SCOPE_CHANGED:"scopeChanged",ACTION_TYPE_USER:"user",ACTION_TYPE_GROUP:"group",ACTION_TYPE_GROUP_MEMBER:"groupMember",ACTION_TYPE_CALL:"call"},ActionMessages:{ACTION_GROUP_JOINED_MESSAGE:"%s joined %s",ACTION_GROUP_LEFT_MESSAGE:"%s left %s",ACTION_MEMBER_KICKED_MESSAGE:"%s kicked %s from %s",ACTION_MEMBER_BANNED_MESSAGE:"%s banned %s from %s",ACTION_MEMBER_UNBANNED_MESSAGE:"%s unbanned %s from %s",ACTION_MEMBER_INVITED_MESSAGE:"%s banned %s from %s"},ACTION_TYPE:{TYPE_MEMBER_JOINED:"joined",TYPE_MEMBER_LEFT:"left",TYPE_MEMBER_KICKED:"kicked",TYPE_MEMBER_BANNED:"banned",TYPE_MEMBER_UNBANNED:"unbanned",TYPE_MEMBER_INVITED:"invited",TYPE_MEMBER_SCOPE_CHANGED:"scopeChanged"},ACTIONS:{MEMBER_JOINED:"joined",MEMBER_LEFT:"left",MEMBER_KICKED:"kicked",MEMBER_BANNED:"banned",MEMBER_UNBANNED:"unbanned",MEMBER_INVITED:"invited",MEMBER_SCOPE_CHANGED:"scopeChanged"}},t.CallConstants={CALL_TYPE_AUDIO:"audio",CALL_TYPE_VIDEO:"video",CALL_TYPE:{AUDIO:"audio",VIDEO:"video"},RECEIVER_TYPE_GROUP:"group",RECEIVER_TYPE_USER:"user",CALL_KEYS:{CALL_DATA:"data",CALL_ID:"id",CALL_SESSION_ID:"sessionid",CALL_RECEIVER:"receiver",CALL_SENDER:"sender",CALL_RECEIVER_TYPE:"receiverType",CALL_STATUS:"status",CALL_TYPE:"type",CALL_INITIATED_AT:"initiatedAt",CALL_JOINED_AT:"joinedAt",CALL_LEFT_AT:"leftAt",CALL_METADATA:"metadata",CALL_ENTITIES:"entities",CALL_ENTITY_TYPE:"entityType",CALL_ENTITY:"entity",CALL_ENTITY_USER:"user",CALL_ENTITY_GROUP:"group"},CALL_STATUS:{INITIATED:"initiated",ONGOING:"ongoing",UNANSWERED:"unanswered",REJECTED:"rejected",BUSY:"busy",CANCELLED:"cancelled",ENDED:"ended"}},t.GroupConstants={KEYS:{NAME:"name",GUID:"guid",TYPE:"type",PASSWORD:"password",ICON:"icon",DESCRIPTION:"description",OWNER:"owner",METADATA:"metadata",CREATED_AT:"createdAt",UPDATED_AT:"updatedAt",HAS_JOINED:"hasJoined",WS_CHANNEL:"wsChannel"}},t.GroupMemersConstans={KEYS:{SCOPE:"scope",UID:"uid",GUID:"guid",USER:"user"}},t.UserConstants={UID:"uid",NAME:"name",AUTH_TOKEN:"authToken",AVATAR:"avatar",CREDITS:"credits",EMAIL:"email",LAST_ACTIVE_AT:"lastActiveAt",LINK:"link",META_DATA:"metaData",ROLE:"role",STATUS:"status",STATUS_MESSAGE:"statusMessage",USER_NAME:"user_name"},t.Errors={ERROR_IO_EXCEPTION:"ERROR_IO_EXCEPTION",ERROR_JSON_EXCEPTION:"ERROR_JSON_EXCEPTION",ERROR_PASSWORD_MISSING:"ERROR_PASSWORD_MISSING",ERROR_LIMIT_EXCEEDED:"ERROR_LIMIT_EXCEEDED",ERROR_USER_NOT_LOGGED_IN:"ERROR_USER_NOT_LOGGED_IN",ERROR_INVALID_GUID:"ERROR_INVALID_GUID",ERROR_PASSWORD_MISSING_MESSAGE:"Password is mandatory for a password group",ERROR_LIMIT_EXCEEDED_MESSAGE:"Limit Exceeded Max limit of %s",ERROR_USER_NOT_LOGGED_IN_MESSAGE:"Please log in to CometChat before calling this method",ERROR_INVALID_GUID_MESSAGE:"Please provide a valid GUID",ERROR_DEFAULT_MESSAGE:"Something went wrong"},t.CALL_ERROR={CALL_ALREADY_INITIATED:{code:"CALL_ALREADY_INITIATED",name:"CALL_ALREADY_INITIATED",message:"There is already call in progress",details:{}},ERROR_IN_CALLING:{code:"CALL_IN_PROGRESS",name:"CALL_ALREADY_INITIATED",message:"There is already call in progress",details:{}}},t.PARAMETER_ERROR={PARAMETER_REQUIRED:{code:"%s_NOT_PROVIDED",name:"%s_NOT_PROVIDED",message:"please provide the %s",details:{}}},t.GroupErrors={NOT_A_GROUP:new i.CometChatException({code:"NOT_A_GROUP",message:"Please use group class to construct a new group"})},t.PresenceConstatnts={XMPP_KEYS:{FROM:"from",STATUS:"status",LAST_ACTIVE_AT:"lastActiveAt",TYPE:"type"},STATUS:{ONLINE:"online",OFFLINE:"offline",JOINED:"JOINED",LEFT:"LEFT"}},t.APP_SETTINGS={APP_SETTINGS:"app_settings",KEYS:{CHAT_HOST:"CHAT_HOST",CHAT_USE_SSL:"CHAT_USE_SSL",GROUP_SERVICE:"GROUP_SERVICE",CALL_SERVICE:"CALL_SERVICE",CHAT_WS_PORT:"CHAT_WS_PORT",CHAT_WSS_PORT:"CHAT_WSS_PORT",CHAT_HTTP_BIND_PORT:"CHAT_HTTP_BIND_PORT",CHAT_HTTPS_BIND_PORT:"CHAT_HTTPS_BIND_PORT",ADMIN_API_HOST:"ADMIN_API_HOST",CLIENT_API_HOST:"CLIENT_API_HOST",WEBRTC_HOST:"WEBRTC_HOST",WEBRTC_USE_SSL:"WEBRTC_USE_SSL",WEBRTC_WS_PORT:"WEBRTC_WS_PORT",WEBRTC_WSS_PORT:"WEBRTC_WSS_PORT",WEBRTC_HTTP_BIND_PORT:"WEBRTC_HTTP_BIND_PORT",WEBRTC_HTTPS_BIND_PORT:"WEBRTC_HTTPS_BIND_PORT"}}},function(e,t,n){"use strict";t.__esModule=!0;var s=n(6),r=n(0),o=n(5),i=n(4);function a(e){return null!=e&&("string"==typeof e&&(e=e.trim()),"object"==typeof e&&0===Object.keys(e).length&&(e=void 0)),["",0,"0",!1,null,"null",void 0,"undefined"].includes(e)}t.isObject=function(e){return e instanceof Object&&e.constructor===Object},t.isTruthy=function(e){return[!0,1,"1","true","TRUE"].includes(e)},t.isFalsy=a,t.getOrdinalSuffix=function(e){var t=e%10,n=e%100;return 1==t&&11!=n?e+"st":2==t&&12!=n?e+"nd":3==t&&13!=n?e+"rd":e+"th"},t.format=function(e){for(var s=[],t=1;t<arguments.length;t++)s[t-1]=arguments[t];return e.split("%s").reduce(function(e,t,n){return e+t+(s[n]||"")},"")},t.createUidFromJid=function(e){return e.substring(e.lastIndexOf("]")+1,e.lastIndexOf("@"))};var u=function(){function e(){}return e.log=function(e,t){},e.error=function(e,t){},e.info=function(e,t){},e}();function c(){return new Promise(function(t,n){o.makeApiCall("appSettings").then(function(e){s.LocalStorage.getInstance().set("app_settings",e.data),t(e.data)},function(e){n(new i.CometChatException(e.error))})})}t.Logger=u,t.getCurrentTime=function(){return(new Date).getTime()},t.getAppSettings=function(){return new Promise(function(t,n){s.LocalStorage.getInstance().get(r.APP_SETTINGS.APP_SETTINGS).then(function(e){a(e)?c().then(function(e){t(e)},function(e){n(e)}):t(e)},function(e){n(e)})})},t.getUpdatedSettings=c,t.isImage=function(e){var t;return e.type&&e.type.toLowerCase().includes("image")&&(t=!0),t},t.isVideo=function(e){var t;return e.type&&e.type.toLowerCase().includes("video")&&(t=!0),t},t.isAudio=function(e){var t;return e.type&&e.type.toLowerCase().includes("audio")&&(t=!0),t}},function(e,t,n){"use strict";var d=this&&this.__assign||function(){return(d=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},s=this&&this.__awaiter||function(o,i,a,u){return new(a||(a=Promise))(function(e,t){function n(e){try{r(u.next(e))}catch(e){t(e)}}function s(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,s)}r((u=u.apply(o,i||[])).next())})},r=this&&this.__generator||function(n,s){var r,o,i,e,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=s.call(n,a)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};t.__esModule=!0;var o=n(18),l=n(1),h=n(4),p=n(5),a=n(3),u=n(7),c=n(10),f=n(6),g=n(20),E=n(19),_=n(11),C=n(9),S=n(23),m=n(0),T=n(16),A=n(24),I=n(25),y=n(14),R=n(17),M=n(21),v=n(26),N=n(15),O=n(31),P=n(32),L=n(34),b=n(35),w=n(22),D=n(29),Y=n(30),U=n(27),G=n(33),x=u.XMPPConnectionHelper.getInstance(),i=function(){function i(e){"undefined"!=typeof document||"undefined"!=typeof navigator&&navigator.product,i.typingTimer(),i.appId=e,i.messagesStore=C.MessagesStore.getInstance(),i.localStorage=f.LocalStorage.getInstance(),i.userStore=I.UserStore.getInstance(),i.messageListnerMaping=w.MessageListnerMaping.getInstance()}return i.setAuthToken=function(e){i.authToken=e},i.prototype.getAuthToken=function(){return i.authToken},i.getAppId=function(){return i.appId},i.prototype.getApiKey=function(){return i.apiKey},i.init=function(n){var s=this;return void 0===n&&(n=""),new Promise(function(e,t){"object"==typeof n&&n.hasOwnProperty("appId")&&(n=n.appId),l.isFalsy(n)?t(new h.CometChatException(v.INIT_ERROR.NO_APP_ID)):(s.initialzed=!0,s.getInstance(n)),e()})},i.isInitialized=function(){return this.initialzed},i.getInstance=function(e){return this.cometChat||(this.cometChat=new i(e)),this.cometChat},i.login=function(){for(var r=this,o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];if("object"==typeof o[0]){var t=o[0];o[0].hasOwnProperty("authToken")?o[0]=t.authToken:o[0].hasOwnProperty("username")&&o[0].hasOwnProperty("apiKey")&&(o[0]=t.username,o[1]=t.apiKey)}return new Promise(function(n,s){if(2==o.length?(l.isFalsy(o[0])||l.isFalsy(o[1]))&&s(new h.CometChatException(v.ERRORS.PARAMETER_MISSING)):1==o.length?l.isFalsy(o[0])&&s(new h.CometChatException(v.ERRORS.PARAMETER_MISSING)):s(new h.CometChatException(v.ERRORS.PARAMETER_MISSING)),!l.isFalsy(r.getAppId()))return i.localStorage.get("user").then(function(t){if(2!=o.length)return i.authToken=o[0],i.isSecure=!0,r.getLoggedinUser().then(function(e){null!=t&&t.uid!==e.uid?i.messagesStore.clearStore().then(function(){i.userStore.clearStore().then(function(){i.localStorage.clearStore().then(function(){(i.user=new a.Me(e)).setAuthToken(o[0]),i.setAuthToken(o[0]),i.XMPPLogin(i.user,n,s)})})}):(r.user=new a.Me(e),r.user.setAuthToken(o[0]),r.setAuthToken(o[0]),r.XMPPLogin(r.user,n,s))},function(e){s(new h.CometChatException(e.error))});i.isSecure=!1,i.apiKey=o[1];var e=o[0];null!=t&&t.uid!==o[0]?r.messagesStore.clearStore().then(function(){i.userStore.clearStore().then(function(){i.localStorage.clearStore().then(function(){i.generateAuthToken(e).then(function(e){i.user=new a.Me(e),i.setAuthToken(i.user.getAuthToken()),i.getLoggedinUser().then(function(e){(i.user=new a.Me(e)).setAuthToken(i.authToken),i.setAuthToken(i.user.getAuthToken()),i.XMPPLogin(i.user,n,s)},function(e){s(new h.CometChatException(e.error))})},function(e){s(new h.CometChatException(e))})})})}):l.isFalsy(i.authToken)?l.isFalsy(e)||(l.isFalsy(i.apiKey)?s(new h.CometChatException(v.LOGIN_ERROR.UNAUTHORISED)):r.generateAuthToken(e).then(function(e){r.user=new a.Me(e),r.setAuthToken(i.user.getAuthToken()),r.getLoggedinUser().then(function(e){r.user=new a.Me(e),r.user.setAuthToken(i.authToken),r.setAuthToken(r.user.getAuthToken()),r.XMPPLogin(r.user,n,s)},function(e){s(new h.CometChatException(e.error))})},function(e){s(new h.CometChatException(e))})):r.XMPPLogin(r.user,n,s)});s(new h.CometChatException(v.LOGIN_ERROR.NOT_INITIALIZED))})},i.sendMessage=function(e){var s=this;if(!(e instanceof E.TextMessage||e instanceof g.MediaMessage||e instanceof U.CustomMessage))if(e[m.MessageConstatnts.KEYS.ATTATCHMENT]){var t=m.MessageConstatnts.TYPE.FILE;l.isImage(e[m.MessageConstatnts.KEYS.ATTATCHMENT])?t=m.MessageConstatnts.TYPE.IMAGE:l.isAudio(e[m.MessageConstatnts.KEYS.ATTATCHMENT])?t=m.MessageConstatnts.TYPE.AUDIO:l.isVideo(e[m.MessageConstatnts.KEYS.ATTATCHMENT])&&(t=m.MessageConstatnts.TYPE.VIDEO),e=new g.MediaMessage(e[m.MessageConstatnts.KEYS.RECEIVER],e[m.MessageConstatnts.KEYS.ATTATCHMENT],t,e[m.MessageConstatnts.KEYS.RECEIVER_TYPE])}else e=new E.TextMessage(e[m.MessageConstatnts.KEYS.RECEIVER],e[m.MessageConstatnts.KEYS.TEXT],m.MessageConstatnts.TYPE.TEXT,e[m.MessageConstatnts.KEYS.RECEIVER_TYPE]);return new Promise(function(t,n){return p.makeApiCall("sendMessage",{},e,e instanceof g.MediaMessage).then(function(e){s.messagesStore.storeMessages([_.MessageController.trasformJSONMessge(e.data)]),t(_.MessageController.trasformJSONMessge(e.data))},function(e){n(new h.CometChatException(e.error))})})},i.sendDirectMessage=function(e){return Object.assign(e,{receiverType:m.MessageConstatnts.RECEIVER_TYPE.USER}),this.sendMessage(e)},i.sendGroupMessage=function(e){return Object.assign(e,{receiverType:m.MessageConstatnts.RECEIVER_TYPE.GROUP}),this.sendMessage(e)},i.sendMediaMessage=function(e){return this.sendMessage(e)},i.sendCustomMessage=function(e){return this.sendMessage(e)},i.getLastDeliveredMessageId=function(e){return s(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,w.MessageListnerMaping.getInstance().get("all")];case 1:return[2,e.sent()]}})})},i.startTyping=function(e){if(!l.isFalsy(e)){var t,n=this.RECEIVER_TYPE.USER,s={};if(e instanceof D.TypingIndicator)t=e.getReceiverId(),n=e.getReceiverType(),s=e.getMetadata();else{if(!e.hasOwnProperty(m.TYPING_NOTIFICATION.RECEIVER_ID))return;t=e[m.TYPING_NOTIFICATION.RECEIVER_ID],e.hasOwnProperty(m.TYPING_NOTIFICATION.RECEIVER_TYPE)&&(n=e[m.TYPING_NOTIFICATION.RECEIVER_TYPE]),e.hasOwnProperty(m.TYPING_NOTIFICATION.META)&&(s=e[m.TYPING_NOTIFICATION.META])}l.isFalsy(t)||(n=n==this.RECEIVER_TYPE.USER?m.XMPP.CONVERSATION.TYPE.CHAT:m.XMPP.CONVERSATION.TYPE.GROUP_CHAT,(Y.TypingNotificationController.getTypingStartedMap(t)&&l.getCurrentTime()-Y.TypingNotificationController.getTypingStartedMap(t)>=1e3*m.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT||null==Y.TypingNotificationController.getTypingStartedMap(t))&&l.getAppSettings().then(function(e){switch(n){case m.XMPP.CONVERSATION.TYPE.CHAT:x.sendTypingStarted(l.format(m.XMPP.bare_jid_string,i.getAppId(),t,e[m.APP_SETTINGS.KEYS.CHAT_HOST]),n,s);break;case m.XMPP.CONVERSATION.TYPE.GROUP_CHAT:x.sendTypingStarted(l.format(m.XMPP.muc_jid_string,i.getAppId(),t,e[m.APP_SETTINGS.KEYS.GROUP_SERVICE],e[m.APP_SETTINGS.KEYS.CHAT_HOST]),n,s)}Y.TypingNotificationController.addTypingStarted(t)},function(e){}))}},i.endTyping=function(e){if(!l.isFalsy(e)){var t,n=this.RECEIVER_TYPE.USER,s={};if(e instanceof D.TypingIndicator)t=e.getReceiverId(),n=e.getReceiverType(),s=e.getMetadata();else{if(!e.hasOwnProperty(m.TYPING_NOTIFICATION.RECEIVER_ID))return;t=e[m.TYPING_NOTIFICATION.RECEIVER_ID],e.hasOwnProperty(m.TYPING_NOTIFICATION.RECEIVER_TYPE)&&(n=e[m.TYPING_NOTIFICATION.RECEIVER_TYPE]),n=n==this.RECEIVER_TYPE.USER?m.XMPP.CONVERSATION.TYPE.CHAT:m.XMPP.CONVERSATION.TYPE.GROUP_CHAT,e.hasOwnProperty(m.TYPING_NOTIFICATION.META)&&(s=e[m.TYPING_NOTIFICATION.META])}if(l.isFalsy(t))return;Y.TypingNotificationController.getTypingStartedMap(t)&&l.getCurrentTime()-Y.TypingNotificationController.getTypingStartedMap(t)<1e3*m.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&(Y.TypingNotificationController.getTypingEndedMap(t)&&l.getCurrentTime()-Y.TypingNotificationController.getTypingEndedMap(t)>=1e3*m.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT||null==Y.TypingNotificationController.getTypingEndedMap(t))&&l.getAppSettings().then(function(e){switch(n){case m.XMPP.CONVERSATION.TYPE.CHAT:x.sendTypingPaused(l.format(m.XMPP.bare_jid_string,i.getAppId(),t,e[m.APP_SETTINGS.KEYS.CHAT_HOST]),n,s);break;case m.XMPP.CONVERSATION.TYPE.GROUP_CHAT:x.sendTypingPaused(l.format(m.XMPP.muc_jid_string,i.getAppId(),t,e[m.APP_SETTINGS.KEYS.GROUP_SERVICE],e[m.APP_SETTINGS.KEYS.CHAT_HOST]),n,s)}Y.TypingNotificationController.addTypingEnded(t)},function(e){})}},i.markMessageAsRead=function(e){var t;e instanceof Object?(e.hasOwnProperty(m.READ_RECEIPTS.RECEIVER_ID)&&e.hasOwnProperty(m.MessageConstatnts.KEYS.RECEIVER_TYPE)&&t[m.MessageConstatnts.KEYS.RECEIVER_TYPE],e.hasOwnProperty(m.READ_RECEIPTS.MESSAGE_ID)&&e[m.READ_RECEIPTS.MESSAGE_ID],t=e[m.READ_RECEIPTS.RECEIVER_ID]):e=_.MessageController.trasformJSONMessge(e),e.getId(),e.getSender().getUid(),e.getReceiver(),e.getReceiverType(),u.XMPPConnectionHelper.getInstance().markAsRead(e.getSender().getUid(),e.getReceiverType(),e.getId().toString(),e.getReceiver())},i.getMessageDetails=function(e){return p.makeApiCall("getMessageDetails",{messageId:e}).then(function(e){},function(e){})},i.getPreviousMessagesByTimestamp=function(e,s){return new Promise(function(t,n){l.isFalsy(s)?n(new h.CometChatException(JSON.parse(l.format(JSON.stringify(m.PARAMETER_ERROR.PARAMETER_REQUIRED),"TIMESTAMP","TIMESTAMP","timestamp")))):_.MessageController.getAllMessage(e,s,m.MessageConstatnts.PAGINATION.CURSOR_FILEDS.SENT_AT,m.MessageConstatnts.PAGINATION.AFFIX.PREPEND).then(function(e){return t(e)},function(e){return n(e)})})},i.getPreviousMessagesById=function(e,s){return new Promise(function(t,n){l.isFalsy(s)?n(new h.CometChatException(JSON.parse(l.format(JSON.stringify(m.PARAMETER_ERROR.PARAMETER_REQUIRED),"ID","ID","id")))):_.MessageController.getAllMessage(e,s,m.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,m.MessageConstatnts.PAGINATION.AFFIX.PREPEND).then(function(e){return t(e)},function(e){return n(e)})})},i.getNextMessagesByTimestamp=function(e,s){return new Promise(function(t,n){l.isFalsy(s)?n(new h.CometChatException(JSON.parse(l.format(JSON.stringify(m.PARAMETER_ERROR.PARAMETER_REQUIRED),"TIMESTAMP","TIMESTAMP","timestamp")))):_.MessageController.getAllMessage(e,s,m.MessageConstatnts.PAGINATION.CURSOR_FILEDS.SENT_AT,m.MessageConstatnts.PAGINATION.AFFIX.APPEND).then(function(e){return t(e)},function(e){return n(e)})})},i.getNextMessagesById=function(e,s){return new Promise(function(t,n){l.isFalsy(s)?n(new h.CometChatException(JSON.parse(l.format(JSON.stringify(m.PARAMETER_ERROR.PARAMETER_REQUIRED),"ID","ID","id")))):_.MessageController.getAllMessage(e,s,m.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,m.MessageConstatnts.PAGINATION.AFFIX.APPEND).then(function(e){return t(e)},function(e){return n(e)})})},i.getUser=function(e){return new Promise(function(r,t){"object"==typeof e&&e.hasOwnProperty("uid")&&(e=e.uid),p.makeApiCall("user",{uid:e}).then(function(e){var s=S.UsersController.trasformJSONUser(e.data),t=[];t.push(l.format(m.XMPP.username_string,i.getAppId(),e.data[m.UserConstants.UID])),u.XMPPConnectionHelper.getInstance().getPresenceInfo(t,function(n){t.map(function(e,t){s.setLastActiveAt(n[t].getLastActiveAt()),s.setStatus(n[t].getStatus()),r(s)})})}).catch(function(e){t(new h.CometChatException(e.error))})})},i.getLoggedinUser=function(){return new Promise(function(t,n){p.makeApiCall("getMyDetails").then(function(e){t(e.data)}).catch(function(e){n(e)})})},i.createGroup=function(s){return new Promise(function(t,n){if(!(s instanceof T.Group)){var e=void 0;if(!s.hasOwnProperty(m.GroupConstants.KEYS.GUID))return void n(new h.CometChatException(v.ERRORS.PARAMETER_MISSING));if(!s.hasOwnProperty(m.GroupConstants.KEYS.NAME))return void n(new h.CometChatException(v.ERRORS.PARAMETER_MISSING));if(e=new T.Group(s[m.GroupConstants.KEYS.GUID],s[m.GroupConstants.KEYS.NAME],""),s.hasOwnProperty(m.GroupConstants.KEYS.TYPE))if(s[m.GroupConstants.KEYS.TYPE].toLocaleLowerCase()==m.GroupType.Password){if(!s.hasOwnProperty(m.GroupConstants.KEYS.PASSWORD))return void n(new h.CometChatException(v.GROUP_CREATION_ERRORS.EMPTY_PASSWORD));e.setType(m.GROUP_TYPE.PASSWORD),e.setPassword(s[m.GroupConstants.KEYS.PASSWORD])}else e.setType(s[m.GroupConstants.KEYS.TYPE]);else e.setType(m.GROUP_TYPE.PUBLIC);s.hasOwnProperty(m.GroupConstants.KEYS.ICON)&&e.setIcon(s[m.GroupConstants.KEYS.ICON]),s.hasOwnProperty(m.GroupConstants.KEYS.DESCRIPTION)&&e.setDescription(s[m.GroupConstants.KEYS.DESCRIPTION]),s=e}p.makeApiCall("createGroup",{},s).then(function(e){x.joinMuc(s),A.GroupsController.trasformJSONGroup(e.data).setHasJoined(!0),t(A.GroupsController.trasformJSONGroup(e.data))},function(e){n(new h.CometChatException(e.error))})})},i.getGroup=function(e){return"object"==typeof e&&e.hasOwnProperty("guid")&&(e=e.guid),new Promise(function(t,n){p.makeApiCall("getGroup",{guid:e}).then(function(e){t(A.GroupsController.trasformJSONGroup(e.data))},function(e){n(new h.CometChatException(e.error))})})},i.joinGroup=function(e,r,o){return void 0===r&&(r=m.GroupType.Public),void 0===o&&(o=""),new Promise(function(n,t){var s;"object"==typeof e&&(e.hasOwnProperty(m.GroupConstants.KEYS.GUID)?(e.hasOwnProperty(m.GroupConstants.KEYS.TYPE)&&(r=e[m.GroupConstants.KEYS.TYPE],e[m.GroupConstants.KEYS.TYPE].toLocaleLowerCase()===m.GroupType.Password&&e.hasOwnProperty(m.GroupConstants.KEYS.PASSWORD)&&(o=e[m.GroupConstants.KEYS.PASSWORD])),e=e[m.GroupConstants.KEYS.GUID]):t(new h.CometChatException(v.ERRORS.PARAMETER_MISSING))),s=l.isFalsy(o)?new T.Group(e,"name",r):new T.Group(e,"name",r,o),p.makeApiCall("joinGroup",s,s).then(function(e){x.joinMuc(s);var t=A.GroupsController.trasformJSONGroup(e.data[m.ResponseConstants.RESPONSE_KEYS.KEY_DATA][m.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][m.ActionConstatnts.ACTION_KEYS.ENTITY]);t.setHasJoined(!0),n(t)},function(e){t(new h.CometChatException(e.error))})})},i.updateGroup=function(s){return new Promise(function(t,n){if(!(s instanceof T.Group)){var e=void 0;if(!s.hasOwnProperty(m.GroupConstants.KEYS.GUID))return void n(new h.CometChatException(v.ERRORS.PARAMETER_MISSING));e=new T.Group(m.GroupConstants.KEYS.GUID,"",""),s.hasOwnProperty(m.GroupConstants.KEYS.TYPE)?e.setType(s[m.GroupConstants.KEYS.TYPE]):(s[m.GroupConstants.KEYS.TYPE]=m.GROUP_TYPE.PUBLIC,e.setType[m.GROUP_TYPE.PUBLIC]),s.hasOwnProperty(m.GroupConstants.KEYS.NAME)&&e.setName(s[m.GroupConstants.KEYS.NAME]),s.hasOwnProperty(m.GroupConstants.KEYS.ICON)&&e.setIcon(s[m.GroupConstants.KEYS.ICON]),s.hasOwnProperty(m.GroupConstants.KEYS.DESCRIPTION)&&e.setDescription(s[m.GroupConstants.KEYS.DESCRIPTION]),s=e}p.makeApiCall("updateGroup",s,s).then(function(e){t(A.GroupsController.trasformJSONGroup(e.data))},function(e){n(new h.CometChatException(e.error))})})},i.deleteGroup=function(e){return new Promise(function(t,n){p.makeApiCall("deleteGroup",{guid:e}).then(function(e){t(!0)},function(e){n(new h.CometChatException(e.error))})})},i.leaveGroup=function(s){return new Promise(function(t,n){p.makeApiCall("leaveGroup",{guid:s}).then(function(e){x.leaveMuc(s),C.MessagesStore.getInstance().storeMessages([_.MessageController.trasformJSONMessge(e.data)]),t(!0)},function(e){n(new h.CometChatException(e.error))})})},i.kickGroupMember=function(e,s){return new Promise(function(t,n){p.makeApiCall("kickGroupMembers",{guid:e,uid:s}).then(function(e){C.MessagesStore.getInstance().storeMessages([_.MessageController.trasformJSONMessge(e.data)]),t(!0)},function(e){n(new h.CometChatException(e.error))})})},i.updateGroupMemberScope=function(e,s,r){return new Promise(function(t,n){p.makeApiCall("changeScopeOfMember",{guid:e,uid:s},{scope:r}).then(function(e){C.MessagesStore.getInstance().storeMessages([_.MessageController.trasformJSONMessge(e.data)]),t(!0)},function(e){n(new h.CometChatException(e.error))})})},i.banGroupMember=function(e,s){return new Promise(function(t,n){p.makeApiCall("banGroupMember",{guid:e,uid:s}).then(function(e){C.MessagesStore.getInstance().storeMessages([_.MessageController.trasformJSONMessge(e.data)]),t(!0)},function(e){n(new h.CometChatException(e.error))})})},i.unbanGroupMember=function(e,s){return new Promise(function(t,n){p.makeApiCall("unbanGroupMember",{guid:e,uid:s}).then(function(e){C.MessagesStore.getInstance().storeMessages([_.MessageController.trasformJSONMessge(e.data)]),t(!0)},function(e){n(new h.CometChatException(e.error))})})},i.addMembersToGroup=function(s,r,o){var i=[],a=[],u=[],c=[];return new Promise(function(t,n){l.isFalsy(r)&&l.isFalsy(o)?n(new h.CometChatException({})):l.isFalsy(r)||l.isFalsy(o)?l.isFalsy(r)?o.map(function(e){c.push(e.getUid())}):(r.filter(function(e){if(e.getScope()==m.GROUP_MEMBER_SCOPE.ADMIN)return!0}).map(function(e){i.push(e.getUid())}),r.filter(function(e){if(e.getScope()==m.GROUP_MEMBER_SCOPE.MODERATOR)return!0}).map(function(e){a.push(e.getUid())}),r.filter(function(e){if(e.getScope()==m.GROUP_MEMBER_SCOPE.PARTICIPANT)return!0}).map(function(e){u.push(e.getUid())})):(r.filter(function(e){if(e.getScope()==m.GROUP_MEMBER_SCOPE.ADMIN)return!0}).map(function(e){i.push(e.getUid())}),r.filter(function(e){if(e.getScope()==m.GROUP_MEMBER_SCOPE.MODERATOR)return!0}).map(function(e){a.push(e.getUid())}),r.filter(function(e){if(e.getScope()==m.GROUP_MEMBER_SCOPE.PARTICIPANT)return!0}).map(function(e){u.push(e.getUid())}),o.map(function(e){c.push(e.getUid())}));var e={};l.isFalsy(i)||(e=d({},e,{admin:i})),l.isFalsy(u)||(e=d({},e,{participant:u})),l.isFalsy(a)||(e=d({},e,{moderator:a})),l.isFalsy(c)||(e=d({},e,{banneduser:c})),p.makeApiCall("addMemebersToGroup",{guid:s},e).then(function(e){t(e)},function(e){n(new h.CometChatException(e.error))})})},i.initiateCall=function(t){return new Promise(function(n,s){l.isFalsy(JSON.parse(JSON.stringify(t)).sender)?l.isFalsy(M.CallController.getInstance().getActiveCall())?(t.setStatus(m.CallConstants.CALL_STATUS.INITIATED),p.makeApiCall("createCallSession",{},t).then(function(e){var t=_.MessageController.trasformJSONMessge(e[m.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);M.CallController.getInstance().initiateCall(t).then(function(e){C.MessagesStore.getInstance().storeMessages([e]),n(t)}).catch(function(e){s(e)})},function(e){s(new h.CometChatException(e.error))})):s(new h.CometChatException(m.CALL_ERROR.ERROR_IN_CALLING)):M.CallController.getInstance().initiateCall(t).then(function(e){n(Object.assign(t))}).catch(function(e){s(e)})})},i.acceptCall=function(s){return new Promise(function(n,t){var e={};e[m.CallConstants.CALL_KEYS.CALL_STATUS]=m.CallConstants.CALL_STATUS.ONGOING,p.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=_.MessageController.trasformJSONMessge(e[m.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);M.CallController.getInstance().onCallStarted(t),C.MessagesStore.getInstance().storeMessages(t),n(t)},function(e){t(new h.CometChatException(e.error))})})},i.rejectCall=function(e,t){switch(t){case m.CallConstants.CALL_STATUS.REJECTED:return this.rejectIncomingCall(e);case m.CallConstants.CALL_STATUS.CANCELLED:return this.cancelCall(e);case m.CallConstants.CALL_STATUS.BUSY:return this.sendBusyResponse(e);default:return this.endCall(e)}},i.endCall=function(s){return new Promise(function(n,e){var t={};t[m.CallConstants.CALL_KEYS.CALL_STATUS]=m.CallConstants.CALL_STATUS.ENDED,M.CallController.getInstance().getActiveCall().getJoinedAt()&&(t[m.CallConstants.CALL_KEYS.CALL_JOINED_AT]=M.CallController.getInstance().getActiveCall().getJoinedAt()),p.makeApiCall("updateCallSession",{sessionid:s},t).then(function(e){var t=_.MessageController.trasformJSONMessge(e[m.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);C.MessagesStore.getInstance().storeMessages(t),M.CallController.getInstance().endCall(),n(t)},function(e){l.Logger.log("calling Log",{error:e});var t=M.CallController.getInstance().getActiveCall();t.setStatus(m.CallConstants.CALL_STATUS.ENDED),C.MessagesStore.getInstance().storeMessages(t),n(t),M.CallController.getInstance().endCall()})})},i.getActiveCall=function(){return M.CallController.getInstance().getActiveCall()},i.startCall=function(e,t,n){M.CallController.getInstance().startCall(t,n)},i.rejectIncomingCall=function(s){return new Promise(function(n,t){var e={};e[m.CallConstants.CALL_KEYS.CALL_STATUS]=m.CallConstants.CALL_STATUS.REJECTED,p.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=_.MessageController.trasformJSONMessge(e[m.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);C.MessagesStore.getInstance().storeMessages([t]),n(t)},function(e){t(new h.CometChatException(e.error))})})},i.cancelCall=function(s){return new Promise(function(n,t){var e={};e[m.CallConstants.CALL_KEYS.CALL_STATUS]=m.CallConstants.CALL_STATUS.CANCELLED,p.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=_.MessageController.trasformJSONMessge(e[m.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);C.MessagesStore.getInstance().storeMessages(t),M.CallController.getInstance().endCallSession(),n(t)},function(e){t(new h.CometChatException(e.error))})})},i.sendBusyResponse=function(s){return new Promise(function(n,t){var e={};e[m.CallConstants.CALL_KEYS.CALL_STATUS]=m.CallConstants.CALL_STATUS.BUSY,p.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=_.MessageController.trasformJSONMessge(e[m.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);C.MessagesStore.getInstance().storeMessages(t),n(t)},function(e){t(new h.CometChatException(e.error))})})},i.sendUnansweredResponse=function(s){return new Promise(function(n,t){var e={};e[m.CallConstants.CALL_KEYS.CALL_STATUS]=m.CallConstants.CALL_STATUS.UNANSWERED,p.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=_.MessageController.trasformJSONMessge(e[m.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);u.XMPPConnectionHelper.getInstance().trigerMessageHandler(Object.assign(t,e[m.ResponseConstants.RESPONSE_KEYS.KEY_DATA])),C.MessagesStore.getInstance().storeMessages([Object.assign(t,e[m.ResponseConstants.RESPONSE_KEYS.KEY_DATA])]),n(t)},function(e){t(new h.CometChatException(e.error))})})},i.addMessageListener=function(e,t){x.addMessageEventListener(e,t)},i.removeMessageListener=function(e){x.removeMessageEventListener(e)},i.addCallListener=function(e,t){x.addCallEventListener(e,t)},i.removeCallListener=function(e){x.removeCallEventListener(e)},i.addUserListener=function(e,t){x.addUserEventListener(e,t)},i.removeUserListener=function(e){x.removeUserEventListener(e)},i.addGroupListener=function(e,t){x.addGroupEventListener(e,t)},i.removeGroupListener=function(e){x.removeGroupEventListener(e)},i.generateAuthToken=function(e){return new Promise(function(t,n){p.makeApiCall("authToken",{uid:e}).then(function(e){t(e.data)}).catch(function(e){n(new h.CometChatException(e.error))})})},i.XMPPLogin=function(t,n,s){var r=this,o=!0;x.XMMPLogin(t.getUid(),t.getWsChannel().secret,function(e){switch(e){case c.Strophe.Status.CONNFAIL:return s(new h.CometChatException(v.LOGIN_ERROR.XMPP_CONNECTION_FAIL)),r.getAppSettings().then(function(e){});case c.Strophe.Status.CONNECTED:r.localStorage.set("user",t),n(new a.User(t));break;case c.Strophe.Status.DISCONNECTED:o&&r.XMPPLogin(t,n,s);break;case c.Strophe.Status.DISCONNECTING:o=!1,l.Logger.info("Connection","Disconnecting");break;case c.Strophe.Status.AUTHFAIL:s(new h.CometChatException(v.LOGIN_ERROR.XMPP_CONNECTION_FAIL))}})},i.getAppSettings=function(){return new Promise(function(t,n){p.makeApiCall("appSettings").then(function(e){f.LocalStorage.getInstance().set("app_settings",e.data),t(e.data)},function(e){n(new h.CometChatException(e.error))})})},i.logout=function(){var s=this;return new Promise(function(t,n){p.makeApiCall("userLogout").then(function(e){u.XMPPConnectionHelper.getInstance().XMPPDisconnect(),s.clearCache(),s.apiKey=void 0,s.user=void 0,s.authToken=void 0,t(e.data)},function(e){n(new h.CometChatException(e.error))})})},i.clearCache=function(){this.messagesStore.clearStore(),this.userStore.clearStore(),this.localStorage.clearStore()},i.typingTimer=function(){setInterval(function(){Y.TypingNotificationController.clearTimer()},500)},i.CometChatException=h.CometChatException,i.initialzed=!1,i.TextMessage=E.TextMessage,i.MediaMessage=g.MediaMessage,i.CustomMessage=U.CustomMessage,i.Action=N.Action,i.Call=R.Call,i.TypingIndicator=D.TypingIndicator,i.Group=T.Group,i.AppUser=a.User,i.User=a.User,i.GroupMember=G.GroupMember,i.MessagesRequest=b.DefaultMessagesRequest,i.MessagesRequestBuilder=b.DefaultMessagesRequestBuilder,i.UsersRequest=L.UsersRequest,i.UsersRequestBuilder=L.UsersRequestBuilder,i.GroupsRequest=O.GroupsRequest,i.GroupsRequestBuilder=O.GroupsRequestBuilder,i.GroupMembersRequest=P.GroupMembersRequest,i.GroupMembersRequestBuilder=P.GroupMembersRequestBuilder,i.BannedMembersRequest=P.GroupMembersRequest,i.BannedMembersRequestBuilder=P.GroupOutCastMembersRequestBuilder,i.MessageListener=y.MessageEventListener,i.UserListener=y.UserEventListener,i.GroupListener=y.GroupEventListener,i.OngoingCallListener=y.UserCallEventListener,i.CallListener=y.CallEventListener,i.MESSAGE_TYPE=m.MessageConstatnts.TYPE,i.CATEGORY_MESSAGE=m.MessageConstatnts.CATEGORY.MESSAGE,i.CATEGORY_ACTION=m.MessageConstatnts.CATEGORY.ACTION,i.CATEGORY_CALL=m.MessageConstatnts.CATEGORY.CALL,i.ACTION_TYPE=m.ActionConstatnts.ACTIONS,i.CALL_TYPE=m.CallConstants.CALL_TYPE,i.RECEIVER_TYPE=m.MessageConstatnts.RECEIVER_TYPE,i.CALL_STATUS=m.CallConstants.CALL_STATUS,i.CallController=M.CallController,i.GROUP_MEMBER_SCOPE=m.GROUP_MEMBER_SCOPE,i.GROUP_TYPE=m.GROUP_TYPE,i.MESSAGE_REQUEST=m.MessageConstatnts.PAGINATION.CURSOR_FILEDS,i.isCall=!1,i.endpointFactory=new o.EndpointFactory,i.startTypingCount=0,i.endTypingCount=0,i}();t.CometChat=i},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var o=function(){function e(e){this.uid=e.uid,this.name=e.name,this.authToken=e.authToken,this.avatar=e.avatar,this.credits=e.credits,this.email=e.email,this.lastActiveAt=e.lastActiveAt,this.link=e.link,this.metadata=e.metadata,this.role=e.role,this.status=e.status,this.statusMessage=e.statusMessage}return e.prototype.getUid=function(){return this.uid},e.prototype.setUid=function(e){this.uid=e},e.prototype.getName=function(){return this.name},e.prototype.setName=function(e){this.name=e},e.prototype.getAuthToken=function(){return this.authToken},e.prototype.setAuthToken=function(e){this.authToken=e},e.prototype.getAvatar=function(){return this.avatar},e.prototype.setAvatar=function(e){this.avatar=e},e.prototype.getCredits=function(){return this.credits},e.prototype.setCredits=function(e){this.credits=e},e.prototype.getEmail=function(){return this.email},e.prototype.setEmail=function(e){this.email=e},e.prototype.getLastActiveAt=function(){return this.lastActiveAt},e.prototype.setLastActiveAt=function(e){this.lastActiveAt=e},e.prototype.getLink=function(){return this.link},e.prototype.setLink=function(e){return this.link=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e},e.prototype.getRole=function(){return this.role},e.prototype.setRole=function(e){this.role=e},e.prototype.getStatus=function(){return this.status},e.prototype.setStatus=function(e){this.status=e},e.prototype.getStatusMessage=function(){return this.statusMessage},e.prototype.setStatusMessage=function(e){this.statusMessage=e},e}(),i=function(n){function e(e){var t=n.call(this,e)||this;return t.wsChannel=e.wsChannel,t}return r(e,n),e.prototype.getWsChannel=function(){return this.wsChannel},e}(t.User=o);t.Me=i},function(e,t,n){"use strict";t.__esModule=!0;var s=function(e){this.code=e.code,this.name=e.name,this.message=e.message,this.details=e.details};t.CometChatException=s},function(e,t,n){"use strict";t.__esModule=!0;var u=n(38),c=n(2),i=n(1);function d(t,e,n,s,r){var o;return void 0===t&&(t=""),void 0===e&&(e="GET"),void 0===n&&(n={}),void 0===s&&(s={}),n=i.isFalsy(n)?void 0:("GET"==e&&(t+="?",Object.keys(n).map(function(e){t=t+e+"="+n[e]+"&"}),n=void 0),r&&(o=new FormData(this),Object.keys(n).map(function(e){n[e]instanceof Object&&!(n[e]instanceof File)?o.set(e,JSON.stringify(n[e])):o.set(e,n[e])})),JSON.stringify(n)),fetch(t,{method:e,mode:"cors",cache:"no-cache",headers:s,redirect:"follow",referrer:"no-referrer",body:r?o:n})}t.makeApiCall=function(r,e,o,i){void 0===r&&(r=""),void 0===e&&(e={}),void 0===o&&(o={});var a=c.CometChat.getInstance();return new Promise(function(n,s){u.getEndPoint(r,e).then(function(e){var t={appId:c.CometChat.getAppId(),Accept:"application/json"};i||(t["Content-Type"]="application/json"),e.hasOwnProperty("isAdminApi")&&e.isAdminApi?a.getApiKey()?t.apiKey=a.getApiKey():s({error:{code:"API_KEY_NOT_SET",message:"An apiKey is needed to use the "+r+" api.",name:"API_KEY_NOT_SET"}}):a.getAuthToken()?t.authToken=a.getAuthToken():s({error:{code:"USER_NOT_LOGED_IN",message:"An authToken is need to use the "+r+" api.",name:"user not logged in"}}),d(e.endpoint,e.method,o,t,i).then(function(e){return e.json()}).then(function(e){e.hasOwnProperty("data")?(e.data.hasOwnProperty("authToken")&&c.CometChat.setAuthToken(e.data.authToken),n(e)):s(e)}).catch(function(e){return s})}).catch(function(e){return s})})},t.makeAdminApiCall=function(r,e,o,i){void 0===r&&(r=""),void 0===e&&(e={}),void 0===o&&(o={});var a=c.CometChat.getInstance();return new Promise(function(n,s){u.getEndPoint(r,e).then(function(e){var t={appId:c.CometChat.getAppId(),Accept:"application/json"};i||(t["Content-Type"]="application/json"),e.hasOwnProperty("isAdminApi")&&e.isAdminApi?a.getApiKey()?t.apiKey=a.getApiKey():s({error:"An apiKey is need to use the "+r+" api."}):a.getAuthToken()?t.authToken=a.getAuthToken():s({error:"An authToken is need to use the "+r+" api."}),d(e.endpoint,e.method,o,t,i).then(function(e){return e.json()}).then(function(e){e.hasOwnProperty("data")?(e.data.hasOwnProperty("authToken")&&c.CometChat.setAuthToken(e.data.authToken),n(e)):s(e)}).catch(function(e){return s})}).catch(function(e){return s})})},t.postData=d},function(e,t,n){"use strict";t.__esModule=!0;var s=n(1),r=n(0),o=n(13),i=n(2),a=function(){function e(e){this.store=r.constants.DEFAULT_STORE,s.isFalsy(e)||(this.store=e),this.localStore=o.createInstance({name:s.format(r.LOCAL_STORE.STORE_STRING,i.CometChat.getAppId(),r.LOCAL_STORE.COMMON_STORE)}),this.localStore.setDriver([o.LOCALSTORAGE,o.INDEXEDDB,o.WEBSQL])}return e.getInstance=function(){return null==e.localStorage&&(e.localStorage=new e),e.localStorage},e.prototype.set=function(e,t){return this.localStore.setItem(e,t)},e.prototype.remove=function(e){this.localStore.removeItem(e)},e.prototype.get=function(e){return this.localStore.getItem(e)},e.prototype.clearStore=function(){return this.localStore.clear()},e.prototype.clear=function(e){},e.prototype.selectStore=function(e){this.store=e},e.localStorage=null,e}();t.LocalStorage=a},function(e,t,n){"use strict";t.__esModule=!0;var c=n(1),d=n(39),l=n(2),s=n(14),r=n(11),h=n(0),o=n(28),i=(n(44),n(45),n(15)),p=n(9),f=n(8),a=n(46),g=n(17),E=n(21),_=n(6),C=n(29),S=n(22),m=n(30),u=function(){function u(){this.messageHandlers=[],this.userHandlers=[],this.callHandlers=[],this.groupHandlers=[],this.iqHandlers=[]}return u.getInstance=function(){return null!=this.xMPPConnectionHelper&&null!=this.xMPPConnectionHelper||(this.xMPPConnectionHelper=new u),this.xMPPConnectionHelper},u.prototype.XMPPConnect=function(n){var s=this;return new Promise(function(t,e){c.isFalsy(n)&&(n=u.XMPP_BIND_URL),_.LocalStorage.getInstance().get(h.APP_SETTINGS.APP_SETTINGS).then(function(e){c.isFalsy(e)?c.getAppSettings().then(function(e){u.XMPP_BIND_URL="wss://"+e[h.APP_SETTINGS.KEYS.CHAT_HOST]+":"+e[h.APP_SETTINGS.KEYS.CHAT_HTTPS_BIND_PORT]+h.XMPP.bind_url,s.connection=new d.Strophe.Connection(u.XMPP_BIND_URL),t(!0)}):(u.XMPP_BIND_URL="wss://"+e[h.APP_SETTINGS.KEYS.CHAT_HOST]+":"+e[h.APP_SETTINGS.KEYS.CHAT_HTTPS_BIND_PORT]+h.XMPP.bind_url,s.connection=new d.Strophe.Connection(u.XMPP_BIND_URL),t(!0))})})},u.prototype.XMPPDisconnect=function(){this.connection.flush(),this.connection.disconnect()},u.prototype.XMMPLogin=function(t,n,s){var a=this;void 0===n&&(n=h.XMPP.deafult_password),this.XMPPConnect().then(function(e){a.connection.connected?s(d.Strophe.Status.CONNECTED):a.connection.connect(c.format(h.XMPP.jid_string,l.CometChat.getAppId(),t,u.XMPP_HOST,h.XMPP.xmpp_resource),n,function(e){c.isFalsy(s)||s(e),e==d.Strophe.Status.CONNECTED&&(a.connection.sendPresence(d.$pres().c("priority").t("1").up().c("status").t("online")),a.connection.muc.init(a.connection),a.connection.vcard.init(a.connection),a.connection.chatstates.init(a.connection),a.connection.receipts.init(a.connection),a.connection.streamManagement.enable(),_.LocalStorage.getInstance().get(h.APP_SETTINGS.APP_SETTINGS).then(function(e){c.isFalsy(e)?c.getAppSettings().then(function(e){a.connection.muc.listRooms(l.CometChat.getAppId()+"."+e[h.APP_SETTINGS.KEYS.CHAT_HOST],function(e){var t=e.getElementsByTagName("item");(t=Array.prototype.slice.call(t)).map(function(e){a.connection.muc.join(e.getAttribute("jid"),a.connection.jid)})})}):a.connection.muc.listRooms(l.CometChat.getAppId()+"."+e[h.APP_SETTINGS.KEYS.CHAT_HOST],function(e){var t=e.getElementsByTagName("item");(t=Array.prototype.slice.call(t)).map(function(e){a.connection.muc.join(e.getAttribute("jid"),a.connection.jid)})})}),a.connection.send(d.$iq({from:d.Strophe.getBareJidFromJid(a.connection.jid),id:"enable1",type:"set"}).c("enable",{xmlns:"urn:xmpp:carbons:2"})),a.connection.addHandler(function(e){if(!(0<e.getElementsByTagName("x").length)){var n=o.PresenceController.transformPresence(e);a.getUsersVCard(n.getUid(),function(t){c.isFalsy(t.getUid())||a.userHandlers.map(function(e){if(e)switch(t.setLastActiveAt(n.getLastActiveAt()),n.getStatus()){case h.PresenceConstatnts.STATUS.ONLINE:t.setStatus(h.PresenceConstatnts.STATUS.ONLINE),c.isFalsy(e._eventListener.onUserOnline)||e._eventListener.onUserOnline(t);break;default:t.setStatus(h.PresenceConstatnts.STATUS.OFFLINE),c.isFalsy(e._eventListener.onUserOffline)||e._eventListener.onUserOffline(t)}})})}return!0},null,"presence"),a.connection.addHandler(function(e){var t=e.getElementsByTagName("presence");return 0<(t=Array.prototype.slice.call(t)).length&&a.iqHandlers.map(function(e){e._callback(o.PresenceController.transformPresences(t))}),!0},null,"iq"),a.connection.addHandler(function(n){var e;try{try{e=r.MessageController.trasformXMPPMessage(n),c.isFalsy(e)?(c.Logger.info("this are receipts receipts",n),r.MessageController.isDeliveryReceipt(n)?a.publishDeliveryReceipt(n):r.MessageController.isReadRceipt(n)&&a.publishReadReceipt(n)):(c.Logger.info("processing incoming message for receipts",{message:n,_message:e}),a.connection.receipts._processReceipt(n,e.getId())),n=n.getAttribute(h.MessageConstatnts.XMPP_KEYS.TYPE)==h.MessageConstatnts.XMPP_KEYS.TYPE_GROUP&&f.getFullJidForGroup(n.getAttribute(h.MessageConstatnts.XMPP_KEYS.FROM))==u.getInstance().connection.jid?null:e}catch(e){return c.Logger.error("Error in processing incoming message",{e:e,message:n}),!0}if(!c.isFalsy(n)){c.Logger.info("We are only processing the incoming message and not recipts",{message:n}),p.MessagesStore.getInstance().storeMessages([n]);try{S.MessageListnerMaping.getInstance().set("all",n.id)}catch(e){c.Logger.error("Error in storing  incoming message id",{e:e})}a.messageHandlers.map(function(e){try{if(e)if(n instanceof i.Action);else if(n instanceof g.Call);else{var t=n;try{S.MessageListnerMaping.getInstance().set(e._name,n.id)}catch(e){}switch(t.getType()){case h.MessageConstatnts.TYPE.TEXT:c.isFalsy(e._eventListener.onTextMessageReceived)||e._eventListener.onTextMessageReceived(n);break;case h.MessageConstatnts.TYPE.CUSTOM:c.isFalsy(e._eventListener.onMediaMessageReceived)||e._eventListener.onCustomMessageReceived(n);break;default:c.isFalsy(e._eventListener.onMediaMessageReceived)||e._eventListener.onMediaMessageReceived(n)}}}catch(e){c.Logger.error("Error in processing incoming message",{e:e})}}),n instanceof g.Call&&(c.Logger.info("processing incoming call ",{message:n}),a.publishCallEvents(n)),n instanceof i.Action&&(c.Logger.info("processing incoming group actions ",{message:n}),a.publishActionEvents(n))}}catch(e){c.Logger.info("Error in message processing",{error:e})}return!0},null,"message"),a.connection.addHandler(function(e){try{if(0<e.getElementsByTagName("error").length)return c.Logger.info("Processing incoming message",e),!0;var t,n=e.getElementsByTagName("composing"),s=e.getElementsByTagName("paused"),r=e.getAttribute("from"),o=e.getAttribute("type");if(e.getElementsByTagName("body")[0]&&(t=unescape(f.parseHTML(e.getElementsByTagName("body")[0])).trim().toString()),0<n.length||0<s.length)switch(o){case h.XMPP.CONVERSATION.TYPE.CHAT:var i=new C.TypingIndicator(f.getUidFromJid(a.connection.jid),h.MessageConstatnts.RECEIVER_TYPE.USER);a.getUsersVCard(f.getUidFromJid(r),function(e){i.setSender(e),t&&i.setMetadata(t),0<n.length&&m.TypingNotificationController.addIncomingTypingStarted(i),0<s.length&&m.TypingNotificationController.removeIncomingTypingStarted(i),a.messageHandlers.map(function(e){0<n.length&&e._eventListener.onTypingStarted&&e._eventListener.onTypingStarted(i),0<s.length&&e._eventListener.onTypingEnded&&e._eventListener.onTypingEnded(i)})});break;case h.XMPP.CONVERSATION.TYPE.GROUP_CHAT:if(f.getFullJidForGroup(e.getAttribute(h.MessageConstatnts.XMPP_KEYS.FROM))==u.getInstance().connection.jid)return!(e=null);i=new C.TypingIndicator(f.getGUIDFromJID(r),h.MessageConstatnts.RECEIVER_TYPE.GROUP),a.getUsersVCard(f.getUidFromJid(r),function(e){i.setSender(e),t&&i.setMetadata(t),0<n.length&&m.TypingNotificationController.addIncomingTypingStarted(i),0<s.length&&m.TypingNotificationController.removeIncomingTypingStarted(i),a.messageHandlers.map(function(e){0<n.length&&e._eventListener.onTypingStarted&&e._eventListener.onTypingStarted(i),0<s.length&&e._eventListener.onTypingEnded&&e._eventListener.onTypingEnded(i)})})}}catch(e){}return!0},d.Strophe.NS.CHATSTATES,"message"))})})},u.prototype.getPresenceInfo=function(n,t){var s=this,e="somename"+(new Date).getTime();this.addIqHandler(e,function(e){t(e)}),c.getAppSettings().then(function(e){var t=d.$iq({from:s.connection.jid,id:"CC^COMETCHAT-PRESENCE",type:"get",to:e[h.APP_SETTINGS.KEYS.CHAT_HOST]}).c("query",{xmlns:"jabber:iq:presencereq",action:"presence"}).t(JSON.stringify(n));s.connection.send(t)},function(e){c.Logger.error("getPresenceInfo",e);var t=d.$iq({from:s.connection.jid,id:"CC^COMETCHAT-PRESENCE",type:"get",to:h.XMPP.host}).c("query",{xmlns:"jabber:iq:presencereq",action:"presence"}).t(JSON.stringify(n));s.connection.send(t)})},u.prototype.sendTypingStarted=function(e,t,n){if(void 0===t&&(t=h.XMPP.CONVERSATION.TYPE.CHAT),e){switch(t){case h.XMPP.CONVERSATION.TYPE.CHAT:case h.XMPP.CONVERSATION.TYPE.GROUP_CHAT:}this.connection.chatstates.sendComposing(e,t,n)}},u.prototype.sendTypingPaused=function(e,t,n){if(void 0===t&&(t=h.XMPP.CONVERSATION.TYPE.CHAT),e){switch(t){case h.XMPP.CONVERSATION.TYPE.CHAT:case h.XMPP.CONVERSATION.TYPE.GROUP_CHAT:}this.connection.chatstates.sendPaused(e,t,n)}},u.prototype.addMessageEventListener=function(t,e){this.messageHandlers=this.messageHandlers.filter(function(e){return e._name!=t}),this.messageHandlers=this.messageHandlers.concat([new s.MessageListener(t,e)]),S.MessageListnerMaping.getInstance().get(t).then(function(e){c.isFalsy(e)&&S.MessageListnerMaping.getInstance().set(t,0)})},u.prototype.removeMessageEventListener=function(t){this.messageHandlers=this.messageHandlers.filter(function(e){return e._name!==t})},u.prototype.addCallEventListener=function(t,e){this.callHandlers=this.callHandlers.filter(function(e){return e._name!=t}),this.callHandlers=this.callHandlers.concat([new s.CallListener(t,e)])},u.prototype.removeCallEventListener=function(t){this.callHandlers=this.callHandlers.filter(function(e){return e._name!==t})},u.prototype.addUserEventListener=function(t,e){this.userHandlers=this.userHandlers.filter(function(e){return e._name!=t}),this.userHandlers=this.userHandlers.concat([new s.UserListener(t,e)])},u.prototype.removeUserEventListener=function(t){this.userHandlers=this.userHandlers.filter(function(e){return e._name!==t})},u.prototype.addGroupEventListener=function(e,t){this.groupHandlers=this.groupHandlers.filter(function(e){e._name}),this.groupHandlers=this.groupHandlers.concat([new s.GroupListener(e,t)])},u.prototype.removeGroupEventListener=function(t){this.groupHandlers=this.groupHandlers.filter(function(e){return e._name!==t})},u.prototype.addIqHandler=function(e,t){this.iqHandlers=this.iqHandlers.concat([new s.Listener(e,t)])},u.prototype.removeIqHandler=function(t){this.iqHandlers=this.iqHandlers.filter(function(e){return e._name!==t})},u.prototype.joinMuc=function(t){var n=this;c.getAppSettings().then(function(e){n.connection.muc.join(c.format(h.XMPP.muc_jid_string,l.CometChat.getAppId(),t.getGuid(),l.CometChat.getAppId(),e[h.APP_SETTINGS.KEYS.CHAT_HOST]),n.connection.jid,null,null,null,null,0)})},u.prototype.leaveMuc=function(t){var n=this;c.getAppSettings().then(function(e){n.connection.muc.leave(c.format(h.XMPP.muc_jid_string,l.CometChat.getAppId(),t,l.CometChat.getAppId(),e[h.APP_SETTINGS.KEYS.CHAT_HOST]),n.connection.jid)})},u.prototype.getUsersVCard=function(e,t){var n=this;f.getJidFromUid(e).then(function(e){n.connection.vcard.get(function(e){t(a.VCardController.transformVCard(e))},e)})},u.prototype.trigerMessageHandler=function(t,e){if(c.isFalsy(e))t=r.MessageController.trasformJSONMessge(t),this.messageHandlers.map(function(e){try{if(e._eventListener)if(t instanceof i.Action);else if(t instanceof g.Call);else{switch(t.getType()){case h.MessageConstatnts.TYPE.TEXT:c.isFalsy(e._eventListener.onTextMessageReceived)||e._eventListener.onTextMessageReceived(t);break;case h.MessageConstatnts.TYPE.CUSTOM:c.isFalsy(e._eventListener.onMediaMessageReceived)||e._eventListener.onCustomMessageReceived(t);break;default:c.isFalsy(e._eventListener.onMediaMessageReceived)||e._eventListener.onMediaMessageReceived(t)}}}catch(e){c.Logger.error("Error in `trigerMessageHandler`",e)}}),t instanceof g.Call&&this.publishCallEvents(t),t instanceof i.Action&&this.publishActionEvents(t);else if(t=r.MessageController.trasformJSONMessge(t),this.messageHandlers[e]._eventListener)try{if(this.messageHandlers[e]._eventListener)if(t instanceof i.Action);else if(t instanceof g.Call);else{switch(t.getType()){case h.MessageConstatnts.TYPE.TEXT:c.isFalsy(this.messageHandlers[e]._eventListener.onTextMessageReceived)||this.messageHandlers[e]._eventListener.onTextMessageReceived(t);break;case h.MessageConstatnts.TYPE.CUSTOM:c.isFalsy(this.messageHandlers[e]._eventListener.onMediaMessageReceived)||this.messageHandlers[e]._eventListener.onCustomMessageReceived(t);break;default:c.isFalsy(this.messageHandlers[e]._eventListener.onMediaMessageReceived)||this.messageHandlers[e]._eventListener.onMediaMessageReceived(t)}}}catch(e){c.Logger.error("Error in `trigerMessageHandler`",e)}},u.prototype.publishActionEvents=function(t){switch(t.getAction()){case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_JOINED:this.groupHandlers.map(function(e){c.isFalsy(e._eventListener.onUserJoined)||e._eventListener.onUserJoined(t,t.getActionBy(),t.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_INVITED:this.groupHandlers.map(function(e){c.isFalsy(e._eventListener.onUserJoined)||e._eventListener.onUserJoined(t,t.getActionBy(),t.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_LEFT:this.groupHandlers.map(function(e){c.isFalsy(e._eventListener.onUserLeft)||e._eventListener.onUserLeft(t,t.getActionBy(),t.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_BANNED:this.groupHandlers.map(function(e){c.isFalsy(e._eventListener.onUserBanned)||e._eventListener.onUserBanned(t.getActionOn(),t.getActionBy(),t.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_KICKED:this.groupHandlers.map(function(e){c.isFalsy(e._eventListener.onUserKicked)||e._eventListener.onUserKicked(t,t.getActionOn(),t.getActionBy(),t.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_UNBANNED:this.groupHandlers.map(function(e){c.isFalsy(e._eventListener.onUserUnbanned)||e._eventListener.onUserUnbanned(t,t.getActionOn(),t.getActionBy(),t.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_SCOPE_CHANGED:this.groupHandlers.map(function(e){c.isFalsy(e._eventListener.onMemberScopeChanged)||e._eventListener.onMemberScopeChanged(t)})}},u.prototype.publishCallEvents=function(t){switch(t.getStatus()){case h.CallConstants.CALL_STATUS.INITIATED:t.getReceiverType()==h.CallConstants.RECEIVER_TYPE_GROUP?this.callHandlers.map(function(e){t.getCallInitiator().getUid().toLocaleLowerCase()!=l.CometChat.user.getUid().toLocaleLowerCase()&&(c.isFalsy(e._eventListener.onIncomingCallReceived)||e._eventListener.onIncomingCallReceived(t))}):this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onIncomingCallReceived)||e._eventListener.onIncomingCallReceived(t)});break;case h.CallConstants.CALL_STATUS.ONGOING:t.getReceiverType()==h.CallConstants.RECEIVER_TYPE_GROUP?t.getCallInitiator().getUid().toLocaleLowerCase()==l.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onOutgoingCallAccepted)||e._eventListener.onOutgoingCallAccepted(t)}):this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onOutgoingCallAccepted)||e._eventListener.onOutgoingCallAccepted(t)});break;case h.CallConstants.CALL_STATUS.UNANSWERED:t.getReceiverType()==h.CallConstants.RECEIVER_TYPE_GROUP?t.getCallInitiator().getUid().toLocaleLowerCase()==l.CometChat.user.getUid().toLocaleLowerCase()?this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)}):this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onIncomingCallCancelled)||e._eventListener.onIncomingCallCancelled(t)}):this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)});break;case h.CallConstants.CALL_STATUS.REJECTED:t.getReceiverType()==h.CallConstants.RECEIVER_TYPE_GROUP?t.getCallInitiator().getUid().toLocaleLowerCase()==l.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)}):this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)});break;case h.CallConstants.CALL_STATUS.BUSY:t.getReceiverType()==h.CallConstants.RECEIVER_TYPE_GROUP?t.getCallInitiator().getUid().toLocaleLowerCase()==l.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)}):this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)});break;case h.CallConstants.CALL_STATUS.CANCELLED:t.getReceiverType()==h.CallConstants.RECEIVER_TYPE_GROUP?t.getCallInitiator().getUid().toLocaleLowerCase()==l.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onIncomingCallCancelled)||e._eventListener.onIncomingCallCancelled(t)}):this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onIncomingCallCancelled)||e._eventListener.onIncomingCallCancelled(t)});break;case h.CallConstants.CALL_STATUS.ENDED:this.callHandlers.map(function(e){c.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)});try{E.CallController.getInstance().getCallListner()&&(E.CallController.getInstance().getCallListner()._eventListener.onCallEnded(t),E.CallController.getInstance().endCall())}catch(e){}}},u.prototype.publishTypinStatusNotification=function(t,e){switch(e){case h.TYPING_NOTIFICATION.ACTIONS.STARTED:this.messageHandlers.map(function(e){e._eventListener.onTypingStarted&&e._eventListener.onTypingStarted(t)}),m.TypingNotificationController.addIncomingTypingStarted(t);break;case h.TYPING_NOTIFICATION.ACTIONS.ENDED:this.messageHandlers.map(function(e){e._eventListener.onTypingEnded&&e._eventListener.onTypingEnded(t)}),m.TypingNotificationController.removeIncomingTypingStarted(t)}},u.prototype.publishDeliveryReceipt=function(e){var n=this;r.MessageController.processDeliveryReceipt(e).then(function(t){n.messageHandlers.map(function(e){e._eventListener.onMessageDelivered&&e._eventListener.onMessageDelivered(t)})})},u.prototype.publishReadReceipt=function(e){var n=this;r.MessageController.processReadReceipt(e).then(function(t){n.messageHandlers.map(function(e){e._eventListener.onMessageRead&&e._eventListener.onMessageRead(t)})})},u.prototype.markAsRead=function(e,s,r,o){var i=this;f.getJidFromUid(e).then(function(e){var t=d.$msg({to:e,from:i.connection.jid,id:i.connection.getUniqueId(),type:h.MessageConstatnts.XMPP_KEYS.TYPE_USER}),n=d.Strophe.xmlElement("read",{type:s,receiverId:o,xmlns:d.Strophe.NS.RECEIPTS,id:"["+l.CometChat.getAppId()+"]"+r});t.tree().appendChild(n),i.connection.send(t)})},u.XMPP_HOST=h.XMPP.host,u.XMPP_PORT=h.XMPP.port,u.xMPPConnectionHelper=new u,u.XMPP_BIND_URL="wss://"+u.XMPP_HOST+":"+u.XMPP_PORT+h.XMPP.bind_url,u}();t.XMPPConnectionHelper=u},function(e,t,n){"use strict";t.__esModule=!0;var s=n(0),r=n(1),o=n(2);t.getUidFromJid=function(e){return e.substring(e.lastIndexOf("]")+1,e.lastIndexOf("@"))},t.getappIdFromJid=function(e){return e.substring(e.lastIndexOf("[")+1,e.lastIndexOf("]"))},t.getmessageIdFromStanzaId=function(e){return e?e.substring(e.lastIndexOf("]")+1,e.length):e},t.parseHTML=function(t){try{return t.textContent}catch(e){return t}},t.getJidFromUid=function(n){return new Promise(function(t,e){r.getAppSettings().then(function(e){t(r.format(s.XMPP.bare_jid_string,o.CometChat.getAppId(),n,e[s.APP_SETTINGS.KEYS.CHAT_HOST]))},function(e){t(r.format(s.XMPP.bare_jid_string,o.CometChat.getAppId(),n,s.XMPP.host))})})},t.getGUIDFromJID=function(e){return e.substring(e.indexOf("]")+1,e.indexOf("@"))},t.getGroupJidFromGUID=function(n){return new Promise(function(t,e){r.getAppSettings().then(function(e){t(r.format(s.XMPP.muc_jid_string,o.CometChat.getAppId(),n,e[s.APP_SETTINGS.KEYS.GROUP_SERVICE],e[s.APP_SETTINGS.KEYS.CHAT_HOST]))},function(e){t(r.format(s.XMPP.muc_jid_string,o.CometChat.getAppId(),n,o.CometChat.getAppId(),s.XMPP.host))})})},t.getFullJidForGroup=function(e){return e.substring(e.indexOf("/")+1)}},function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var s=n(2),u=n(1),c=n(0),r=n(13),o=function(){function e(e){this.store=c.constants.DEFAULT_STORE,u.isFalsy(e)||(this.store=e),this.messagesStore=r.createInstance({name:u.format(c.LOCAL_STORE.STORE_STRING,s.CometChat.getAppId(),c.LOCAL_STORE.MESSAGES_STORE)}),this.messagesStore.setDriver([r.LOCALSTORAGE,r.INDEXEDDB,r.WEBSQL])}return e.getInstance=function(){return null==e.MessagesStore&&(e.MessagesStore=new e),e.MessagesStore},e.prototype.set=function(e,t){return this.messagesStore.setItem(e,t)},e.prototype.remove=function(e){this.messagesStore.removeItem(e)},e.prototype.get=function(e){return this.messagesStore.getItem(e)},e.prototype.clearStore=function(){return this.messagesStore.clear()},e.prototype.getAllMessages=function(){var n=this,s={};return new Promise(function(e,t){n.messagesStore.iterate(function(e,t,n){t!=c.constants.MSG_VER_POST&&t!=c.constants.MSG_VER_POST&&(s=a({},s,e))}).then(function(){e(s)})})},e.prototype.clear=function(e){},e.prototype.selectStore=function(e){this.store=e},e.prototype.storeMessages=function(e){var n=this;if(s.CometChat.user.getUid()){var r=s.CometChat.user.getUid(),o={},i=0;return this.get(c.constants.MSG_VER_POST).then(function(s){e.map(function(e){var t;if(!u.isFalsy(e)){0==i&&(i=parseInt(e.getId().toString())),i>e.getId()&&(i=parseInt(e.getId().toString())),s<e.getId()&&(s=parseInt(e.getId().toString()));var n=void 0;n=e.getSender()instanceof Object?e.getSender().getUid():e.getSender(),e.getReceiverType()==c.MessageConstatnts.RECEIVER_TYPE.GROUP&&(n=e.getReceiver()),e.getSender()instanceof Object?e.getSender().getUid()==r&&(n=e.getReceiver()):e.getSender()==r&&(n=e.getReceiver()),o[n]||(o[n]={}),o[n]=a({},o[n],((t={})[e.getId()]=e,t))}}),n.get(c.constants.MSG_VER_PRE).then(function(e){(0<i&&i<e||null==e)&&n.set(c.constants.MSG_VER_PRE,i)})&&0<s&&n.set(c.constants.MSG_VER_POST,s),Object.keys(o).map(function(t){n.get(t).then(function(e){null==e&&(e={}),n.set(t,a({},o[t],e))})})}),!0}},e}();t.MessagesStore=o},function(e,t,n){var s;window,s=function(){return function(n){var s={};function r(e){if(s[e])return s[e].exports;var t=s[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=n,r.c=s,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/strophe.js")}({"./src/bosh.js":function(e,t,n){"use strict";n.r(t);var s=n("./src/core.js"),l=s.default.Strophe,r=s.default.$build;l.Request=function(e,t,n,s){this.id=++l._requestId,this.xmlData=e,this.data=l.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=s||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},l.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(e=this.xhr.responseXML.documentElement).tagName)throw l.error("invalid response received"),l.error("responseText: "+this.xhr.responseText),l.error("responseXML: "+l.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(l.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(e=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){l.error("invalid response received: "+e.querySelector("parsererror").textContent),l.error("responseText: "+this.xhr.responseText);var t=new Error;throw t.name=l.ErrorCondition.BAD_FORMAT,t}}return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},l.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},l.Bosh.prototype={strip:null,_buildBody:function(){var e=r("body",{rid:this.rid++,xmlns:l.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;var s=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":l.NS.BOSH});n&&s.attrs({route:n});var r=this._conn._connect_cb;this._requests.push(new l.Request(s.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),s.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,s,r,o,i){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=s,this._conn.domain=l.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=r||this.wait,this.hold=o||this.hold,this.window=i||this.window,this._conn._changeConnectStatus(l.Status.ATTACHED,null)},_restore:function(e,t,n,s,r){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=o&&o.rid&&o.sid&&o.jid&&(null==e||l.getBareJidFromJid(o.jid)===l.getBareJidFromJid(e)||null===l.getNodeFromJid(e)&&l.getDomainFromJid(o.jid)===e))){var i=new Error("_restore: no restoreable session.");throw i.name="StropheSessionError",i}this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,t,n,s,r)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var t=e.getAttribute("type");if(null!==t&&"terminate"===t){var n=e.getAttribute("condition");l.error("BOSH-Connection failed: "+n);var s=e.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&0<s.length&&(n="conflict"),this._conn._changeConnectStatus(l.Status.CONNFAIL,n)):this._conn._changeConnectStatus(l.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),l.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));var r=e.getAttribute("requests");r&&(this.window=parseInt(r,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var i=e.getAttribute("wait");i&&(this.wait=parseInt(i,10));var a=e.getAttribute("inactivity");a&&(this.inactivity=parseInt(a,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t=this._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)},_hitError:function(e){this.errors++,l.warn("request errored, status: "+e+", number of errors: "+this.errors),4<this.errors&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){l.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new l.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;0<this._requests.length;){var e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(l.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&0<e.length){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":l.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new l.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(0<this._requests.length){var s=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(l.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),s>Math.floor(l.TIMEOUT*this.wait)&&(l.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(l.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,t){var n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){l.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n},_onRequestStateChange:function(e,t){if(l.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)t.abort=!1;else if(4===t.xhr.readyState){var n=this._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this.disconnecting&&400<=n)return this._hitError(n),void this._callProtocolErrorHandlers(t);var s=0<n&&n<500,r=t.sends>this._conn.maxRetries;if((s||r)&&(this._removeRequest(t),l.debug("request id "+t.id+" should now be removed")),200===n){var o=this._requests[0]===t;(this._requests[1]===t||o&&0<this._requests.length&&this._requests[0].age()>Math.floor(l.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(t.rid)+1),l.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0}else 0===n||400<=n&&n<600||12e3<=n?(l.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),400<=n&&n<500&&(this._conn._changeConnectStatus(l.Status.DISCONNECTING,null),this._conn._doDisconnect())):l.error("request id "+t.id+"."+t.sends+" error "+n+" happened");s||r?r&&!this._conn.connected&&this._conn._changeConnectStatus(l.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var n=this,s=this._requests[e],t=this._getRequestStatus(s,-1);if(s.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var r=s.age(),o=!isNaN(r)&&r>Math.floor(l.TIMEOUT*this.wait),i=null!==s.dead&&s.timeDead()>Math.floor(l.SECONDARY_TIMEOUT*this.wait),a=4===s.xhr.readyState&&(t<1||500<=t);if((o||i||a)&&(i&&l.error("Request ".concat(this._requests[e].id," timed out (secondary), restarting")),s.abort=!0,s.xhr.abort(),s.xhr.onreadystatechange=function(){},this._requests[e]=new l.Request(s.xmlData,s.origFunc,s.rid,s.sends),s=this._requests[e]),0===s.xhr.readyState){l.debug("request id "+s.id+"."+s.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";s.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==s.xhr.setRequestHeader&&s.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(s.xhr.withCredentials=!0)}catch(e){return l.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(l.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var c=function(){if(s.date=new Date,n._conn.options.customHeaders){var e=n._conn.options.customHeaders;for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.xhr.setRequestHeader(t,e[t])}s.xhr.send(s.data)};if(1<s.sends){var d=1e3*Math.min(Math.floor(l.TIMEOUT*this.wait),Math.pow(s.sends,3));setTimeout(function(){c()},d)}else c();s.sends++,this._conn.xmlOutput!==l.Connection.prototype.xmlOutput&&(s.xmlData.nodeName===this.strip&&s.xmlData.childNodes.length?this._conn.xmlOutput(s.xmlData.childNodes[0]):this._conn.xmlOutput(s.xmlData)),this._conn.rawOutput!==l.Connection.prototype.rawOutput&&this._conn.rawOutput(s.data)}else l.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+s.xhr.readyState)}},_removeRequest:function(e){l.debug("removing request");for(var t=this._requests.length-1;0<=t;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){l.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new l.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){var e=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){return e._conn._onIdle()},100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?l.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):l.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(0<this._requests.length&&this._processRequest(0),1<this._requests.length&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}},"./src/core.js":function(e,t,n){"use strict";n.r(t);var f=n("./src/md5.js"),S=n("./src/sha1.js"),m=n("./src/utils.js");function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return new E.Builder(e,t)}function r(e){return new E.Builder("iq",e)}function s(e){return new E.Builder("presence",e)}var E={VERSION:"1.3.0",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<E.XHTML.tags.length;t++)if(e===E.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==E.XHTML.attributes[e]&&0<E.XHTML.attributes[e].length)for(var n=0;n<E.XHTML.attributes[e].length;n++)if(t===E.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<E.XHTML.css.length;t++)if(e===E.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){E.NS[e]=t},forEachChild:function(e,t,n){for(var s=0;s<e.childNodes.length;s++){var r=e.childNodes[s];r.nodeType!==E.ElementType.NORMAL||t&&!this.isTagEqual(r,t)||n(r)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return E._xmlGenerator||(E._xmlGenerator=E._makeGenerator()),E._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(e){t=null}return t},xmlElement:function(e){if(!e)return null;for(var t=E.xmlGenerator().createElement(e),n=1;n<arguments.length;n++){var s=arguments[n];if(s)if("string"==typeof s||"number"==typeof s)t.appendChild(E.xmlTextNode(s));else if("object"===g(s)&&"function"==typeof s.sort)for(var r=0;r<s.length;r++){var o=s[r];"object"===g(o)&&"function"==typeof o.sort&&void 0!==o[1]&&null!==o[1]&&t.setAttribute(o[0],o[1])}else if("object"===g(s))for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&void 0!==s[i]&&null!==s[i]&&t.setAttribute(i,s[i])}return t},xmlescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return E.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e));return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===E.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===E.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return E.xmlescape(t)},copyElement:function(e){var t;if(e.nodeType===E.ElementType.NORMAL){t=E.xmlElement(e.tagName);for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(var s=0;s<e.childNodes.length;s++)t.appendChild(E.copyElement(e.childNodes[s]))}else e.nodeType===E.ElementType.TEXT&&(t=E.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(e){var t;if(e.nodeType===E.ElementType.NORMAL){var n=e.nodeName.toLowerCase();if(E.XHTML.validTag(n))try{t=E.xmlElement(n);for(var s=0;s<E.XHTML.attributes[n].length;s++){var r=E.XHTML.attributes[n][s],o=e.getAttribute(r);if(null!=o&&""!==o&&!1!==o&&0!==o)if("style"===r&&"object"===g(o)&&void 0!==o.cssText&&(o=o.cssText),"style"===r){for(var i=[],a=o.split(";"),u=0;u<a.length;u++){var c=a[u].split(":"),d=c[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(E.XHTML.validCSS(d)){var l=c[1].replace(/^\s*/,"").replace(/\s*$/,"");i.push(d+": "+l)}}0<i.length&&(o=i.join("; "),t.setAttribute(r,o))}else t.setAttribute(r,o)}for(var h=0;h<e.childNodes.length;h++)t.appendChild(E.createHtml(e.childNodes[h]))}catch(e){t=E.xmlTextNode("")}else{t=E.xmlGenerator().createDocumentFragment();for(var p=0;p<e.childNodes.length;p++)t.appendChild(E.createHtml(e.childNodes[p]))}}else if(e.nodeType===E.ElementType.FRAGMENT){t=E.xmlGenerator().createDocumentFragment();for(var f=0;f<e.childNodes.length;f++)t.appendChild(E.createHtml(e.childNodes[f]))}else e.nodeType===E.ElementType.TEXT&&(t=E.xmlTextNode(e.nodeValue));return t},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=E.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&E.fatal(e.stack),e.sourceURL?E.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?E.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):E.fatal("error: "+e.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"===g(window.console)&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(n){if(!n)return null;"function"==typeof n.tree&&(n=n.tree());var e=o(Array(n.attributes.length).keys()).map(function(e){return n.attributes[e].nodeName});e.sort();var t=e.reduce(function(e,t){return"".concat(e," ").concat(t,'="').concat(E.xmlescape(n.attributes.getNamedItem(t).value),'"')},"<".concat(n.nodeName));if(0<n.childNodes.length){t+=">";for(var s=0;s<n.childNodes.length;s++){var r=n.childNodes[s];switch(r.nodeType){case E.ElementType.NORMAL:t+=E.serialize(r);break;case E.ElementType.TEXT:t+=E.xmlescape(r.nodeValue);break;case E.ElementType.CDATA:t+="<![CDATA["+r.nodeValue+"]]>"}}t+="</"+n.nodeName+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){E._connectionPlugins[e]=t},Builder:function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=E.NS.CLIENT:t||(t={xmlns:E.NS.CLIENT})),this.nodeTree=E.xmlElement(e,t),this.node=this.nodeTree}};E.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return E.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var s=E.xmlElement(e,t,n);return this.node.appendChild(s),"string"!=typeof n&&"number"!=typeof n&&(this.node=s),this},cnode:function(e){var t,n=E.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var s=t?n.importNode(e,!0):E.copyElement(e);return this.node.appendChild(s),this.node=s,this},t:function(e){var t=E.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=E.createHtml(t);0<n.childNodes.length;)this.node.appendChild(n.childNodes[0]);return this}},E.Handler=function(e,t,n,s,r,o,i){this.handler=e,this.ns=t,this.name=n,this.type=s,this.id=r,this.options=i||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(E.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?E.getBareJidFromJid(o):null:this.from=o,this.user=!0},E.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=this,n=!1;return!this.ns||(E.forEachChild(e,null,function(e){t.getNamespace(e)===t.ns&&(n=!0)}),n||this.getNamespace(e)===this.ns)},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=E.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!E.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw E._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},E.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},E.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},E.Connection=function(e,t){var n=this;this.service=e,this.options=t||{};var s=this.options.protocol||"";for(var r in 0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===s.indexOf("ws")?this._proto=new E.Websocket(this):this._proto=new E.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){return n._onIdle()},100),m.default.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),E._connectionPlugins)if(Object.prototype.hasOwnProperty.call(E._connectionPlugins,r)){var o=function(){};o.prototype=E._connectionPlugins[r],this[r]=new o,this[r].init(this)}},E.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,s,r,o,i){this.jid=e,this.authzid=E.getBareJidFromJid(this.jid),this.authcid=i||E.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=E.getDomainFromJid(this.jid),this._changeConnectStatus(E.Status.CONNECTING,null),this._proto._connect(s,r,o)},attach:function(e,t,n,s,r,o,i){if(!(this._proto instanceof E.Bosh)){var a=new Error('The "attach" method can only be used with a BOSH connection.');throw a.name="StropheSessionError",a}this._proto._attach(e,t,n,s,r,o,i)},restore:function(e,t,n,s,r){if(!this._sessionCachingSupported()){var o=new Error('The "restore" method can only be used with a BOSH connection.');throw o.name="StropheSessionError",o}this._proto._restore(e,t,n,s,r)},_sessionCachingSupported:function(){if(this._proto instanceof E.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,s){var r=this,o=null;"function"==typeof e.tree&&(e=e.tree());var i=e.getAttribute("id");if(i||(i=this.getUniqueId("sendPresence"),e.setAttribute("id",i)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){o&&r.deleteTimedHandler(o),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,i);s&&(o=this.addTimedHandler(s,function(){return r.deleteHandler(a),n&&n(null),!1}))}return this.send(e),i},sendIQ:function(e,s,r,t){var o=this,i=null;"function"==typeof e.tree&&(e=e.tree());var n=e.getAttribute("id");if(n||(n=this.getUniqueId("sendIQ"),e.setAttribute("id",n)),"function"==typeof s||"function"==typeof r){var a=this.addHandler(function(e){i&&o.deleteTimedHandler(i);var t=e.getAttribute("type");if("result"===t)s&&s(e);else{if("error"!==t){var n=new Error("Got bad IQ type of ".concat(t));throw n.name="StropheError",n}r&&r(e)}},null,"iq",["error","result"],n);t&&(i=this.addTimedHandler(t,function(){return o.deleteHandler(a),r&&r(null),!1}))}return this.send(e),n},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes){var t=new Error("Cannot queue non-DOMElement.");throw t.name="StropheError",t}this._data.push(e)},_sendRestart:function(){var e=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){return e._onIdle()},100)},addTimedHandler:function(e,t){var n=new E.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,s,r,o,i){var a=new E.Handler(e,t,n,s,r,o,i);return this.addHandlers.push(a),a},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);0<=t&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},(e=e||[E.SASLAnonymous,E.SASLExternal,E.SASLMD5,E.SASLOAuthBearer,E.SASLXOAuth2,E.SASLPlain,E.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(E.Status.DISCONNECTING,e),E.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=s({xmlns:E.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else E.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,n){for(var s in E._connectionPlugins)if(Object.prototype.hasOwnProperty.call(E._connectionPlugins,s)){var r=this[s];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){E.error("".concat(s," plugin caused an exception changing status: ").concat(e))}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){E._handleError(e),E.error("User connection callback caused an exception: ".concat(e))}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),E.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(E.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){var r=this;E.info("_dataRecv called");var n=this._proto._reqToData(e);if(null!==n){for(this.xmlInput!==E.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==E.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(E.serialize(n)));0<this.removeHandlers.length;){var s=this.removeHandlers.pop(),o=this.handlers.indexOf(s);0<=o&&this.handlers.splice(o,1)}for(;0<this.addHandlers.length;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var i=n.getAttribute("type");if(null!==i&&"terminate"===i){if(this.disconnecting)return;var a=n.getAttribute("condition"),u=n.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&0<u.length&&(a="conflict"),this._changeConnectStatus(E.Status.CONNFAIL,a)):this._changeConnectStatus(E.Status.CONNFAIL,E.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}E.forEachChild(n,null,function(e){var t=r.handlers;r.handlers=[];for(var n=0;n<t.length;n++){var s=t[n];try{!s.isMatch(e)||!r.authenticated&&s.user?r.handlers.push(s):s.run(e)&&r.handlers.push(s)}catch(e){E.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}}},mechanisms:{},_connect_cb:function(e,t,n){var s;E.info("_connect_cb was called"),this.connected=!0;try{s=this._proto._reqToData(e)}catch(e){if(e.name!==E.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(E.Status.CONNFAIL,E.ErrorCondition.BAD_FORMAT),this._doDisconnect(E.ErrorCondition.BAD_FORMAT)}if(s&&(this.xmlInput!==E.Connection.prototype.xmlInput&&(s.nodeName===this._proto.strip&&s.childNodes.length?this.xmlInput(s.childNodes[0]):this.xmlInput(s)),this.rawInput!==E.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(E.serialize(s))),this._proto._connect_cb(s)!==E.Status.CONNFAIL))if(s.getElementsByTagNameNS?0<s.getElementsByTagNameNS(E.NS.STREAM,"features").length:0<s.getElementsByTagName("stream:features").length||0<s.getElementsByTagName("features").length){var r=[],o=s.getElementsByTagName("mechanism");if(0<o.length)for(var i=0;i<o.length;i++){var a=E.getText(o[i]);this.mechanisms[a]&&r.push(this.mechanisms[a])}0!==r.length||0!==s.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(r):this._proto._no_auth_received(t)}else this._proto._no_auth_received(t)},sortMechanismsByPriority:function(e){for(var t=0;t<e.length-1;++t){for(var n=t,s=t+1;s<e.length;++s)e[s].prototype.priority>e[n].prototype.priority&&(n=s);if(n!==t){var r=e[t];e[t]=e[n],e[n]=r}}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);for(var t=!1,n=0;n<e.length;++n)if(e[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var s=i("auth",{xmlns:E.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var r=this._sasl_mechanism.onChallenge(this,null);s.t(btoa(r))}this.send(s.tree()),t=!0;break}return t},_attemptLegacyAuth:function(){null===E.getNodeFromJid(this.jid)?(this._changeConnectStatus(E.Status.CONNFAIL,E.ErrorCondition.MISSING_JID_NODE),this.disconnect(E.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(E.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(r({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:E.NS.AUTH}).c("username",{}).t(E.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var t=atob(E.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),s=i("response",{xmlns:E.NS.SASL});return""!==n&&s.t(btoa(n)),this.send(s.tree()),!0},_auth1_cb:function(e){var t=r({type:"set",id:"_auth_2"}).c("query",{xmlns:E.NS.AUTH}).c("username",{}).t(E.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return E.getResourceFromJid(this.jid)||(this.jid=E.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(E.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){var n=this;if(this._sasl_data["server-signature"]){var t,s=atob(E.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===s[1]&&(t=s[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}E.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var r=[],o=function(e,t){for(;e.length;)n.deleteHandler(e.pop());return n._sasl_auth1_cb(t),!1};return r.push(this._addSysHandler(function(e){return o(r,e)},null,"stream:features",null,null)),r.push(this._addSysHandler(function(e){return o(r,e)},E.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}if(!this.do_bind)return this._changeConnectStatus(E.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var s=E.getResourceFromJid(this.jid);return s?this.send(r({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:E.NS.BIND}).c("resource",{}).t(s).tree()):this.send(r({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:E.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){var t;if("error"===e.getAttribute("type"))return E.info("SASL binding failed."),0<e.getElementsByTagName("conflict").length&&(t=E.ErrorCondition.CONFLICT),this._changeConnectStatus(E.Status.AUTHFAIL,t,e),!1;var n=e.getElementsByTagName("bind");if(!(0<n.length))return E.info("SASL binding failed."),this._changeConnectStatus(E.Status.AUTHFAIL,null,e),!1;var s=n[0].getElementsByTagName("jid");0<s.length&&(this.jid=E.getText(s[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(r({type:"set",id:"_session_auth_2"}).c("session",{xmlns:E.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(E.Status.CONNECTED,null)))},_sasl_session_cb:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(E.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return E.info("Session creation failed."),this._changeConnectStatus(E.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(E.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(E.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(E.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new E.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,s,r){var o=new E.Handler(e,t,n,s,r);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return E.info("_onDisconnectTimeout was called"),this._changeConnectStatus(E.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e=this;0<this.addTimeds.length;)this.timedHandlers.push(this.addTimeds.pop());for(;0<this.removeTimeds.length;){var t=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(t);0<=n&&this.timedHandlers.splice(n,1)}for(var s=(new Date).getTime(),r=[],o=0;o<this.timedHandlers.length;o++){var i=this.timedHandlers[o];if(this.authenticated||!i.user)i.lastCalled+i.period-s<=0?i.run()&&r.push(i):r.push(i)}this.timedHandlers=r,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){return e._onIdle()},100))}},E.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},E.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},E.SASLAnonymous=function(){},E.SASLAnonymous.prototype=new E.SASLMechanism("ANONYMOUS",!1,20),E.SASLAnonymous.prototype.test=function(e){return null===e.authcid},E.SASLPlain=function(){},E.SASLPlain.prototype=new E.SASLMechanism("PLAIN",!0,50),E.SASLPlain.prototype.test=function(e){return null!==e.authcid},E.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,m.default.utf16to8(t)},E.SASLSHA1=function(){},E.SASLSHA1.prototype=new E.SASLMechanism("SCRAM-SHA-1",!0,70),E.SASLSHA1.prototype.test=function(e){return null!==e.authcid},E.SASLSHA1.prototype.onChallenge=function(e,t,n){var s=n||f.default.hexdigest(1234567890*Math.random()),r="n="+m.default.utf16to8(e.authcid);return r+=",r=",r+=s,e._sasl_data.cnonce=s,r="n,,"+(e._sasl_data["client-first-message-bare"]=r),this.onChallenge=function(e,t){for(var n,s,r,o,i,a,u,c,d="c=biws,",l="".concat(e._sasl_data["client-first-message-bare"],",").concat(t,","),h=e._sasl_data.cnonce,p=/([a-z]+)=([^,]+)(,|$)/;t.match(p);){var f=t.match(p);switch(t=t.replace(f[0],""),f[1]){case"r":n=f[2];break;case"s":s=f[2];break;case"i":r=f[2]}}if(n.substr(0,h.length)!==h)return e._sasl_data={},e._sasl_failure_cb();l+=d+="r="+n,s=atob(s),s+="\0\0\0";var g=m.default.utf16to8(e.pass);for(o=a=S.default.core_hmac_sha1(g,s),u=1;u<r;u++){for(i=S.default.core_hmac_sha1(g,S.default.binb2str(a)),c=0;c<5;c++)o[c]^=i[c];a=i}o=S.default.binb2str(o);var E=S.default.core_hmac_sha1(o,"Client Key"),_=S.default.str_hmac_sha1(o,"Server Key"),C=S.default.core_hmac_sha1(S.default.str_sha1(S.default.binb2str(E)),l);for(e._sasl_data["server-signature"]=S.default.b64_hmac_sha1(_,l),c=0;c<5;c++)E[c]^=C[c];return d+=",p="+btoa(S.default.binb2str(E))},r},E.SASLMD5=function(){},E.SASLMD5.prototype=new E.SASLMechanism("DIGEST-MD5",!1,60),E.SASLMD5.prototype.test=function(e){return null!==e.authcid},E.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},E.SASLMD5.prototype.onChallenge=function(e,t,n){for(var s=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,r=n||f.default.hexdigest(""+1234567890*Math.random()),o="",i=null,a="";t.match(s);){var u=t.match(s);switch(t=t.replace(u[0],""),u[2]=u[2].replace(/^"(.+)"$/,"$1"),u[1]){case"realm":o=u[2];break;case"nonce":a=u[2];break;case"qop":u[2];break;case"host":i=u[2]}}var c=e.servtype+"/"+e.domain;null!==i&&(c=c+"/"+i);var d=m.default.utf16to8(e.authcid+":"+o+":"+this._connection.pass),l=f.default.hash(d)+":"+a+":"+r,h="AUTHENTICATE:"+c,p="";return p+="charset=utf-8,",p+="username="+this._quote(m.default.utf16to8(e.authcid))+",",p+="realm="+this._quote(o)+",",p+="nonce="+this._quote(a)+",",p+="nc=00000001,",p+="cnonce="+this._quote(r)+",",p+="digest-uri="+this._quote(c)+",",p+="response="+f.default.hexdigest(f.default.hexdigest(l)+":"+a+":00000001:"+r+":auth:"+f.default.hexdigest(h))+",",p+="qop=auth",this.onChallenge=function(){return""},p},E.SASLOAuthBearer=function(){},E.SASLOAuthBearer.prototype=new E.SASLMechanism("OAUTHBEARER",!0,40),E.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},E.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",m.default.utf16to8(t)},E.SASLExternal=function(){},E.SASLExternal.prototype=new E.SASLMechanism("EXTERNAL",!0,10),E.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},E.SASLXOAuth2=function(){},E.SASLXOAuth2.prototype=new E.SASLMechanism("X-OAUTH2",!0,30),E.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},E.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,m.default.utf16to8(t)},t.default={Strophe:E,$build:i,$iq:r,$msg:function(e){return new E.Builder("message",e)},$pres:s,SHA1:S.default,MD5:f.default,b64_hmac_sha1:S.default.b64_hmac_sha1,b64_sha1:S.default.b64_sha1,str_hmac_sha1:S.default.str_hmac_sha1,str_sha1:S.default.str_sha1}},"./src/md5.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return o});var l=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},s=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},a=function(e,t,n,s,r,o){return l((i=l(l(t,e),l(s,o)))<<(a=r)|i>>>32-a,n);var i,a},h=function(e,t,n,s,r,o,i){return a(t&n|~t&s,e,t,r,o,i)},p=function(e,t,n,s,r,o,i){return a(t&s|n&~s,e,t,r,o,i)},f=function(e,t,n,s,r,o,i){return a(t^n^s,e,t,r,o,i)},g=function(e,t,n,s,r,o,i){return a(n^(t|~s),e,t,r,o,i)},r=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,s,r,o,i=1732584193,a=-271733879,u=-1732584194,c=271733878,d=0;d<e.length;d+=16)i=h(n=i,s=a,r=u,o=c,e[d+0],7,-680876936),c=h(c,i,a,u,e[d+1],12,-389564586),u=h(u,c,i,a,e[d+2],17,606105819),a=h(a,u,c,i,e[d+3],22,-1044525330),i=h(i,a,u,c,e[d+4],7,-176418897),c=h(c,i,a,u,e[d+5],12,1200080426),u=h(u,c,i,a,e[d+6],17,-1473231341),a=h(a,u,c,i,e[d+7],22,-45705983),i=h(i,a,u,c,e[d+8],7,1770035416),c=h(c,i,a,u,e[d+9],12,-1958414417),u=h(u,c,i,a,e[d+10],17,-42063),a=h(a,u,c,i,e[d+11],22,-1990404162),i=h(i,a,u,c,e[d+12],7,1804603682),c=h(c,i,a,u,e[d+13],12,-40341101),u=h(u,c,i,a,e[d+14],17,-1502002290),a=h(a,u,c,i,e[d+15],22,1236535329),i=p(i,a,u,c,e[d+1],5,-165796510),c=p(c,i,a,u,e[d+6],9,-1069501632),u=p(u,c,i,a,e[d+11],14,643717713),a=p(a,u,c,i,e[d+0],20,-373897302),i=p(i,a,u,c,e[d+5],5,-701558691),c=p(c,i,a,u,e[d+10],9,38016083),u=p(u,c,i,a,e[d+15],14,-660478335),a=p(a,u,c,i,e[d+4],20,-405537848),i=p(i,a,u,c,e[d+9],5,568446438),c=p(c,i,a,u,e[d+14],9,-1019803690),u=p(u,c,i,a,e[d+3],14,-187363961),a=p(a,u,c,i,e[d+8],20,1163531501),i=p(i,a,u,c,e[d+13],5,-1444681467),c=p(c,i,a,u,e[d+2],9,-51403784),u=p(u,c,i,a,e[d+7],14,1735328473),a=p(a,u,c,i,e[d+12],20,-1926607734),i=f(i,a,u,c,e[d+5],4,-378558),c=f(c,i,a,u,e[d+8],11,-2022574463),u=f(u,c,i,a,e[d+11],16,1839030562),a=f(a,u,c,i,e[d+14],23,-35309556),i=f(i,a,u,c,e[d+1],4,-1530992060),c=f(c,i,a,u,e[d+4],11,1272893353),u=f(u,c,i,a,e[d+7],16,-155497632),a=f(a,u,c,i,e[d+10],23,-1094730640),i=f(i,a,u,c,e[d+13],4,681279174),c=f(c,i,a,u,e[d+0],11,-358537222),u=f(u,c,i,a,e[d+3],16,-722521979),a=f(a,u,c,i,e[d+6],23,76029189),i=f(i,a,u,c,e[d+9],4,-640364487),c=f(c,i,a,u,e[d+12],11,-421815835),u=f(u,c,i,a,e[d+15],16,530742520),a=f(a,u,c,i,e[d+2],23,-995338651),i=g(i,a,u,c,e[d+0],6,-198630844),c=g(c,i,a,u,e[d+7],10,1126891415),u=g(u,c,i,a,e[d+14],15,-1416354905),a=g(a,u,c,i,e[d+5],21,-57434055),i=g(i,a,u,c,e[d+12],6,1700485571),c=g(c,i,a,u,e[d+3],10,-1894986606),u=g(u,c,i,a,e[d+10],15,-1051523),a=g(a,u,c,i,e[d+1],21,-2054922799),i=g(i,a,u,c,e[d+8],6,1873313359),c=g(c,i,a,u,e[d+15],10,-30611744),u=g(u,c,i,a,e[d+6],15,-1560198380),a=g(a,u,c,i,e[d+13],21,1309151649),i=g(i,a,u,c,e[d+4],6,-145523070),c=g(c,i,a,u,e[d+11],10,-1120210379),u=g(u,c,i,a,e[d+2],15,718787259),a=g(a,u,c,i,e[d+9],21,-343485551),i=l(i,n),a=l(a,s),u=l(u,r),c=l(c,o);return[i,a,u,c]},o={hexdigest:function(e){return function(e){for(var t="0123456789abcdef",n="",s=0;s<4*e.length;s++)n+=t.charAt(e[s>>2]>>s%4*8+4&15)+t.charAt(e[s>>2]>>s%4*8&15);return n}(r(s(e),8*e.length))},hash:function(e){return function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(r(s(e),8*e.length))}}},"./src/sha1.js":function(e,t,n){"use strict";function a(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,s,r,o,i,a,u,c,d,l=new Array(80),h=1732584193,p=-271733879,f=-1732584194,g=271733878,E=-1009589776;for(n=0;n<e.length;n+=16){for(o=h,i=p,a=f,u=g,c=E,s=0;s<80;s++)l[s]=s<16?e[n+s]:S(l[s-3]^l[s-8]^l[s-14]^l[s-16],1),r=C(C(S(h,5),_(s,p,f,g)),C(C(E,l[s]),(d=s)<20?1518500249:d<40?1859775393:d<60?-1894007588:-899497514)),E=g,g=f,f=S(p,30),p=h,h=r;h=C(h,o),p=C(p,i),f=C(f,a),g=C(g,u),E=C(E,c)}return[h,p,f,g,E]}function _(e,t,n,s){return e<20?t&n|~t&s:e<40?t^n^s:e<60?t&n|t&s|n&s:t^n^s}function s(e,t){var n=u(e);16<n.length&&(n=a(n,8*e.length));for(var s=new Array(16),r=new Array(16),o=0;o<16;o++)s[o]=909522486^n[o],r[o]=1549556828^n[o];var i=a(s.concat(u(t)),512+8*t.length);return a(r.concat(i),672)}function C(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function S(e,t){return e<<t|e>>>32-t}function u(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function r(e){for(var t,n,s="",r=0;r<4*e.length;r+=3)for(t=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,n=0;n<4;n++)8*r+6*n>32*e.length?s+="=":s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return s}function o(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}n.r(t),n.d(t,"default",function(){return i});var i={b64_hmac_sha1:function(e,t){return r(s(e,t))},b64_sha1:function(e){return r(a(u(e),8*e.length))},binb2str:o,core_hmac_sha1:s,str_hmac_sha1:function(e,t){return o(s(e,t))},str_sha1:function(e){return o(a(u(e),8*e.length))}}},"./src/strophe.js":function(e,t,n){"use strict";n.r(t);n("./src/bosh.js"),n("./src/websocket.js");var s=n("./src/core.js");n.d(t,"default",function(){return s.default})},"./src/utils.js":function(e,t,n){"use strict";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.r(t),n.d(t,"default",function(){return s});var s={utf16to8:function(e){var t,n,s="",r=e.length;for(t=0;t<r;t++)0<=(n=e.charCodeAt(t))&&n<=127?s+=e.charAt(t):(2047<n?(s+=String.fromCharCode(224|n>>12&15),s+=String.fromCharCode(128|n>>6&63)):s+=String.fromCharCode(192|n>>6&31),s+=String.fromCharCode(128|n>>0&63));return s},addCookies:function(e){for(var t in e=e||{})if(Object.prototype.hasOwnProperty.call(e,t)){var n="",s="",r="",o=e[t],i="object"===u(o),a=escape(unescape(i?o.value:o));i&&(n=o.expires?";expires="+o.expires:"",s=o.domain?";domain="+o.domain:"",r=o.path?";path="+o.path:""),document.cookie=t+"="+a+n+s+r}}}},"./src/websocket.js":function(e,t,n){"use strict";n.r(t);var s=n("./src/core.js"),c=s.default.Strophe,r=s.default.$build;c.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},c.Websocket.prototype={_buildStream:function(){return r("open",{xmlns:c.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,t){var n;if(0===(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(c.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var s=n[0],r="",o="",i=0;i<s.childNodes.length;i++){var a=s.childNodes[i];if("urn:ietf:params:xml:ns:xmpp-streams"!==a.getAttribute("xmlns"))break;"text"===a.nodeName?o=a.textContent:r=a.nodeName}var u="WebSocket stream error: ";return u+=r||"unknown",o&&(u+=" - "+o),c.error(u),this._conn._changeConnectStatus(t,r),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,c.Status.CONNFAIL))return c.Status.CONNFAIL},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==c.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);var s=e.getAttribute("version");return"string"!=typeof s?t="Missing version in <open />":"1.0"!==s&&(t="Wrong version in <open />: "+s),!t||(this._conn._changeConnectStatus(c.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){var s=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(s),this._conn.rawInput(e.data);var r=s.getAttribute("see-other-uri");if(r){var o=this._conn.service;(0<=o.indexOf("wss:")&&0<=r.indexOf("wss:")||0<=o.indexOf("ws:"))&&(this._conn._changeConnectStatus(c.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=r,this._connect())}else this._conn._changeConnectStatus(c.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var i=this._streamWrap(e.data),a=(new DOMParser).parseFromString(i,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(a,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t=r("close",{xmlns:c.NS.FRAMING});this._conn.xmlOutput(t.tree());var n=c.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){c.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){c.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(e){c.debug(e.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(c.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(c.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(c.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):c.info("Websocket closed")},_no_auth_received:function(e){c.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(c.Status.CONNFAIL,c.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){c.error("Websocket error "+e),this._conn._changeConnectStatus(c.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(0<e.length&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n=void 0;n="restart"===e[t]?this._buildStream().tree():e[t];var s=c.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(s),this.socket.send(s)}this._conn._data=[]}},_onMessage:function(e){var t,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{var s=this._streamWrap(e.data);t=(new DOMParser).parseFromString(s,"text/xml").documentElement}return this._check_streamerror(t,c.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(c.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){c.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=c.serialize(e);this._conn.rawOutput(t),this.socket.send(t)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}}).default},e.exports=s()},function(e,t,n){"use strict";t.__esModule=!0;var o=n(19),i=n(8),a=n(20),c=n(5),r=n(9),d=n(1),l=n(0),h=n(7),p=n(15),f=n(17),g=n(40),E=n(41),_=n(42),C=n(27),s=function(){function u(){}return u.trasformXMPPMessage=function(e){var t={};try{var n=JSON.parse(unescape(i.parseHTML(e.getElementsByTagName("body")[0])).trim().toString());t=this.trasformJSONMessge(n)}catch(e){d.Logger.error("MessageController:transformXMPPMessage",{e:e})}return t},u.trasformJSONMessge=function(n){var e;switch(n[l.MessageConstatnts.KEYS.CATEGORY]){case l.MessageConstatnts.CATEGORY.ACTION:e=p.Action.actionFromJSON(n);break;case l.MessageConstatnts.CATEGORY.CALL:e=f.Call.callFromJSON(n);break;case l.MessageConstatnts.CATEGORY.MESSAGE:switch(n[l.MessageConstatnts.KEYS.TYPE]){case l.MessageConstatnts.TYPE.TEXT:e=new o.TextMessage(n[l.MessageConstatnts.KEYS.RECEIVER],n[l.MessageConstatnts.KEYS.DATA][l.MessageConstatnts.KEYS.TEXT],n[l.MessageConstatnts.KEYS.TYPE],n[l.MessageConstatnts.KEYS.RECEIVER_TYPE]);break;case l.MessageConstatnts.TYPE.CUSTOM:e=new C.CustomMessage(n[l.MessageConstatnts.KEYS.RECEIVER],n[l.MessageConstatnts.KEYS.DATA][l.MessageConstatnts.KEYS.CUSTOM_DATA],n[l.MessageConstatnts.KEYS.RECEIVER_TYPE]);break;default:if(e=new a.MediaMessage(n[l.MessageConstatnts.KEYS.RECEIVER],n[l.MessageConstatnts.KEYS.DATA][l.MessageConstatnts.KEYS.URL],n[l.MessageConstatnts.KEYS.TYPE],n[l.MessageConstatnts.KEYS.RECEIVER_TYPE]),n.hasOwnProperty(l.MessageConstatnts.KEYS.DATA)){var t=n[l.MessageConstatnts.KEYS.DATA];if(t.hasOwnProperty(l.MessageConstatnts.KEYS.ATTATCHMENTS)){var s,r=t[l.MessageConstatnts.KEYS.ATTATCHMENTS];new Array;r.map(function(e){s=new _.Attachment(e)}),e.setAttachment(s)}t.hasOwnProperty(l.MessageConstatnts.KEYS.TEXT)&&e.setCaption(t[l.MessageConstatnts.KEYS.TEXT])}}break;default:d.Logger.log("MessageConroller:trasformJSONMessge","Default case")}n[l.MessageConstatnts.KEYS.RECEIPTS]&&(n[l.MessageConstatnts.KEYS.RECEIPTS]=n[l.MessageConstatnts.KEYS.RECEIPTS][l.MessageConstatnts.KEYS.DATA],n[l.MessageConstatnts.KEYS.RECEIPTS].map(function(e){var t=new E.MessageReceipt;e[l.DELIVERY_RECEIPTS.DELIVERED_AT]&&(t.setReceiptType(t.RECEIPT_TYPE.DELIVERY_RECEIPT),t.setSender(e[l.DELIVERY_RECEIPTS.RECIPIENT]),t.setReceiverType(n[l.MessageConstatnts.KEYS.RECEIVER_TYPE]),t.setReceiver(n[l.MessageConstatnts.KEYS.RECEIVER]))}));try{if(Object.assign(e,n),(n=e)instanceof o.TextMessage){n.setSender(n.getSender()),n.getData()[l.MessageConstatnts.KEYS.METADATA]&&n.setMetadata(n.getData()[l.MessageConstatnts.KEYS.METADATA]);try{n.setProcessedText(g.default.parse(n.getText()))}catch(e){}}else if(n instanceof a.MediaMessage)n.getData()[l.MessageConstatnts.KEYS.METADATA]&&n.setMetadata(n.getData()[l.MessageConstatnts.KEYS.METADATA]),n.setSender(n.getSender());else if(n instanceof p.Action)n.setSender(n.getSender()),n.setActionBy(n.getActionBy()),n.setActionOn(n.getActionOn()),n.setActionFor(n.getActionFor()),n.setMessage(n.getMessage());else if(n instanceof f.Call){try{n.setSender(n.getSender())}catch(e){d.Logger.error("MessageController:trasformJSONMessge:setSender",e)}try{n.setCallInitiator(n.getCallInitiator())}catch(e){d.Logger.error("MessageController:trasformJSONMessge:setCallInitiator",e)}try{n.setCallReceiver(n.getCallReceiver())}catch(e){d.Logger.error("MessageController:trasformJSONMessge:setCallreceiver",e)}d.Logger.log("MessageController:transformJSONMessage",n)}else n instanceof C.CustomMessage&&(n.getData()[l.MessageConstatnts.KEYS.METADATA]&&n.setMetadata(n.getData()[l.MessageConstatnts.KEYS.METADATA]),n.setSubType(n.getData()[l.MessageConstatnts.KEYS.CUSTOM_SUB_TYPE]),n.setSender(n.getSender()))}catch(e){d.Logger.error("MessageController:trasformJSONMessge:Main",e),n=null}return n},u.getOfflineHistory=function(e,t){void 0===e&&(e=1e3),void 0===t&&(t=1);var n=r.MessagesStore.getInstance(),s=[];c.makeApiCall("getMessages",{},this.createData(e,t)).then(function(e){return d.isFalsy(e.data)||e.data.map(function(e){h.XMPPConnectionHelper.getInstance().trigerMessageHandler(e),s.push(u.trasformJSONMessge(e))}),n.storeMessages(s)})},u.getAllMessage=function(n,s,r,o){var i=this;void 0===n&&(n=100);var a=[];return new Promise(function(t,e){c.makeApiCall("getMessages",{},i.createAllMessageData(n,s,r,o)).then(function(e){d.isFalsy(e.data)||(e.data.map(function(e){a.push(u.trasformJSONMessge(e))}),t(a))},function(e){d.Logger.error("Error on fetching all message",e),t([])})})},u.createData=function(e,t){return void 0===t&&(t=0),{per_page:e,cursorValue:t,cursorField:l.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,cursorAffix:d.isFalsy(t)?l.MessageConstatnts.PAGINATION.AFFIX.PREPEND:l.MessageConstatnts.PAGINATION.AFFIX.APPEND}},u.createAllMessageData=function(e,t,n,s){return{per_page:e,cursorValue:t,cursorField:n,cursorAffix:s}},u.isDeliveryReceipt=function(e){return!d.isFalsy(e.getElementsByTagName(l.DELIVERY_RECEIPTS.RECEIVED))},u.isReadRceipt=function(e){return!d.isFalsy(e.getElementsByTagName(l.READ_RECEIPTS.READ))},u.processDeliveryReceipt=function(o){return new Promise(function(n,e){var s=o.getElementsByTagName(l.DELIVERY_RECEIPTS.RECEIVED)[0],r=o.getElementsByTagName(l.DELIVERY_RECEIPTS.DELIVERED_AT)[0];h.XMPPConnectionHelper.getInstance().getUsersVCard(i.getUidFromJid(o.getAttribute(l.MessageConstatnts.XMPP_KEYS.FROM)),function(e){var t=new E.MessageReceipt;t.setSender(e),s.getAttribute(l.DELIVERY_RECEIPTS.RECEIVER_TYPE)==l.MessageConstatnts.RECEIVER_TYPE.GROUP?(t.setReceiverType(l.MessageConstatnts.RECEIVER_TYPE.GROUP),t.setReceiver(s.getAttribute(l.DELIVERY_RECEIPTS.RECEIVER_ID))):(t.setReceiverType(l.MessageConstatnts.RECEIVER_TYPE.USER),t.setReceiver(i.getUidFromJid(o.getAttribute(l.MessageConstatnts.XMPP_KEYS.TO)))),t.setReceiptType(t.RECEIPT_TYPE.DELIVERY_RECEIPT),t.setMessageId(i.getmessageIdFromStanzaId(s.getAttribute(l.DELIVERY_RECEIPTS.ID))),t.setTimestamp(r.getAttribute(l.DELIVERY_RECEIPTS.TIME)),n(t)})})},u.processReadReceipt=function(o){return new Promise(function(n,e){var s=o.getElementsByTagName(l.READ_RECEIPTS.READ)[0],r=o.getElementsByTagName(l.READ_RECEIPTS.READ_AT)[0];h.XMPPConnectionHelper.getInstance().getUsersVCard(i.getUidFromJid(o.getAttribute(l.MessageConstatnts.XMPP_KEYS.FROM)),function(e){var t=new E.MessageReceipt;t.setSender(e),s.getAttribute(l.READ_RECEIPTS.RECEIVER_TYPE)==l.MessageConstatnts.RECEIVER_TYPE.GROUP?(t.setReceiverType(l.MessageConstatnts.RECEIVER_TYPE.GROUP),t.setReceiver(s.getAttribute(l.READ_RECEIPTS.RECEIVER_ID))):(t.setReceiverType(l.MessageConstatnts.RECEIVER_TYPE.USER),t.setReceiver(i.getUidFromJid(o.getAttribute(l.MessageConstatnts.XMPP_KEYS.TO)))),t.setReceiptType(t.RECEIPT_TYPE.READ_RECEIPT),t.setMessageId(i.getmessageIdFromStanzaId(s.getAttribute(l.READ_RECEIPTS.ID))),t.setTimestamp(r.getAttribute(l.READ_RECEIPTS.TIME)),n(t)})})},u}();t.MessageController=s},function(e,t,n){"use strict";t.__esModule=!0;var s=function(){function e(e,t,n,s){this.receiver=e,this.type=t,this.receiverType=n,this.category=s}return e.prototype.getId=function(){return this.id},e.prototype.setId=function(e){this.id=e},e.prototype.getMuid=function(){return this.muid},e.prototype.setMuid=function(e){this.muid=e},e.prototype.getSender=function(){return this.sender},e.prototype.setSender=function(e){this.sender=e},e.prototype.getReceiver=function(){return this.receiver},e.prototype.setReceiver=function(e){this.receiver=e},e.prototype.getType=function(){return this.type},e.prototype.setType=function(e){this.type=e},e.prototype.get=function(){return this.id},e.prototype.setReceiverType=function(e){this.receiverType=e},e.prototype.getReceiverType=function(){return this.receiverType},e.prototype.setSentAt=function(e){this.sentAt=e},e.prototype.getSentAt=function(){return this.sentAt},e.prototype.getStatus=function(){return this.status},e.prototype.setStatus=function(e){this.status=e},e.prototype.getDeliveredAt=function(){return this.deliveredAt},e.prototype.setDeliveredAt=function(e){this.deliveredAt=e},e.prototype.getReadAt=function(){return this.readAt},e.prototype.setReadAt=function(e){this.readAt=e},e}();t.BaseMessage=s},function(e,t,n){(function(s){e.exports=function r(o,i,a){function u(n,e){if(!i[n]){if(!o[n]){if(c)return c(n,!0);var t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}var s=i[n]={exports:{}};o[n][0].call(s.exports,function(e){var t=o[n][1][e];return u(t||e)},s,s.exports,r,o,i,a)}return i[n].exports}for(var c=!1,e=0;e<a.length;e++)u(a[e]);return u}({1:[function(e,d,t){(function(t){"use strict";var n,s,e=t.MutationObserver||t.WebKitMutationObserver;if(e){var r=0,o=new e(c),i=t.document.createTextNode("");o.observe(i,{characterData:!0}),n=function(){i.data=r=++r%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)};else{var a=new t.MessageChannel;a.port1.onmessage=c,n=function(){a.port2.postMessage(0)}}var u=[];function c(){var e,t;s=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}s=!1}d.exports=function(e){1!==u.push(e)||s||n()}}).call(this,void 0!==s?s:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function c(){}var d={},o=["REJECTED"],i=["FULFILLED"],a=["PENDING"];function s(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=a,this.queue=[],this.outcome=void 0,e!==c&&p(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function l(t,n,s){r(function(){var e;try{e=n(s)}catch(e){return d.reject(t,e)}e===t?d.reject(t,new TypeError("Cannot resolve promise with itself")):d.resolve(t,e)})}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(t,e){var n=!1;function s(e){n||(n=!0,d.reject(t,e))}function r(e){n||(n=!0,d.resolve(t,e))}var o=f(function(){e(r,s)});"error"===o.status&&s(o.value)}function f(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=s).prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){if("function"!=typeof e&&this.state===i||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(c);if(this.state!==a){var s=this.state===i?e:t;l(n,s,this.outcome)}else this.queue.push(new u(n,e,t));return n},u.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){d.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},d.resolve=function(e,t){var n=f(h,t);if("error"===n.status)return d.reject(e,n.value);var s=n.value;if(s)p(e,s);else{e.state=i,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callFulfilled(t)}return e},d.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,s=e.queue.length;++n<s;)e.queue[n].callRejected(t);return e},s.resolve=function(e){return e instanceof this?e:d.resolve(new this(c),e)},s.reject=function(e){var t=new this(c);return d.reject(t,e)},s.all=function(e){var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,r=!1;if(!s)return this.resolve([]);for(var o=new Array(s),i=0,t=-1,a=new this(c);++t<s;)u(e[t],t);return a;function u(e,t){n.resolve(e).then(function(e){o[t]=e,++i!==s||r||(r=!0,d.resolve(a,o))},function(e){r||(r=!0,d.reject(a,e))})}},s.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return this.resolve([]);for(var r,o=-1,i=new this(c);++o<n;)r=e[o],t.resolve(r).then(function(e){s||(s=!0,d.resolve(i,e))},function(e){s||(s=!0,d.reject(i,e))});return i}},{1:1}],3:[function(t,e,n){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==s?s:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function i(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(e){if("TypeError"!==e.name)throw e;for(var s="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,r=new s,o=0;o<t.length;o+=1)r.append(t[o]);return r.getBlob(n.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function h(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function d(e){return"string"!=typeof e&&(e=String(e)),e}function o(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var a="local-forage-detect-blob-support",r=void 0,p={},f=Object.prototype.toString,g="readonly",E="readwrite";function _(e){return"boolean"==typeof r?l.resolve(r):(s=e,new l(function(n){var e=s.transaction(a,E),t=i([""]);e.objectStore(a).put(t,"key"),e.onabort=function(e){e.preventDefault(),e.stopPropagation(),n(!1)},e.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),t=navigator.userAgent.match(/Edge\//);n(t||!e||43<=parseInt(e[1],10))}}).catch(function(){return!1})).then(function(e){return r=e});var s}function C(e){var t=p[e.name],n={};n.promise=new l(function(e,t){n.resolve=e,n.reject=t}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function S(e){var t=p[e.name],n=t.deferredOperations.pop();if(n)return n.resolve(),n.promise}function m(e,t){var n=p[e.name],s=n.deferredOperations.pop();if(s)return s.reject(t),s.promise}function T(r,o){return new l(function(e,t){if(p[r.name]=p[r.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},r.db){if(!o)return e(r.db);C(r),r.db.close()}var n=[r.name];o&&n.push(r.version);var s=u.open.apply(u,n);o&&(s.onupgradeneeded=function(e){var t=s.result;try{t.createObjectStore(r.storeName),e.oldVersion<=1&&t.createObjectStore(a)}catch(e){if("ConstraintError"!==e.name)throw e}}),s.onerror=function(e){e.preventDefault(),t(s.error)},s.onsuccess=function(){e(s.result),S(r)}})}function A(e){return T(e,!1)}function I(e){return T(e,!0)}function y(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,r=e.version>e.db.version;if(s&&(e.version,e.version=e.db.version),r||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function R(e){var t=function(e){for(var t=e.length,n=new ArrayBuffer(t),s=new Uint8Array(n),r=0;r<t;r++)s[r]=e.charCodeAt(r);return n}(atob(e.data));return i([t],{type:e.type})}function M(e){return e&&e.__local_forage_encoded_blob}function v(e){var t=this,n=t._initReady().then(function(){var e=p[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return c(n,e,e),n}function N(t,n,s,r){void 0===r&&(r=1);try{var e=t.db.transaction(t.storeName,n);s(null,e)}catch(e){if(0<r&&(!t.db||"InvalidStateError"===e.name||"NotFoundError"===e.name))return l.resolve().then(function(){if(!t.db||"NotFoundError"===e.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),I(t)}).then(function(){return function(n){C(n);for(var s=p[n.name],r=s.forages,e=0;e<r.length;e++){var t=r[e];t._dbInfo.db&&(t._dbInfo.db.close(),t._dbInfo.db=null)}return n.db=null,A(n).then(function(e){return n.db=e,y(n)?I(n):e}).then(function(e){n.db=s.db=e;for(var t=0;t<r.length;t++)r[t]._dbInfo.db=e}).catch(function(e){throw m(n,e),e})}(t).then(function(){N(t,n,s,r-1)})}).catch(s);s(e)}}var O={_driver:"asyncStorage",_initStorage:function(e){var s=this,r={db:null};if(e)for(var t in e)r[t]=e[t];var o=p[r.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},p[r.name]=o),o.forages.push(s),s._initReady||(s._initReady=s.ready,s.ready=v);var n=[];function i(){return l.resolve()}for(var a=0;a<o.forages.length;a++){var u=o.forages[a];u!==s&&n.push(u._initReady().catch(i))}var c=o.forages.slice(0);return l.all(n).then(function(){return r.db=o.db,A(r)}).then(function(e){return r.db=e,y(r,s._defaultConfig.version)?I(r):e}).then(function(e){r.db=o.db=e,s._dbInfo=r;for(var t=0;t<c.length;t++){var n=c[t];n!==s&&(n._dbInfo.db=r.db,n._dbInfo.version=r.version)}})},_support:function(){try{if(!u)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(a,e){var u=this,t=new l(function(o,i){u.ready().then(function(){N(u._dbInfo,g,function(e,t){if(e)return i(e);try{var n=t.objectStore(u._dbInfo.storeName),s=n.openCursor(),r=1;s.onsuccess=function(){var e=s.result;if(e){var t=e.value;M(t)&&(t=R(t));var n=a(t,e.key,r++);void 0!==n?o(n):e.continue()}else o()},s.onerror=function(){i(s.error)}}catch(e){i(e)}})}).catch(i)});return h(t,e),t},getItem:function(i,e){var a=this;i=d(i);var t=new l(function(r,o){a.ready().then(function(){N(a._dbInfo,g,function(e,t){if(e)return o(e);try{var n=t.objectStore(a._dbInfo.storeName),s=n.get(i);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),M(e)&&(e=R(e)),r(e)},s.onerror=function(){o(s.error)}}catch(e){o(e)}})}).catch(o)});return h(t,e),t},setItem:function(a,t,e){var u=this;a=d(a);var n=new l(function(o,i){var e;u.ready().then(function(){return e=u._dbInfo,"[object Blob]"===f.call(t)?_(e.db).then(function(e){return e?t:(s=t,new l(function(n,e){var t=new FileReader;t.onerror=e,t.onloadend=function(e){var t=btoa(e.target.result||"");n({__local_forage_encoded_blob:!0,data:t,type:s.type})},t.readAsBinaryString(s)}));var s}):t}).then(function(r){N(u._dbInfo,E,function(e,t){if(e)return i(e);try{var n=t.objectStore(u._dbInfo.storeName);null===r&&(r=void 0);var s=n.put(r,a);t.oncomplete=function(){void 0===r&&(r=null),o(r)},t.onabort=t.onerror=function(){var e=s.error?s.error:s.transaction.error;i(e)}}catch(e){i(e)}})}).catch(i)});return h(n,e),n},removeItem:function(i,e){var a=this;i=d(i);var t=new l(function(r,o){a.ready().then(function(){N(a._dbInfo,E,function(e,t){if(e)return o(e);try{var n=t.objectStore(a._dbInfo.storeName),s=n.delete(i);t.oncomplete=function(){r()},t.onerror=function(){o(s.error)},t.onabort=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(e){o(e)}})}).catch(o)});return h(t,e),t},clear:function(e){var i=this,t=new l(function(r,o){i.ready().then(function(){N(i._dbInfo,E,function(e,t){if(e)return o(e);try{var n=t.objectStore(i._dbInfo.storeName),s=n.clear();t.oncomplete=function(){r()},t.onabort=t.onerror=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(e){o(e)}})}).catch(o)});return h(t,e),t},length:function(e){var i=this,t=new l(function(r,o){i.ready().then(function(){N(i._dbInfo,g,function(e,t){if(e)return o(e);try{var n=t.objectStore(i._dbInfo.storeName),s=n.count();s.onsuccess=function(){r(s.result)},s.onerror=function(){o(s.error)}}catch(e){o(e)}})}).catch(o)});return h(t,e),t},key:function(a,e){var u=this,t=new l(function(o,i){a<0?o(null):u.ready().then(function(){N(u._dbInfo,g,function(e,t){if(e)return i(e);try{var n=t.objectStore(u._dbInfo.storeName),s=!1,r=n.openCursor();r.onsuccess=function(){var e=r.result;e?0===a?o(e.key):s?o(e.key):(s=!0,e.advance(a)):o(null)},r.onerror=function(){i(r.error)}}catch(e){i(e)}})}).catch(i)});return h(t,e),t},keys:function(e){var a=this,t=new l(function(o,i){a.ready().then(function(){N(a._dbInfo,g,function(e,t){if(e)return i(e);try{var n=t.objectStore(a._dbInfo.storeName),s=n.openCursor(),r=[];s.onsuccess=function(){var e=s.result;e?(r.push(e.key),e.continue()):o(r)},s.onerror=function(){i(s.error)}}catch(e){i(e)}})}).catch(i)});return h(t,e),t},dropInstance:function(a,e){e=o.apply(this,arguments);var t,n=this.config();if((a="function"!=typeof a&&a||{}).name||(a.name=a.name||n.name,a.storeName=a.storeName||n.storeName),a.name){var s=a.name===n.name&&this._dbInfo.db,r=s?l.resolve(this._dbInfo.db):A(a).then(function(e){var t=p[a.name],n=t.forages;t.db=e;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=e;return e});t=a.storeName?r.then(function(e){if(e.objectStoreNames.contains(a.storeName)){var r=e.version+1;C(a);var s=p[a.name],o=s.forages;e.close();for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=null,n._dbInfo.version=r}var i=new l(function(t,n){var s=u.open(a.name,r);s.onerror=function(e){var t=s.result;t.close(),n(e)},s.onupgradeneeded=function(){var e=s.result;e.deleteObjectStore(a.storeName)},s.onsuccess=function(){var e=s.result;e.close(),t(e)}});return i.then(function(e){s.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,S(n._dbInfo)}}).catch(function(e){throw(m(a,e)||l.resolve()).catch(function(){}),e})}}):r.then(function(e){C(a);var s=p[a.name],r=s.forages;e.close();for(var t=0;t<r.length;t++){var n=r[t];n._dbInfo.db=null}var o=new l(function(t,n){var s=u.deleteDatabase(a.name);s.onerror=s.onblocked=function(e){var t=s.result;t&&t.close(),n(e)},s.onsuccess=function(){var e=s.result;e&&e.close(),t(e)}});return o.then(function(e){s.db=e;for(var t=0;t<r.length;t++){var n=r[t];S(n._dbInfo)}}).catch(function(e){throw(m(a,e)||l.resolve()).catch(function(){}),e})})}else t=l.reject("Invalid arguments");return h(t,e),t}},P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=/^~~local_forage_type~([^~]+)~/,b="__lfsc__:",w=b.length,D="arbf",Y="blob",U=w+D.length,G=Object.prototype.toString;function x(e){var t,n,s,r,o,i=.75*e.length,a=e.length,u=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var c=new ArrayBuffer(i),d=new Uint8Array(c);for(t=0;t<a;t+=4)n=P.indexOf(e[t]),s=P.indexOf(e[t+1]),r=P.indexOf(e[t+2]),o=P.indexOf(e[t+3]),d[u++]=n<<2|s>>4,d[u++]=(15&s)<<4|r>>2,d[u++]=(3&r)<<6|63&o;return c}function F(e){var t,n=new Uint8Array(e),s="";for(t=0;t<n.length;t+=3)s+=P[n[t]>>2],s+=P[(3&n[t])<<4|n[t+1]>>4],s+=P[(15&n[t+1])<<2|n[t+2]>>6],s+=P[63&n[t+2]];return n.length%3==2?s=s.substring(0,s.length-1)+"=":n.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}var K={serialize:function(t,n){var e="";if(t&&(e=G.call(t)),t&&("[object ArrayBuffer]"===e||t.buffer&&"[object ArrayBuffer]"===G.call(t.buffer))){var s,r=b;t instanceof ArrayBuffer?(s=t,r+=D):(s=t.buffer,"[object Int8Array]"===e?r+="si08":"[object Uint8Array]"===e?r+="ui08":"[object Uint8ClampedArray]"===e?r+="uic8":"[object Int16Array]"===e?r+="si16":"[object Uint16Array]"===e?r+="ur16":"[object Int32Array]"===e?r+="si32":"[object Uint32Array]"===e?r+="ui32":"[object Float32Array]"===e?r+="fl32":"[object Float64Array]"===e?r+="fl64":n(new Error("Failed to get type for BinaryArray"))),n(r+F(s))}else if("[object Blob]"===e){var o=new FileReader;o.onload=function(){var e="~~local_forage_type~"+t.type+"~"+F(this.result);n(b+Y+e)},o.readAsArrayBuffer(t)}else try{n(JSON.stringify(t))}catch(e){n(null,e)}},deserialize:function(e){if(e.substring(0,w)!==b)return JSON.parse(e);var t,n=e.substring(U),s=e.substring(w,U);if(s===Y&&L.test(n)){var r=n.match(L);t=r[1],n=n.substring(r[0].length)}var o=x(n);switch(s){case D:return o;case Y:return i([o],{type:t});case"si08":return new Int8Array(o);case"ui08":return new Uint8Array(o);case"uic8":return new Uint8ClampedArray(o);case"si16":return new Int16Array(o);case"ur16":return new Uint16Array(o);case"si32":return new Int32Array(o);case"ui32":return new Uint32Array(o);case"fl32":return new Float32Array(o);case"fl64":return new Float64Array(o);default:throw new Error("Unkown type: "+s)}},stringToBuffer:x,bufferToString:F};function H(e,t,n,s){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,s)}function k(e,s,r,o,i,a){e.executeSql(r,o,i,function(e,n){n.code===n.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[s.storeName],function(e,t){t.rows.length?a(e,n):H(e,s,function(){e.executeSql(r,o,i,a)},a)},a):a(e,n)},a)}function B(i,e,a,u){var c=this;i=d(i);var t=new l(function(r,o){c.ready().then(function(){void 0===e&&(e=null);var n=e,s=c._dbInfo;s.serializer.serialize(e,function(t,e){e?o(e):s.db.transaction(function(e){k(e,s,"INSERT OR REPLACE INTO "+s.storeName+" (key, value) VALUES (?, ?)",[i,t],function(){r(n)},function(e,t){o(t)})},function(e){if(e.code===e.QUOTA_ERR){if(0<u)return void r(B.apply(c,[i,n,a,u-1]));o(e)}})})}).catch(o)});return h(t,a),t}var j={_driver:"webSQLStorage",_initStorage:function(e){var s=this,r={db:null};if(e)for(var t in e)r[t]="string"!=typeof e[t]?e[t].toString():e[t];var n=new l(function(t,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return n(e)}r.db.transaction(function(e){H(e,r,function(){s._dbInfo=r,t()},function(e,t){n(t)})},n)});return r.serializer=K,n},_support:"function"==typeof openDatabase,iterate:function(c,e){var t=this,n=new l(function(u,n){t.ready().then(function(){var a=t._dbInfo;a.db.transaction(function(e){k(e,a,"SELECT * FROM "+a.storeName,[],function(e,t){for(var n=t.rows,s=n.length,r=0;r<s;r++){var o=n.item(r),i=o.value;if(i&&(i=a.serializer.deserialize(i)),void 0!==(i=c(i,o.key,r+1)))return void u(i)}u()},function(e,t){n(t)})})}).catch(n)});return h(n,e),n},getItem:function(t,e){var o=this;t=d(t);var n=new l(function(r,n){o.ready().then(function(){var s=o._dbInfo;s.db.transaction(function(e){k(e,s,"SELECT * FROM "+s.storeName+" WHERE key = ? LIMIT 1",[t],function(e,t){var n=t.rows.length?t.rows.item(0).value:null;n&&(n=s.serializer.deserialize(n)),r(n)},function(e,t){n(t)})})}).catch(n)});return h(n,e),n},setItem:function(e,t,n){return B.apply(this,[e,t,n,1])},removeItem:function(r,e){var o=this;r=d(r);var t=new l(function(n,s){o.ready().then(function(){var t=o._dbInfo;t.db.transaction(function(e){k(e,t,"DELETE FROM "+t.storeName+" WHERE key = ?",[r],function(){n()},function(e,t){s(t)})})}).catch(s)});return h(t,e),t},clear:function(e){var r=this,t=new l(function(n,s){r.ready().then(function(){var t=r._dbInfo;t.db.transaction(function(e){k(e,t,"DELETE FROM "+t.storeName,[],function(){n()},function(e,t){s(t)})})}).catch(s)});return h(t,e),t},length:function(e){var r=this,t=new l(function(s,n){r.ready().then(function(){var t=r._dbInfo;t.db.transaction(function(e){k(e,t,"SELECT COUNT(key) as c FROM "+t.storeName,[],function(e,t){var n=t.rows.item(0).c;s(n)},function(e,t){n(t)})})}).catch(n)});return h(t,e),t},key:function(r,e){var o=this,t=new l(function(s,n){o.ready().then(function(){var t=o._dbInfo;t.db.transaction(function(e){k(e,t,"SELECT key FROM "+t.storeName+" WHERE id = ? LIMIT 1",[r+1],function(e,t){var n=t.rows.length?t.rows.item(0).key:null;s(n)},function(e,t){n(t)})})}).catch(n)});return h(t,e),t},keys:function(e){var s=this,t=new l(function(r,n){s.ready().then(function(){var t=s._dbInfo;t.db.transaction(function(e){k(e,t,"SELECT key FROM "+t.storeName,[],function(e,t){for(var n=[],s=0;s<t.rows.length;s++)n.push(t.rows.item(s).key);r(n)},function(e,t){n(t)})})}).catch(n)});return h(t,e),t},dropInstance:function(n,e){e=o.apply(this,arguments);var s=this.config();(n="function"!=typeof n&&n||{}).name||(n.name=n.name||s.name,n.storeName=n.storeName||s.storeName);var t,r=this;return h(t=n.name?new l(function(e){var t,o;t=n.name===s.name?r._dbInfo.db:openDatabase(n.name,"","",0),n.storeName?e({db:t,storeNames:[n.storeName]}):e((o=t,new l(function(r,n){o.transaction(function(e){e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(e,t){for(var n=[],s=0;s<t.rows.length;s++)n.push(t.rows.item(s).name);r({db:o,storeNames:n})},function(e,t){n(t)})},function(e){n(e)})})))}).then(function(a){return new l(function(o,i){a.db.transaction(function(s){function e(t){return new l(function(e,n){s.executeSql("DROP TABLE IF EXISTS "+t,[],function(){e()},function(e,t){n(t)})})}for(var t=[],n=0,r=a.storeNames.length;n<r;n++)t.push(e(a.storeNames[n]));l.all(t).then(function(){o()}).catch(function(e){i(e)})},function(e){i(e)})})}):l.reject("Invalid arguments"),e),t}};function q(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function X(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||0<localStorage.length}var J={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=q(e,this._defaultConfig),X()?((this._dbInfo=t).serializer=K,l.resolve()):l.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(u,e){var c=this,t=c.ready().then(function(){for(var e=c._dbInfo,t=e.keyPrefix,n=t.length,s=localStorage.length,r=1,o=0;o<s;o++){var i=localStorage.key(o);if(0===i.indexOf(t)){var a=localStorage.getItem(i);if(a&&(a=e.serializer.deserialize(a)),void 0!==(a=u(a,i.substring(n),r++)))return a}}});return h(t,e),t},getItem:function(n,e){var s=this;n=d(n);var t=s.ready().then(function(){var e=s._dbInfo,t=localStorage.getItem(e.keyPrefix+n);return t&&(t=e.serializer.deserialize(t)),t});return h(t,e),t},setItem:function(i,e,t){var a=this;i=d(i);var n=a.ready().then(function(){void 0===e&&(e=null);var o=e;return new l(function(n,s){var r=a._dbInfo;r.serializer.serialize(e,function(e,t){if(t)s(t);else try{localStorage.setItem(r.keyPrefix+i,e),n(o)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}})})});return h(n,t),n},removeItem:function(t,e){var n=this;t=d(t);var s=n.ready().then(function(){var e=n._dbInfo;localStorage.removeItem(e.keyPrefix+t)});return h(s,e),s},clear:function(e){var s=this,t=s.ready().then(function(){for(var e=s._dbInfo.keyPrefix,t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}});return h(t,e),t},length:function(e){var t=this.keys().then(function(e){return e.length});return h(t,e),t},key:function(n,e){var s=this,t=s.ready().then(function(){var t,e=s._dbInfo;try{t=localStorage.key(n)}catch(e){t=null}return t&&(t=t.substring(e.keyPrefix.length)),t});return h(t,e),t},keys:function(e){var o=this,t=o.ready().then(function(){for(var e=o._dbInfo,t=localStorage.length,n=[],s=0;s<t;s++){var r=localStorage.key(s);0===r.indexOf(e.keyPrefix)&&n.push(r.substring(e.keyPrefix.length))}return n});return h(t,e),t},dropInstance:function(t,e){if(e=o.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var n=this.config();t.name=t.name||n.name,t.storeName=t.storeName||n.storeName}var s,r=this;return h(s=t.name?new l(function(e){t.storeName?e(q(t,r._defaultConfig)):e(t.name+"/")}).then(function(e){for(var t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}}):l.reject("Invalid arguments"),e),s}},V=function(e,t){for(var n=e.length,s=0;s<n;){if((r=e[s])===(o=t)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;s++}var r,o;return!1},W=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},z={},Q={},$={INDEXEDDB:O,WEBSQL:j,LOCALSTORAGE:J},Z=[$.INDEXEDDB._driver,$.WEBSQL._driver,$.LOCALSTORAGE._driver],ee=["dropInstance"],te=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ee),ne={description:"",driver:Z.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function se(t,n){t[n]=function(){var e=arguments;return t.ready().then(function(){return t[n].apply(t,e)})}}function re(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(W(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var oe=function(){function r(e){for(var t in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),$)if($.hasOwnProperty(t)){var n=$[t],s=n._driver;this[t]=s,z[s]||this.defineDriver(n)}this._defaultConfig=re({},ne),this._config=re({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return r.prototype.config=function(e){if("object"!==(void 0===e?"undefined":s(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},r.prototype.defineDriver=function(d,e,t){var n=new l(function(t,n){try{var s=d._driver,e=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!d._driver)return void n(e);for(var r=te.concat("_initStorage"),o=0,i=r.length;o<i;o++){var a=r[o],u=!V(ee,a);if((u||d[a])&&"function"!=typeof d[a])return void n(e)}!function(){for(var e=function(n){return function(){var e=new Error("Method "+n+" is not implemented by the current driver"),t=l.reject(e);return h(t,arguments[arguments.length-1]),t}},t=0,n=ee.length;t<n;t++){var s=ee[t];d[s]||(d[s]=e(s))}}();var c=function(e){z[s],z[s]=d,Q[s]=e,t()};"_support"in d?d._support&&"function"==typeof d._support?d._support().then(c,n):c(!!d._support):c(!0)}catch(e){n(e)}});return c(n,e,t),n},r.prototype.driver=function(){return this._driver||null},r.prototype.getDriver=function(e,t,n){var s=z[e]?l.resolve(z[e]):l.reject(new Error("Driver not found."));return c(s,t,n),s},r.prototype.getSerializer=function(e){var t=l.resolve(K);return c(t,e),t},r.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return c(n,e,e),n},r.prototype.setDriver=function(e,t,n){var o=this;W(e)||(e=[e]);var s=this._getSupportedDrivers(e);function i(){o._config.driver=o.driver()}function a(e){return o._extend(e),i(),o._ready=o._initStorage(o._config),o._ready}var r=null!==this._driverSet?this._driverSet.catch(function(){return l.resolve()}):l.resolve();return this._driverSet=r.then(function(){var e=s[0];return o._dbInfo=null,o._ready=null,o.getDriver(e).then(function(e){var r;o._driver=e._driver,i(),o._wrapLibraryMethodsWithReady(),o._initDriver=(r=s,function(){var n=0;function s(){for(;n<r.length;){var e=r[n];return n++,o._dbInfo=null,o._ready=null,o.getDriver(e).then(a).catch(s)}i();var t=new Error("No available storage method found.");return o._driverSet=l.reject(t),o._driverSet}return s()})})}).catch(function(){i();var e=new Error("No available storage method found.");return o._driverSet=l.reject(e),o._driverSet}),c(this._driverSet,t,n),this._driverSet},r.prototype.supports=function(e){return!!Q[e]},r.prototype._extend=function(e){re(this,e)},r.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,s=e.length;n<s;n++){var r=e[n];this.supports(r)&&t.push(r)}return t},r.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=te.length;e<t;e++)se(this,te[e])},r.prototype.createInstance=function(e){return new r(e)},r}(),ie=new oe;t.exports=ie},{3:3}]},{},[4])(4)}).call(this,n(37))},function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var r=n(1),o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.onAction=void 0,this.onTextMessageReceived=void 0,this.onMediaMessageReceived=void 0,this.onCustomMessageReceived=void 0,this.onCall=void 0,this.onTypingStarted=void 0,this.onTypingEnded=void 0,this.onMessageDelivered=void 0,this.onMessageRead=void 0,r.isFalsy(e[0].onAction)||(this.onAction=e[0].onAction),r.isFalsy(e[0].onTextMessageReceived)||(this.onTextMessageReceived=e[0].onTextMessageReceived),r.isFalsy(e[0].onMediaMessageReceived)||(this.onMediaMessageReceived=e[0].onMediaMessageReceived),r.isFalsy(e[0].onCall)||(this.onCall=e[0].onCall),r.isFalsy(e[0].onTypingStarted)||(this.onTypingStarted=e[0].onTypingStarted),r.isFalsy(e[0].onTypingEnded)||(this.onTypingEnded=e[0].onTypingEnded),r.isFalsy(e[0].onMessageDelivered)||(this.onMessageDelivered=e[0].onMessageDelivered),r.isFalsy(e[0].onMessageRead)||(this.onMessageRead=e[0].onMessageRead),r.isFalsy(e[0].onCustomMessageReceived)||(this.onCustomMessageReceived=e[0].onCustomMessageReceived)};t.MessageEventListener=o;var a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.onIncomingCallReceived=void 0,this.onOutgoingCallAccepted=void 0,this.onOutgoingCallRejected=void 0,this.onIncomingCallCancelled=void 0,r.isFalsy(e[0].onIncomingCallReceived)||(this.onIncomingCallReceived=e[0].onIncomingCallReceived),r.isFalsy(e[0].onOutgoingCallAccepted)||(this.onOutgoingCallAccepted=e[0].onOutgoingCallAccepted),r.isFalsy(e[0].onOutgoingCallRejected)||(this.onOutgoingCallRejected=e[0].onOutgoingCallRejected),r.isFalsy(e[0].onIncomingCallCancelled)||(this.onIncomingCallCancelled=e[0].onIncomingCallCancelled)};t.CallEventListener=a;var u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.isFalsy(e[0].onUserOnline)||(this.onUserOnline=e[0].onUserOnline),r.isFalsy(e[0].onUserOffline)||(this.onUserOffline=e[0].onUserOffline)};t.UserEventListener=u;var c=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.isFalsy(e[0].onGroupMemberJoined)||(this.onUserJoined=e[0].onGroupMemberJoined),r.isFalsy(e[0].onGroupMemberLeft)||(this.onUserLeft=e[0].onGroupMemberLeft),r.isFalsy(e[0].onGroupMemberKicked)||(this.onUserKicked=e[0].onGroupMemberKicked),r.isFalsy(e[0].onGroupMemberBanned)||(this.onUserBanned=e[0].onGroupMemberBanned),r.isFalsy(e[0].onGroupMemberUnbanned)||(this.onUserUnbanned=e[0].onGroupMemberUnbanned),r.isFalsy(e[0].onGroupMemberScopeChanged)||(this.onMemberScopeChanged=e[0].onGroupMemberScopeChanged)};t.GroupEventListener=c;var d=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.isFalsy(e[0].onYouLeft)||(this.onYouLeft=e[0].onYouLeft),r.isFalsy(e[0].onYouJoined)||(this.onYouJoined=e[0].onYouJoined),r.isFalsy(e[0].onUserJoined)||(this.onUserJoined=e[0].onUserJoined),r.isFalsy(e[0].onUserLeft)||(this.onUserLeft=e[0].onUserLeft),r.isFalsy(e[0].onCallEnded)||(this.onCallEnded=e[0].onCallEnded),r.isFalsy(e[0].onError)||(this.onError=e[0].onError)};t.UserCallEventListener=d;var l=function(e,t){this._name=e,this._callback=t},h=function(o){function e(e,t,n,s){var r=o.call(this,e,s)||this;return r._eventListener=t,n&&(r._cursor=n),r}return i(e,o),e}(t.Listener=l);t.MessageListener=h;var p=function(o){function e(e,t,n,s){var r=o.call(this,e,s)||this;return r._eventListener=t,n&&(r._cursor=n),r}return i(e,o),e}(l);t.UserListener=p;var f=function(o){function e(e,t,n,s){var r=o.call(this,e,s)||this;return r._eventListener=t,n&&(r._cursor=n),r}return i(e,o),e}(l);t.GroupListener=f;var g=function(r){function e(e,t,n){var s=r.call(this,"callListner",n)||this;return s._eventListener=e,s}return i(e,r),e}(l);t.UserCallListener=g;var E=function(o){function e(e,t,n,s){var r=o.call(this,e,s)||this;return r._eventListener=t,r}return i(e,o),e}(l);t.CallListener=E},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var i=n(12),a=n(16),u=n(3),c=n(0),d=n(1),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.actionFromJSON=function(e){var t=new this(e[c.MessageConstatnts.KEYS.RECEIVER],e[c.MessageConstatnts.KEYS.TYPE],e[c.MessageConstatnts.KEYS.RECEIVER_TYPE],c.MessageCategory.ACTION),n=e[c.MessageConstatnts.KEYS.DATA];if(t.data=n,t.setAction(n[c.MessageConstatnts.KEYS.ACTION]),n[c.MessageConstatnts.KEYS.METADATA]&&t.setMetadata(n[c.MessageConstatnts.KEYS.METADATA]),n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY])if(n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==c.ActionConstatnts.ACTION_ENTITY_TYPE.USER){var s=new u.User(n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(s,n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionBy=s,t.setSender(s)}else{var r=new a.Group("","","");Object.assign(r,n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionBy=r}if(n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR])if(n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==c.ActionConstatnts.ACTION_ENTITY_TYPE.USER){s=new u.User(n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(s,n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionFor=s}else{r=new a.Group("","","");Object.assign(r,n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionFor=r}if(n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON])if(n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][c.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==c.ActionConstatnts.ACTION_ENTITY_TYPE.USER){s=new u.User(n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][c.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(s,n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][c.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionOn=s}else{r=new a.Group("","","");Object.assign(r,n[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][c.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionOn=r}return t.setMessage(t.getActionMessage(t)),t},t.prototype.setRawData=function(e){this.rawData=e},t.prototype.getRawData=function(){return this.rawData},t.prototype.setMessage=function(e){this.message=e},t.prototype.getMessage=function(){return this.message},t.prototype.setAction=function(e){this.action=e},t.prototype.getAction=function(){return this.action},t.prototype.getSender=function(){return this.getSenderFromData()},t.prototype.setActionBy=function(e){this.actionBy=e},t.prototype.getActionBy=function(){return this.actionBy},t.prototype.setActionOn=function(e){this.actionOn=e},t.prototype.getActionOn=function(){return this.actionOn},t.prototype.setActionFor=function(e){this.actionFor=e},t.prototype.getActionFor=function(){return this.actionFor},t.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},t.prototype.setMetadata=function(e){this.metadata=e,this.data=o({},this.data,{metadata:e})},t.prototype.getActionMessage=function(e){var t="";switch(e.getType()){case c.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_USER:case c.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_GROUP:switch(e.getAction()){case c.ActionConstatnts.ACTION_KEYS.ACTION_CREATED:case c.ActionConstatnts.ACTION_KEYS.ACTION_UPDATED:case c.ActionConstatnts.ACTION_KEYS.ACTION_DELETED:}break;case c.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_GROUP_MEMBER:switch(e.getAction()){case c.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_JOINED:var n=e.getActionBy(),s=e.getActionFor();t=d.format(c.ActionConstatnts.ActionMessages.ACTION_GROUP_JOINED_MESSAGE,n.getName(),s.getName());break;case c.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_LEFT:n=e.getActionBy(),s=e.getActionFor();t=d.format(c.ActionConstatnts.ActionMessages.ACTION_GROUP_LEFT_MESSAGE,n.getName(),s.getName());break;case c.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_KICKED:n=e.getActionBy(),s=e.getActionFor();var r=e.getActionOn();t=d.format(c.ActionConstatnts.ActionMessages.ACTION_MEMBER_KICKED_MESSAGE,n.getName(),r,s.getName());break;case c.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_BANNED:n=e.getActionBy(),s=e.getActionFor(),r=e.getActionOn();t=d.format(c.ActionConstatnts.ActionMessages.ACTION_MEMBER_BANNED_MESSAGE,n.getName(),s.getName());break;case c.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_UNBANNED:n=e.getActionBy(),s=e.getActionFor(),r=e.getActionOn();t=d.format(c.ActionConstatnts.ActionMessages.ACTION_MEMBER_UNBANNED_MESSAGE,n.getName(),s.getName());break;case c.ActionConstatnts.ACTION_KEYS.ACTION_SCOPE_CHANGED:}}return t},t.prototype.getSenderFromData=function(){var e=this.data;if(e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY]&&e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==c.ActionConstatnts.ACTION_ENTITY_TYPE.USER){var t=new u.User(e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.ActionConstatnts.ACTION_KEYS.ENTITY]);return Object.assign(t,e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.ActionConstatnts.ACTION_KEYS.ENTITY]),t}},t.TYPE=c.MessageConstatnts.TYPE,t.RECEIVER_TYPE=c.MessageConstatnts.RECEIVER_TYPE,t.CATEGORY=c.MessageConstatnts.CATEGORY,t.ACTION_TYPE=c.ActionConstatnts.ACTION_TYPE,t}(i.BaseMessage);t.Action=l},function(e,t,n){"use strict";t.__esModule=!0;var s=n(0),r=function(){function e(e,t,n,s,r,o,i){this.hasJoined=!1,this.guid=e,this.name=t,this.type=n,s&&(this.password=s),r&&(this.icon=r),o&&(this.description=o),i&&(this.hasJoined=i)}return e.prototype.getGuid=function(){return this.guid},e.prototype.setGuid=function(e){this.guid=e},e.prototype.getName=function(){return this.name},e.prototype.setName=function(e){this.name=e},e.prototype.getType=function(){return this.type},e.prototype.setType=function(e){this.type=e},e.prototype.setPassword=function(e){this.password=e},e.prototype.getIcon=function(){return this.icon},e.prototype.setIcon=function(e){this.icon=e},e.prototype.getDescription=function(){return this.description},e.prototype.setDescription=function(e){this.description=e},e.prototype.getOwner=function(){return this.owner},e.prototype.setOwner=function(e){this.owner=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e},e.prototype.getCreatedAt=function(){return this.createdAt},e.prototype.setCreatedAt=function(e){this.createdAt=e},e.prototype.getUpdatedAt=function(){return this.updatedAt},e.prototype.setUpdatedAt=function(e){this.updatedAt=e},e.prototype.getHasJoined=function(){return this.hasJoined},e.prototype.setHasJoined=function(e){this.hasJoined=e},e.prototype.getWsChannel=function(){return this.wsChannel},e.prototype.setWsChannel=function(e){this.wsChannel=e},e.prototype.setScope=function(e){this.scope=e},e.prototype.getScope=function(){return this.scope},e.TYPE=s.GroupType,e.Type=e.TYPE,e}();t.Group=r},function(e,t,n){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var r=n(12),a=n(0),u=n(1),c=n(3),d=function(r){function e(e,t,n,s){return u.isFalsy(s)?r.call(this,e,t,n,a.MessageCategory.CALL)||this:r.call(this,e,t,n,s)||this}return o(e,r),e.prototype.getCallInitiator=function(){return this.getCallInitiatedByFromData()},e.prototype.getCallReceiver=function(){return this.getCallReceivedByFromData()},e.prototype.setCallInitiator=function(e){this.callInitiator=e},e.prototype.setCallReceiver=function(e){this.callReceiver=e},e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e},e.prototype.getSessionId=function(){return this.sessionId},e.prototype.setSessionId=function(e){this.sessionId=e},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.getSender=function(){return this.getSenderFromData()},e.prototype.setMetadata=function(e){this.metadata=e,this.data=i({},this.data,{metadata:e})},e.prototype.getAction=function(){return this.action},e.prototype.setAction=function(e){this.action=e},e.prototype.getInitiatedAt=function(){return this.initiatedAt},e.prototype.setInitiatedAt=function(e){this.initiatedAt=e},e.prototype.getJoinedAt=function(){return this.joinedAt},e.prototype.setJoinedAt=function(e){this.joinedAt=e},e.prototype.setRawData=function(e){this.rawData=e},e.prototype.getRawData=function(){return this.rawData},e.prototype.setSender=function(e){this.sender=e},e.callFromJSON=function(e){var t=new this(e[a.MessageConstatnts.KEYS.RECEIVER],e[a.MessageConstatnts.KEYS.TYPE],e[a.MessageConstatnts.KEYS.RECEIVER_TYPE],a.MessageCategory.CALL),n=e[a.MessageConstatnts.KEYS.DATA];if(t.setAction(n[a.MessageConstatnts.KEYS.ACTION]),n[a.MessageConstatnts.KEYS.METADATA]&&t.setMetadata(n[a.MessageConstatnts.KEYS.METADATA]),n[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY])n[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY];if(n[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON]){var s=n[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON];if(s[a.CallConstants.CALL_KEYS.CALL_ENTITY]){var r=s[a.CallConstants.CALL_KEYS.CALL_ENTITY];if(r[a.CallConstants.CALL_KEYS.CALL_SESSION_ID]&&(t.sessionId=r[a.CallConstants.CALL_KEYS.CALL_SESSION_ID]),r[a.CallConstants.CALL_KEYS.CALL_STATUS]&&(t.status=r[a.CallConstants.CALL_KEYS.CALL_STATUS]),r[a.CallConstants.CALL_KEYS.CALL_DATA]){var o=r[a.CallConstants.CALL_KEYS.CALL_DATA];if(o[a.CallConstants.CALL_KEYS.CALL_METADATA]&&(t.metadata=o[a.CallConstants.CALL_KEYS.CALL_METADATA]),o[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES])o[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES]}r[a.CallConstants.CALL_KEYS.CALL_INITIATED_AT]&&(t.initiatedAt=r[a.CallConstants.CALL_KEYS.CALL_INITIATED_AT]),r[a.CallConstants.CALL_KEYS.CALL_JOINED_AT]&&(t.joinedAt=r[a.CallConstants.CALL_KEYS.CALL_JOINED_AT]),r[a.CallConstants.CALL_KEYS.CALL_LEFT_AT]&&(t.joinedAt=r[a.CallConstants.CALL_KEYS.CALL_LEFT_AT])}}return t},e.prototype.getSenderFromData=function(){var e=this.getData();if(e[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][a.CallConstants.CALL_KEYS.CALL_ENTITY])return new c.User(e[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][a.CallConstants.CALL_KEYS.CALL_ENTITY])},e.prototype.getCallInitiatedByFromData=function(){var e=this.getData();if(e[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][a.CallConstants.CALL_KEYS.CALL_ENTITY][a.CallConstants.CALL_KEYS.CALL_DATA][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.CallConstants.CALL_KEYS.CALL_SENDER])return new c.User(e[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][a.CallConstants.CALL_KEYS.CALL_ENTITY][a.CallConstants.CALL_KEYS.CALL_DATA][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.CallConstants.CALL_KEYS.CALL_SENDER][a.CallConstants.CALL_KEYS.CALL_ENTITY])},e.prototype.getCallReceivedByFromData=function(){var e=this.getData();if(e[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][a.CallConstants.CALL_KEYS.CALL_ENTITY][a.CallConstants.CALL_KEYS.CALL_DATA][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.CallConstants.CALL_KEYS.CALL_SENDER])return new c.User(e[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][a.CallConstants.CALL_KEYS.CALL_ENTITY][a.CallConstants.CALL_KEYS.CALL_DATA][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.CallConstants.CALL_KEYS.CALL_RECEIVER][a.CallConstants.CALL_KEYS.CALL_ENTITY])},e.TYPE=a.MessageConstatnts.TYPE,e.RECEIVER_TYPE=a.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=a.MessageConstatnts.CATEGORY,e.ACTION_TYPE=a.ActionConstatnts.ACTION_TYPE,e}(r.BaseMessage);t.Call=d},function(e,t,n){"use strict";t.__esModule=!0;var o=n(1),i=n(0),a=n(6),s=function(){function e(){this.baseUrl="https://kohoutek.cometchat.com/",this.apiVersion="v1.3",this.apiBaseUrl=this.baseUrl+this.apiVersion+"/",this.adminApiUrl="https://api.cometchat.com/",this.adminApiVersion="v1",this.uriEndpoints={authToken:{endpoint:"users/{{uid}}/auth_tokens",method:"POST",data:{uid:"string|max:100"},isAdminApi:!0},appSettings:{endpoint:"settings",method:"GET"},login:{endpoint:"admin/users/auth",method:"POST",data:{uid:"string|max:100"}},logout:{endpoint:"admin/users/auth/{{authToken}}",method:"DELETE"},getMyDetails:{endpoint:"me",method:"GET"},updateMyDetails:{endpoint:"/me",method:"PUT"},users:{endpoint:"users",method:"GET"},user:{endpoint:"users/{{uid}}",method:"GET"},userLogout:{endpoint:"me",method:"DELETE"},sendFriendRequests:{endpoint:"user/friends",method:"POST",data:{uids:"array<string|max:100>"}},getFriends:{endpoint:"user/friends",method:"GET"},unfriend:{endpoint:"user/friends/{{uid}}/{{gid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},acceptFriendRequest:{endpoint:"user/friends/{{uid}}/accept",method:"PUT",data:{uids:"array<string|max:100>"}},rejectFriendRequest:{endpoint:"user/friends/{{uid}}/reject",method:"DELETE",data:{uids:"array<string|max:100>"}},createGroup:{endpoint:"groups",method:"POST",data:{guid:"required|string|max:100",name:"required|string|max:100",type:"enum|public,protected,password",password:"filled|string|max:100"}},getGroups:{endpoint:"groups",method:"GET"},getGroup:{endpoint:"groups/{{guid}}",method:"GET"},updateGroup:{endpoint:"groups/{{guid}}",method:"PUT"},deleteGroup:{endpoint:"groups/{{guid}}",method:"DELETE"},addGroupMembers:{endpoint:"groups/{{guid}}/members",method:"POST",data:{uids:"array<string|max:100>"}},getGroupMembers:{endpoint:"groups/{{guid}}/members",method:"GET"},joinGroup:{endpoint:"groups/{{guid}}/members",method:"POST"},leaveGroup:{endpoint:"groups/{{guid}}/members",method:"DELETE"},kickGroupMembers:{endpoint:"groups/{{guid}}/members/{{uid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},changeScopeOfMember:{endpoint:"groups/{{guid}}/members/{{uid}}",method:"PUT",data:{uids:"array<string|max:100>"}},banGroupMember:{endpoint:"groups/{{guid}}/bannedusers/{{uid}}",method:"POST",data:{uids:"array<string|max:100>"}},unbanGroupMember:{endpoint:"groups/{{guid}}/bannedusers/{{uid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},addMemebersToGroup:{endpoint:"groups/{{guid}}/members",method:"PUT"},getBannedGroupMembers:{endpoint:"groups/{{guid}}/bannedusers",method:"GET"},promotemoteGroupMember:{endpoint:"groups/{{guid}}/promote",method:"PUT",data:{uids:"array<string|max:100>"}},demoteGroupMember:{endpoint:"groups/{{guid}}/demote",method:"DELETE",data:{uids:"array<string|max:100>"}},sendMessage:{endpoint:"messages",method:"POST",data:{sender:"array:string:max:100>",isGroupMember:"filled|boolean|bail",data:"required|json"}},getMessages:{endpoint:"messages",method:"GET"},getMessageDetails:{endpoint:"messages/{{messageId}}",method:"GET"},getUserMessages:{endpoint:"users/{{listId}}/messages",method:"GET"},getGroupMessages:{endpoint:"groups/{{listId}}/messages",method:"GET"},getMessage:{endpoint:"user/messages/{{muid}}",method:"GET"},updateMessage:{endpoint:"user/messages/{{muid}}",method:"PUT",data:{data:"required|json"}},deleteMessage:{endpoint:"user/messages/{{muid}}",method:"DELETE"},createCallSession:{endpoint:"calls",method:"POST",data:{}},updateCallSession:{endpoint:"calls/{{sessionid}}",method:"put",data:{}}}}return e.prototype.getEndpointData=function(s){var r=this;return new Promise(function(n,e){a.LocalStorage.getInstance().get(i.APP_SETTINGS.APP_SETTINGS).then(function(e){if(o.isFalsy(e)){var t=void 0;r.uriEndpoints.hasOwnProperty(s)&&((t=r.uriEndpoints[s]).hasOwnProperty(["isAdminApi"])?t.endpoint=r.adminApiUrl+r.adminApiVersion+"/"+t.endpoint:t.endpoint=r.baseUrl+r.apiVersion+"/"+t.endpoint),n(t)}else{t=void 0;r.uriEndpoints.hasOwnProperty(s)&&((t=r.uriEndpoints[s]).hasOwnProperty(["isAdminApi"])?t.endpoint="https://"+e[i.APP_SETTINGS.KEYS.ADMIN_API_HOST]+"/"+r.adminApiVersion+"/"+t.endpoint:t.endpoint="https://"+e[i.APP_SETTINGS.KEYS.CLIENT_API_HOST]+"/"+r.apiVersion+"/"+t.endpoint),n(t)}},function(e){var t;r.uriEndpoints.hasOwnProperty(s)&&((t=r.uriEndpoints[s]).hasOwnProperty(["isAdminApi"])?t.endpoint=r.adminApiUrl+r.adminApiVersion+"/"+t.endpoint:t.endpoint=r.baseUrl+r.apiVersion+"/"+t.endpoint),n(t)})})},e}();t.EndpointFactory=s},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var o=n(12),a=n(0),u=n(3),c=function(o){function e(e,t,n,s){var r=o.call(this,e,n,s,a.MessageCategory.MESSAGE)||this;switch(n){case"text":r.data={text:t},r.text=t}return r}return r(e,o),e.prototype.getSender=function(){return this.getSenderFromData()},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.setMetadata=function(e){this.metadata=e,this.data=i({},this.data,{metadata:e})},e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e},e.prototype.getText=function(){return this.text},e.prototype.setText=function(e){this.text=e},e.prototype.setProcessedText=function(e){this.processedText=e},e.prototype.getProcessedText=function(){return this.processedText},e.prototype.getSenderFromData=function(){var e=this.getData();if(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new u.User(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])},e.TYPE=a.MessageConstatnts.TYPE.TEXT,e.RECEIVER_TYPE=a.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=a.MessageConstatnts.CATEGORY.MESSAGE,e}(o.BaseMessage);t.TextMessage=c},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var o=n(12),a=n(0),u=n(3),c=function(o){function e(e,t,n,s){var r=o.call(this,e,n,s,a.MessageCategory.MESSAGE)||this;return r.data={url:t instanceof File?void 0:t},(r.file=t)instanceof File||(r.url=t),r}return r(e,o),e.prototype.setCaption=function(e){this.caption=e,this.data[a.MessageConstatnts.KEYS.TEXT]=e},e.prototype.getCaption=function(){return this.data[a.MessageConstatnts.KEYS.TEXT]},e.prototype.getSender=function(){return this.getSenderFromData()},e.prototype.getUrl=function(){return this.url},e.prototype.setUrl=function(e){this.url=e},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.setMetadata=function(e){this.metadata=e,this.data=i({},this.data,{metadata:e})},e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e},e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(e){this.attachment=e},e.prototype.getSenderFromData=function(){var e=this.getData();if(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new u.User(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])},e.TYPE=a.MessageConstatnts.TYPE,e.RECEIVER_TYPE=a.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=a.MessageConstatnts.CATEGORY,e}(o.BaseMessage);t.MediaMessage=c},function(e,t,n){"use strict";t.__esModule=!0;var o=n(0),r=n(7),i=n(1),a=n(2),u=n(28),c=n(4),s=n(14),d=n(6),l=function(){function e(){this.TAG="calling Log",this.callListner=void 0,this.CALL_NO_ANSWER_INTERVAL=45e3,this.view=void 0,this.scrollHight=0,this.scrollHight=0}return e.prototype.getCallListner=function(){return this.callListner},e.prototype.setCallListner=function(e){this.callListner=new s.UserCallListener(e)},e.getInstance=function(){return null!=this.callController&&null!=this.callController||(this.callController=new e),this.callController},e.prototype.getActiveCall=function(){return i.isFalsy(this.call)?null:this.call},e.prototype.initiateCall=function(n){var s=this;return new Promise(function(e,t){i.isFalsy(s.call)?null!=n&&null!=n?(s.call=n,s.joinCallMuc(n.getSessionId()),s.startCallTimer(),e(n)):t(new c.CometChatException(o.CALL_ERROR.ERROR_IN_CALLING)):t(new c.CometChatException(o.CALL_ERROR.CALL_ALREADY_INITIATED))})},e.prototype.onCallInitialized=function(){},e.prototype.joinCall=function(e){i.Logger.log(this.TAG,e)},e.prototype.cancelCall=function(){i.Logger.log(this.TAG,"calceling the call"),this.stopCallTimer()},e.prototype.rejectCall=function(){i.Logger.log(this.TAG,"rejectCall")},e.prototype.sendBusyResponse=function(){i.Logger.log(this.TAG,"sendBusyResponse")},e.prototype.endCall=function(e){var t=this;document.getElementsByName("frame").forEach(function(e){t.view.removeChild(e),t.view=void 0}),this.endCallSession()},e.prototype.onCallEnded=function(){var t=this;i.isFalsy(this.call)||(this.call.getReceiverType()==o.CallConstants.RECEIVER_TYPE_GROUP?i.Logger.info(this.TAG,JSON.stringify(this.call)+"This call ended"):(document.getElementsByName("frame").forEach(function(e){t.view.removeChild(e),t.view=void 0}),this.endCallSession()))},e.prototype.unAnswerCall=function(){i.Logger.log(this.TAG,"unAnswerCall")},e.prototype.onCallStarted=function(n){var s=this;return new Promise(function(e,t){i.isFalsy(s.call)?null!=n&&null!=n?(s.call=n,s.joinCallMuc(n.getSessionId()),e(n)):t(new c.CometChatException(o.CALL_ERROR.ERROR_IN_CALLING)):t(new c.CometChatException(o.CALL_ERROR.CALL_ALREADY_INITIATED))})},e.prototype.endCallSession=function(){try{this.leaveCallMuc(this.call.getSessionId()),this.call=void 0,e.callController=void 0,this.timer&&this.stopCallTimer(),this.view=void 0}catch(e){}},e.prototype.joinCallMuc=function(t){var s=this;i.getAppSettings().then(function(e){r.XMPPConnectionHelper.getInstance().connection.muc.join(i.format(o.XMPP.muc_jid_string,a.CometChat.getAppId(),t,a.CometChat.getAppId(),"call."+e[o.APP_SETTINGS.KEYS.CHAT_HOST]),r.XMPPConnectionHelper.getInstance().connection.jid,null,function(t){try{var n=u.PresenceController.transformPresence(t);r.XMPPConnectionHelper.getInstance().getUsersVCard(n.getUid(),function(e){if(!i.isFalsy(e.getUid()))switch(e.setLastActiveAt(n.getLastActiveAt()),n.getStatus()){case o.PresenceConstatnts.STATUS.ONLINE:e.setStatus(o.PresenceConstatnts.STATUS.ONLINE);break;default:e.setStatus(o.PresenceConstatnts.STATUS.OFFLINE)}switch(u.PresenceController.transformMUCUserPresence(t).getStatus()){case o.PresenceConstatnts.STATUS.JOINED:s.callListner&&(i.isFalsy(s.callListner._eventListener.onUserJoined)||s.callListner._eventListener.onUserJoined(e));break;case o.PresenceConstatnts.STATUS.LEFT:s.callListner&&(i.isFalsy(s.callListner._eventListener.onUserLeft)||s.callListner._eventListener.onUserLeft(e))}})}catch(e){}return!0})},function(e){})},e.prototype.leaveCallMuc=function(t){i.getAppSettings().then(function(e){r.XMPPConnectionHelper.getInstance().connection.muc.leave(i.format(o.XMPP.muc_jid_string,a.CometChat.getAppId(),t,a.CometChat.getAppId(),"call."+e[o.APP_SETTINGS.KEYS.CHAT_HOST]),r.XMPPConnectionHelper.getInstance().connection.jid)})},e.prototype.startCallTimer=function(){var t=this;this.timer=setTimeout(function(){a.CometChat.sendUnansweredResponse(t.call.getSessionId()).then(function(e){t.endCallSession()})},this.CALL_NO_ANSWER_INTERVAL)},e.prototype.stopCallTimer=function(){clearTimeout(this.timer)},e.prototype.startCall=function(t,e){var n=this;if(null==this.view){this.timer&&this.stopCallTimer(),i.isFalsy(e)||this.setCallListner(e);var s=document.createElement("iframe");this.getCallUrl(this.call.getType()).then(function(e){s.src=e+"",s.name="frame",s.setAttribute("allow","camera,microphone"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),t&&(n.view=t),t.appendChild(s),window.addEventListener("message",function(e){"hangup"==e.data.type&&n.call&&(i.Logger.info(n.TAG,n.callListner),n.callListner&&n.callListner._eventListener.onCallEnded(n.call),a.CometChat.endCall(n.call.getSessionId()).then(function(e){n.callListner&&n.callListner._eventListener.onCallEnded(e),i.Logger.info(n.TAG,{call:e})}).catch(function(e){i.Logger.info(n.TAG,"The Call Was Already Ended")}))})})}},e.prototype.getCallUrl=function(n){var s=this,r=void 0;return new Promise(function(t,e){d.LocalStorage.getInstance().get(o.APP_SETTINGS.APP_SETTINGS).then(function(e){i.isFalsy(e)?i.getAppSettings().then(function(e){r="https://"+e[o.APP_SETTINGS.KEYS.WEBRTC_HOST],r=n==o.CallConstants.CALL_TYPE_AUDIO?r+"/"+s.call.getSessionId()+"#config.startWithVideoMuted=true&config.startWithAudioMuted=false":r+"/"+s.call.getSessionId()+"#config.startWithAudioMuted=false&config.startWithAudioMuted=false",t(r)}):(r="https://"+e[o.APP_SETTINGS.KEYS.WEBRTC_HOST],r=n==o.CallConstants.CALL_TYPE_AUDIO?r+"/"+s.call.getSessionId()+"#config.startWithVideoMuted=false&config.startWithAudioMuted=false":r+"/"+s.call.getSessionId()+"#config.startWithAudioMuted=false&config.startWithAudioMuted=false",t(r))})})},e.prototype.destroy=function(){i.isFalsy(this.call)||(this.call=void 0),i.isFalsy(this.timer)||(this.timer=void 0),i.isFalsy(this.view)||(this.view=void 0)},e.callController=void 0,e}();t.CallController=l},function(e,t,n){"use strict";t.__esModule=!0;var s=n(1),r=n(0),o=n(13),i=n(2),a=function(){function e(e){this.store=r.constants.DEFAULT_STORE,s.isFalsy(e)||(this.store=e),this.settingsStore=o.createInstance({name:s.format(r.LOCAL_STORE.STORE_STRING,i.CometChat.getAppId(),r.LOCAL_STORE.MESSAGE_LISTENERS_LIST)}),this.settingsStore.setDriver([o.LOCALSTORAGE,o.INDEXEDDB,o.WEBSQL])}return e.getInstance=function(){return null==e.settingsStore&&(e.settingsStore=new e),e.settingsStore},e.prototype.set=function(e,t){return this.settingsStore.setItem(e,t)},e.prototype.remove=function(e){this.settingsStore.removeItem(e)},e.prototype.get=function(e){return this.settingsStore.getItem(e)},e.prototype.clearStore=function(){return this.settingsStore.clear()},e.prototype.clear=function(e){},e.prototype.selectStore=function(e){this.store=e},e.settingsStore=null,e}();t.MessageListnerMaping=a},function(e,t,n){"use strict";t.__esModule=!0;var s=n(3),r=n(0),o=function(){function e(){}return e.trasformJSONUser=function(e){var t;try{t=new s.User(e[r.UserConstants.UID]),Object.assign(t,e),e=t}catch(e){}return e},e}();t.UsersController=o},function(e,t,n){"use strict";t.__esModule=!0;var s=n(16),r=n(0),o=function(){function e(){}return e.trasformJSONGroup=function(e){var t;try{t=new s.Group(e[r.GroupConstants.KEYS.GUID],e[r.GroupConstants.KEYS.NAME],e[r.GroupConstants.KEYS.NAME]),Object.assign(t,e),e=t}catch(e){}return e},e}();t.GroupsController=o},function(e,t,n){"use strict";t.__esModule=!0;var s=n(2),r=n(1),o=n(0),i=n(13),a=function(){function e(e){this.store=o.constants.DEFAULT_STORE,r.isFalsy(e)||(this.store=e),this.userStore=i.createInstance({name:r.format(o.LOCAL_STORE.STORE_STRING,s.CometChat.getAppId(),o.LOCAL_STORE.USERS_STORE)}),this.userStore.setDriver([i.LOCALSTORAGE,i.INDEXEDDB,i.WEBSQL])}return e.getInstance=function(){return null==e.UserStore&&(e.UserStore=new e),e.UserStore},e.prototype.set=function(e,t){return this.userStore.setItem(e,t)},e.prototype.remove=function(e){this.userStore.removeItem(e)},e.prototype.get=function(e){return this.userStore.getItem(e)},e.prototype.clearStore=function(){return this.userStore.clear()},e.prototype.clear=function(e){},e.prototype.selectStore=function(e){this.store=e},e.prototype.storeUsers=function(e){var t=this;return e.map(function(e){t.set(e.getUid(),e)}),!0},e.prototype.storeUser=function(e){return this.set(e.getUid(),e),!0},e}();t.UserStore=a},function(e,t,n){"use strict";t.__esModule=!0,t.ERRORS={PARAMETER_MISSING:{code:"MISSING_PARAMETERS",name:"MISSING/ INVALID PARAMETER"},NOT_INITIALIZED:{code:"NOT_INITIALIZED",name:"INITIALIZATION NOT DONE"}},t.INIT_ERROR={NO_APP_ID:{code:t.ERRORS.PARAMETER_MISSING.code,name:t.ERRORS.PARAMETER_MISSING.name,message:"mandatory parameter appId missing",details:{}}},t.GROUP_CREATION_ERRORS={EMPTY_PASSWORD:{code:"ERR_EMPTY_GROUP_PASS",details:void 0,message:"The password is required to join a group.",name:void 0}},t.MESSAGES_REQUEST_ERRORS={REQUEST_IN_PROGRESS_ERROR:{code:"REQUEST_IN_PROGRESS",name:"REQUEST_IN_PROGRESS",message:"request already in progress",details:{}},NOT_ENOUGH_PARAMS:{code:"NOT_ENOUGH_PARAMETERS",name:"NOT_ENOUGH_PARAMETERS",message:"you need to set timstamp or message id to fetch next set of messages",details:{}}},t.LOGIN_ERROR={NOT_INITIALIZED:{code:"-1",name:"COMETCHAT_INITIALIZATION_NOT_DONE",message:"please initialize the cometchat before using login method",details:{}},UNAUTHORISED:{code:401,name:"USER_NOT_AUTHORISED",message:"provided user is not authorised",details:{}},XMPP_CONNECTION_FAIL:{code:-1,name:"XMPP_CONNECTION_FAIL",message:"XMPP username/password not correct",details:{}}},t.TYPINGNOTIFICATION_CONSTANTS={TOO_MANY_REQUEST:{code:"TOO_MANY_REQUEST",name:"TOO MANY REQUEST",message:"too many request, wait for `%s` seconds before sending next request",details:{}}}},function(e,t,n){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var r=n(12),a=n(0),u=n(3),c=n(1),d=function(r){function e(e,t,n){var s=r.call(this,e,a.MessageConstatnts.TYPE.CUSTOM,n,a.MessageCategory.MESSAGE)||this;return s.customData=t,c.isFalsy(s.data)&&(s.data={}),s.data[a.MessageConstatnts.KEYS.CUSTOM_DATA]=t,s}return o(e,r),e.prototype.getCustomData=function(){return this.customData},e.prototype.setCustomData=function(e){this.customData=e},e.prototype.getSender=function(){return this.getSenderFromData()},e.prototype.getSubType=function(){return this.subType},e.prototype.setSubType=function(e){this.subType=e,this.data=i({},this.data,{subType:e})},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e,this.data=i({},this.data,{metadata:e})},e.prototype.getData=function(){return this.data},e.prototype.getSenderFromData=function(){var e=this.getData();if(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new u.User(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])},e}(r.BaseMessage);t.CustomMessage=d},function(e,t,n){"use strict";t.__esModule=!0;var s=n(43),r=n(0),o=function(){function e(){}return e.transformPresence=function(e){return e.getAttribute("type")?new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),r.PresenceConstatnts.STATUS.OFFLINE,(new Date).getTime()):new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),r.PresenceConstatnts.STATUS.ONLINE,(new Date).getTime())},e.transformPresences=function(e){var t=[];return e.map(function(e){t.push(new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.STATUS),e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.LAST_ACTIVE_AT)))}),t},e.transformMUCUserPresence=function(e){return e.getAttribute("type")?new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),r.PresenceConstatnts.STATUS.LEFT,(new Date).getTime()):new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),r.PresenceConstatnts.STATUS.JOINED,(new Date).getTime())},e.trandformMUCPresence=function(e){0<e.getElementsByTagName("x").length&&this.transformMUCUserPresence(e)},e}();t.PresenceController=o},function(e,t,n){"use strict";t.__esModule=!0;var s=function(){function e(e,t,n){this.receiverId=e,this.receiverType=t,this.metadata=n}return e.prototype.getReceiverType=function(){return this.receiverType},e.prototype.setReceiverType=function(e){this.receiverType=e},e.prototype.getReceiverId=function(){return this.receiverId},e.prototype.setReceiverId=function(e){this.receiverId=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e},e.prototype.getSender=function(){return this.sender},e.prototype.setSender=function(e){this.sender=e},e}();t.TypingIndicator=s},function(e,t,n){"use strict";t.__esModule=!0;var s=n(1),r=n(0),o=n(7),i=function(){function e(){}return e.addTypingStarted=function(e){this.TYPING_STARTED_MAP[e]=s.getCurrentTime()},e.removeTypingStarted=function(e){delete this.TYPING_STARTED_MAP[e]},e.getTypingStartedMap=function(e){if(e)return this.TYPING_STARTED_MAP[e]},e.addTypingEnded=function(e){this.TYPING_ENDED_MAP[e]=s.getCurrentTime()},e.removeTypingEnded=function(e){delete this.TYPING_ENDED_MAP[e]},e.getTypingEndedMap=function(e){if(e)return this.TYPING_ENDED_MAP[e]},e.addIncomingTypingStarted=function(e){this.INCOMING_TYPING_STARTED_MAP[e.getReceiverId()]={typingNotification:e,timestamp:s.getCurrentTime()}},e.removeIncomingTypingStarted=function(e){delete this.INCOMING_TYPING_STARTED_MAP[e.getReceiverId()]},e.clearTimer=function(){var n=this;new Promise(function(e,t){Object.keys(n.TYPING_STARTED_MAP).map(function(e){s.getCurrentTime()-n.TYPING_STARTED_MAP[e]>=1e3*r.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&delete n.TYPING_STARTED_MAP[e]})}),new Promise(function(e,t){Object.keys(n.TYPING_ENDED_MAP).map(function(e){s.getCurrentTime()-n.TYPING_ENDED_MAP[e]>=1e3*r.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&delete n.TYPING_ENDED_MAP[e]})}),new Promise(function(e,t){Object.keys(n.INCOMING_TYPING_STARTED_MAP).map(function(e){s.getCurrentTime()-n.INCOMING_TYPING_STARTED_MAP[e][r.TYPING_NOTIFICATION.KEYS.TIMESTAMP]>=1e3*r.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&(o.XMPPConnectionHelper.getInstance().publishTypinStatusNotification(n.INCOMING_TYPING_STARTED_MAP[e][r.TYPING_NOTIFICATION.KEYS.TYPING_NOTIFICATION],r.TYPING_NOTIFICATION.ACTIONS.ENDED),delete n.INCOMING_TYPING_STARTED_MAP[e])})})},e.TYPING_STARTED_MAP={},e.TYPING_ENDED_MAP={},e.INCOMING_TYPING_STARTED_MAP={},e}();t.TypingNotificationController=i},function(e,t,n){"use strict";t.__esModule=!0;var r=n(5),s=n(1),o=n(4),i=n(24),a=function(){function t(e){this.limit=t.DEFAULT_LIMIT,this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},s.isFalsy(e)||(this.limit=e.limit,this.search_keyword=e.searchKeyWord)}return t.prototype.fetchPrevious=function(){var s=this;return new Promise(function(t,e){if(0!=s.next_page)return r.makeApiCall("groups",{},s.getPreData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var n=[];e.data.map(function(e,t){n.push(i.GroupsController.trasformJSONGroup(e))}),t(n)}t([])});t([])})},t.prototype.fetchNext=function(){var s=this;return new Promise(function(t,n){r.makeApiCall("getGroups",{},s.getNextData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var n=[];e.data.map(function(e,t){n.push(i.GroupsController.trasformJSONGroup(e))}),t(n)}t([])},function(e){n(new o.CometChatException(e.error))})})},t.prototype.getNextData=function(){var e={};if(e.per_page=this.limit,1==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,e;e.page=this.next_page++}return e},t.prototype.getPreData=function(){var e={};return e.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(e.page=--this.next_page),e},t.MAX_LIMIT=2,t.DEFAULT_LIMIT=1,t}();t.GroupsRequest=a;var u=function(){function e(){}return e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setSearchKeyWord=function(e){return this.searchKeyWord=e,this},e.prototype.build=function(){return new a(this)},e}();t.GroupsRequestBuilder=u},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var o=n(5),i=n(1),a=n(6),u=n(4),c=n(47),d=n(7),l=n(0),h=n(2),p=function(){function t(e){this.limit=t.DEFAULT_LIMIT,this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.isOutCastReq=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},this.store=a.LocalStorage.getInstance(),i.isFalsy(e)||(this.limit=e.limit,this.guid=e.guid,this.search_keyword=e.searchKeyWord,e instanceof g&&(this.isOutCastReq=e.isOutCastReq))}return t.prototype.fetchPrevious=function(){var s=this;return new Promise(function(n,t){if(0!=s.next_page)return o.makeApiCall(s.isOutCastReq?"getBannedGroupMembers":"getGroupMembers",{guid:s.guid},s.getPreData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var t=[];e.data.map(function(e){e.guid=s.guid,t.push(c.GroupMembersController.trasformJSONGroupMember(e))}),n(t)}n([])},function(e){t(new u.CometChatException(e.error))});n([])})},t.prototype.fetchNext=function(){var r=this;return new Promise(function(s,t){o.makeApiCall(r.isOutCastReq?"getBannedGroupMembers":"getGroupMembers",{guid:r.guid},r.getNextData()).then(function(e){if(e.meta&&(r.total_pages=e.meta.pagination.total_pages),0<e.data.length){r.pagination=e.meta.pagination;var t=[];e.data.map(function(e){e.guid=r.guid,t.push(c.GroupMembersController.trasformJSONGroupMember(e))});var n=[];t.map(function(e){n.push(i.format(l.XMPP.username_string,h.CometChat.getAppId(),e[l.UserConstants.UID]))}),d.XMPPConnectionHelper.getInstance().getPresenceInfo(n,function(n){t.map(function(e,t){n[t]&&(e.setLastActiveAt(n[t].getLastActiveAt()),e.setStatus(n[t].getStatus()))}),s(t)})}else s([])},function(e){t(new u.CometChatException(e.error))})})},t.prototype.getNextData=function(){var e={};if(e.per_page=this.limit,1==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,e;e.page=++this.next_page}return e},t.prototype.getPreData=function(){var e={};return e.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(e.page=--this.next_page),e},t.MAX_LIMIT=2,t.DEFAULT_LIMIT=1,t}();t.GroupMembersRequest=p;var f=function(){function e(e){this.guid=e}return e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setSearchKeyWord=function(e){return this.searchKeyWord=e,this},e.prototype.build=function(){return new p(this)},e}(),g=function(n){function e(e){var t=n.call(this,e)||this;return t.isOutCastReq=!0,t}return r(e,n),e.prototype.build=function(){return new p(this)},e}(t.GroupMembersRequestBuilder=f);t.GroupOutCastMembersRequestBuilder=g},function(e,t,n){"use strict";t.__esModule=!0;var s=n(0),r=function(){function e(e,t){this.joinedAt=0,this.isBanned=0,this.uid=e,t&&(this.scope=t)}return e.prototype.getName=function(){return this.name},e.prototype.setName=function(e){this.name=e},e.prototype.getAvatar=function(){return this.avatar},e.prototype.setAvatar=function(e){this.avatar=e},e.prototype.getCredits=function(){return this.credits},e.prototype.setCredits=function(e){this.credits=e},e.prototype.getEmail=function(){return this.email},e.prototype.setEmail=function(e){this.email=e},e.prototype.getLastActiveAt=function(){return this.lastActiveAt},e.prototype.setLastActiveAt=function(e){this.lastActiveAt=e},e.prototype.getLink=function(){return this.link},e.prototype.setLink=function(e){this.link=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e},e.prototype.getRole=function(){return this.role},e.prototype.setRole=function(e){this.role=e},e.prototype.getStatus=function(){return this.status},e.prototype.setStatus=function(e){this.status=e},e.prototype.getStatusMessage=function(){return this.statusMessage},e.prototype.setStatusMessage=function(e){this.statusMessage=e},e.prototype.setGuid=function(e){this.guid=e},e.prototype.setUid=function(e){this.uid=e},e.prototype.setScope=function(e){this.scope=e},e.prototype.setJoinedAt=function(e){this.joinedAt=e},e.prototype.setIsBanned=function(e){this.isBanned=e},e.prototype.setUser=function(e){this.user=e},e.prototype.getGuid=function(){return this.guid},e.prototype.getUid=function(){return this.uid},e.prototype.getuser=function(){return this.user},e.prototype.getScope=function(){return this.scope},e.prototype.getJoinedAt=function(){return this.joinedAt},e.prototype.getIsBanned=function(){return this.isBanned},e.GroupMemberScope=s.GroupMemberScope,e}();t.GroupMember=r},function(e,t,n){"use strict";t.__esModule=!0;var i=n(5),a=n(1),s=n(6),u=n(23),c=n(4),r=n(25),d=n(7),l=n(0),h=n(2),o=function(){function o(e){this.limit=o.DEFAULT_LIMIT,this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.fetchingInProgress=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},this.store=s.LocalStorage.getInstance(),o.userStore=r.UserStore.getInstance(),a.isFalsy(e)||(this.limit=e.limit,this.search_keyword=e.searchKeyWord)}return o.prototype.fetchPrevious=function(){var s=this;return this.fetchingInProgress=!0,new Promise(function(t,n){if(0==s.next_page)t([]),s.fetchingInProgress=!1;else{if(!s.fetchingInProgress)return i.makeApiCall("users",{},s.getPreData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var n=[];e.data.map(function(e,t){n.push(u.UsersController.trasformJSONUser(e))}),o.userStore.storeUsers(n),t(n),s.fetchingInProgress=!1}t([]),s.fetchingInProgress=!1},function(e){n(new c.CometChatException(e.error)),s.fetchingInProgress=!1});t([])}})},o.prototype.fetchNext=function(){var r=this;return new Promise(function(s,t){r.fetchingInProgress?(s([]),r.fetchingInProgress=!1):(r.fetchingInProgress=!0,i.makeApiCall("users",{},r.getNextData()).then(function(e){if(e.meta&&(r.total_pages=e.meta.pagination.total_pages),0<e.data.length){r.pagination=e.meta.pagination;var t=[],n=[];e.data.map(function(e){t.push(u.UsersController.trasformJSONUser(e)),n.push(a.format(l.XMPP.username_string,h.CometChat.getAppId(),e[l.UserConstants.UID]))}),d.XMPPConnectionHelper.getInstance().getPresenceInfo(n,function(n){t.map(function(e,t){n[t]&&(e.setLastActiveAt(n[t].getLastActiveAt()),e.setStatus(n[t].getStatus()))}),o.userStore.storeUsers(t),s(t),r.fetchingInProgress=!1})}else s([]);r.fetchingInProgress=!1},function(e){t(new c.CometChatException(e.error)),r.fetchingInProgress=!1}))})},o.prototype.getNextData=function(){var e={};if(e.per_page=this.limit,0==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,e;e.page=++this.next_page}return e},o.prototype.getPreData=function(){var e={};return e.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(e.page=--this.next_page),e},o.MAX_LIMIT=2,o.DEFAULT_LIMIT=1,o}();t.UsersRequest=o;var p=function(){function e(){}return e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setSearchKeyWord=function(e){return this.searchKeyWord=e,this},e.prototype.build=function(){return new o(this)},e}();t.UsersRequestBuilder=p},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(o,i,a,u){return new(a||(a=Promise))(function(e,t){function n(e){try{r(u.next(e))}catch(e){t(e)}}function s(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,s)}r((u=u.apply(o,i||[])).next())})},r=this&&this.__generator||function(n,s){var r,o,i,e,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=s.call(n,a)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};t.__esModule=!0;var o=n(4),a=n(5),u=n(11),c=n(1),i=n(9),d=n(0),l=n(26),h=n(48),p=n(7),f=n(8),g=n(22),E=function(){function e(e){this.limit=d.DEFAULT_VALUES.MSGS_LIMIT,this.timestamp=0,this.id=d.DEFAULT_VALUES.DEFAULT_MSG_ID,this.messageStore=i.MessagesStore.getInstance(),this.endpointName="getUserMessages",this.listId="",this.totalPages=0,this.inProgress=!1,this.paginationMeta={},this.limit=e.limit,this.paginationMeta[d.MessageConstatnts.PAGINATION.KEYS.PER_PAGE]=this.limit,this.uid=e.uid,this.uid&&(this.paginationMeta[d.MessageConstatnts.PAGINATION.KEYS.UID]=this.uid),this.guid=e.guid,this.timestamp=e.timestamp,this.timestamp&&(this.paginationMeta[d.MessageConstatnts.PAGINATION.KEYS.SENT_AT]=this.timestamp),this.id=e.id,this.id!=d.DEFAULT_VALUES.DEFAULT_MSG_ID&&(this.paginationMeta[d.MessageConstatnts.PAGINATION.KEYS.ID]=this.id)}return e.prototype.fetchNext=function(){var s=this;return new Promise(function(t,n){if(s.inProgress)return n(new o.CometChatException(l.MESSAGES_REQUEST_ERRORS.REQUEST_IN_PROGRESS_ERROR)),void(s.inProgress=!1);s.inProgress=!0,0!=s.timestamp||0!=s.id?(s.affix=d.MessageConstatnts.PAGINATION.AFFIX.APPEND,s.paginationMeta[d.MessageConstatnts.PAGINATION.KEYS.AFFIX]=s.affix,s.currentMethod=d.MessageConstatnts.PAGINATION.AFFIX.APPEND,s.makeAPICall().then(function(e){t(e),s.inProgress=!1},function(e){n(e),s.inProgress=!1})):n(new o.CometChatException(l.MESSAGES_REQUEST_ERRORS.NOT_ENOUGH_PARAMS))})},e.prototype.fetchPrevious=function(){var s=this;return new Promise(function(t,n){if(s.inProgress)return n(new o.CometChatException(l.MESSAGES_REQUEST_ERRORS.REQUEST_IN_PROGRESS_ERROR)),void(s.inProgress=!1);s.inProgress=!0,s.affix=d.MessageConstatnts.PAGINATION.AFFIX.PREPEND,s.paginationMeta[d.MessageConstatnts.PAGINATION.KEYS.AFFIX]=s.affix,s.currentMethod=d.MessageConstatnts.PAGINATION.AFFIX.PREPEND,s.makeAPICall().then(function(e){t(e),s.inProgress=!1},function(e){n(e),s.inProgress=!1})})},e.prototype.makeAPICall=function(){var i=this;return new Promise(function(t,n){if(i.createEndpoint(),i.totalPages)if(1!=i.totalPages);else if(i.lastAffix==i.affix)return void t([]);a.makeApiCall(i.endpointName,{listId:i.listId},i.paginationMeta).then(function(e){var n=[];e[d.ResponseConstants.RESPONSE_KEYS.KEY_META][d.ResponseConstants.RESPONSE_KEYS.KEY_CURSOR].hasOwnProperty(d.MessageConstatnts.PAGINATION.KEYS.ID)&&0==i.id&&(i.id=e.meta.cursor[d.MessageConstatnts.PAGINATION.KEYS.ID]),e[d.ResponseConstants.RESPONSE_KEYS.KEY_META][d.ResponseConstants.RESPONSE_KEYS.KEY_CURSOR].hasOwnProperty(d.MessageConstatnts.PAGINATION.KEYS.SENT_AT)&&0==i.timestamp&&(i.timestamp=e.meta.cursor[d.MessageConstatnts.PAGINATION.KEYS.SENT_AT]),e.meta.pagination.hasOwnProperty("total_pages")&&(i.totalPages=e.meta.pagination.total_pages),e.meta.cursor.hasOwnProperty("affix")&&(i.lastAffix=e.meta.cursor.affix),e.data[0]?(0<i.id&&(i.id=e.data[0].id),0<i.timestamp&&(i.timestamp=e.data[0].sentAt),e.data.map(function(t){if(t.sender.toLowerCase()!=f.getUidFromJid(p.XMPPConnectionHelper.getInstance().connection.jid).toLowerCase()){var s=t.id,r=t.receiverType,o=d.MessageConstatnts.XMPP_KEYS.TYPE_USER,e=t.sender;r==d.MessageConstatnts.RECEIVER_TYPE.USER?c.isFalsy(t.deliveredAt)&&(o=d.MessageConstatnts.XMPP_KEYS.TYPE_USER,f.getJidFromUid(e).then(function(e){var t=$msg({to:e,type:o,from:p.XMPPConnectionHelper.getInstance().connection.jid,id:p.XMPPConnectionHelper.getInstance().connection.getUniqueId()}),n=Strophe.xmlElement("received",{type:r,xmlns:"urn:xmpp:receipts",id:"["+h.CometChat.getAppId()+"]"+s});t.tree().appendChild(n),p.XMPPConnectionHelper.getInstance().connection.send(t)})):c.isFalsy(t.receipts.data)&&(o=d.MessageConstatnts.XMPP_KEYS.TYPE_USER,e=t.sender,f.getJidFromUid(e).then(function(e){var t=$msg({to:e,type:o,from:p.XMPPConnectionHelper.getInstance().connection.jid,id:p.XMPPConnectionHelper.getInstance().connection.getUniqueId()}),n=Strophe.xmlElement("received",{type:r,xmlns:"urn:xmpp:receipts",id:"["+h.CometChat.getAppId()+"]"+s});t.tree().appendChild(n),p.XMPPConnectionHelper.getInstance().connection.send(t)}))}g.MessageListnerMaping.getInstance().get("all").then(function(e){t.id>e&&g.MessageListnerMaping.getInstance().set("all",t.id)},function(e){g.MessageListnerMaping.getInstance().set("all",t.id)}),i.affix==d.MessageConstatnts.PAGINATION.AFFIX.APPEND?(i.id<t.id&&0<i.id&&(i.id=t.id),i.timestamp<t.sentAt&&0<i.timestamp&&(i.timestamp=t.sentAt)):(i.id>t.id&&(i.id=t.id),i.timestamp>t.sentAt&&(i.timestamp=t.sentAt)),i.paginationMeta[d.MessageConstatnts.PAGINATION.KEYS.ID]=i.id,n.push(u.MessageController.trasformJSONMessge(t))})):n=[],t(n)},function(e){n(e)})})},e.prototype.createEndpoint=function(){(c.isFalsy(this.guid)||c.isFalsy(this.uid))&&c.isFalsy(this.guid)?(c.isFalsy(this.uid)?this.endpointName="getMessages":this.endpointName="getUserMessages",this.listId=this.uid):(this.endpointName="getGroupMessages",this.listId=this.guid)},e.prototype.makeData=function(){var e={};e[d.MessageConstatnts.PAGINATION.KEYS.PER_PAGE]=this.limit,e[d.MessageConstatnts.PAGINATION.KEYS.AFFIX]=this.affix,(c.isFalsy(this.guid)||c.isFalsy(this.uid))&&c.isFalsy(this.guid)&&c.isFalsy(this.uid)},e.prototype.getFilteredPreviousDataByReceiverId=function(t){return s(this,void 0,void 0,function(){var n,s=this;return r(this,function(e){switch(e.label){case 0:switch(n=[],t){case"user":return[3,1];case"group":return[3,3];case"both":return[3,5]}return[3,7];case 1:return[4,i.MessagesStore.getInstance().get(this.uid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 2:return e.sent(),[3,9];case 3:return[4,i.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 4:e.sent(),e.label=5;case 5:return[4,i.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).filter(function(e){return t[e].sender.uid==s.uid}).map(function(e){n=n.concat([t[e]])})})];case 6:return e.sent(),[3,9];case 7:return[4,i.MessagesStore.getInstance().getAllMessages().then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 8:return e.sent(),[3,9];case 9:return[2,n]}})})},e.prototype.getFilteredNextDataByReceiverId=function(t){return s(this,void 0,void 0,function(){var n,s=this;return r(this,function(e){switch(e.label){case 0:switch(n=[],t){case"user":return[3,1];case"group":return[3,3];case"both":return[3,5]}return[3,7];case 1:return[4,i.MessagesStore.getInstance().get(this.uid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 2:return e.sent(),[3,9];case 3:return[4,i.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 4:e.sent(),e.label=5;case 5:return[4,i.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).filter(function(e){return t[e].sender.uid==s.uid}).map(function(e){n=n.concat([t[e]])})})];case 6:return e.sent(),[3,9];case 7:return[4,i.MessagesStore.getInstance().getAllMessages().then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 8:return e.sent(),[3,9];case 9:return[2,n]}})})},e}();t.DefaultMessagesRequest=E;var _=function(){function e(){this.limit=d.DEFAULT_VALUES.MSGS_LIMIT,this.maxLimit=d.DEFAULT_VALUES.MSGS_MAX_LIMIT,this.timestamp=0,this.id=d.DEFAULT_VALUES.DEFAULT_MSG_ID}return e.prototype.setLimit=function(e){return void 0===e&&(e=d.DEFAULT_VALUES.MSGS_LIMIT),e>this.maxLimit&&(e=this.maxLimit),this.limit=e,this},e.prototype.setGUID=function(e){return this.guid=e,this},e.prototype.setUID=function(e){return this.uid=e,this},e.prototype.setTimestamp=function(e){return void 0===e&&(e=c.getCurrentTime()),this.timestamp=e,this},e.prototype.setMessageId=function(e){return void 0===e&&(e=d.DEFAULT_VALUES.DEFAULT_MSG_ID),this.id=e,this},e.prototype.build=function(){return new E(this)},e}();t.DefaultMessagesRequestBuilder=_},function(e,t,n){"use strict";t.__esModule=!0;var s=n(2);t.init=function(e){return s.CometChat.getInstance(e)},t.CometChat=s.CometChat},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";t.__esModule=!0;var s=n(18);t.getEndPoint=function(e,o){void 0===e&&(e=""),void 0===o&&(o={});var t=new s.EndpointFactory;return new Promise(function(s,r){t.getEndpointData(e).then(function(e){var t=e;if(t){for(var n in o)t.endpoint=t.endpoint.replace("{{"+n+"}}",o[n]);s(t)}else r({error:"Unknown endPoint name."})})})}},function(e,h,t){"use strict";h.__esModule=!0;var n=t(10),p=t(8),f=t(0),r=t(1);h.$iq=n.$iq,h.$build=n.$build,h.$msg=n.$msg,h.$pres=n.$pres,h.Strophe=n.Strophe,h.NS=n.Strophe.NS,h.Status=n.Strophe.Status,window.Strophe=h.Strophe,window.$iq=h.$iq,window.$msg=h.$msg,h.Strophe.addConnectionPlugin("streamManagement",{logging:!0,returnWholeStanza:!1,autoSendCountOnEveryIncomingStanza:!1,requestResponseInterval:5,_c:null,_NS:"urn:xmpp:sm:3",_isStreamManagementEnabled:!1,_serverProcesssedStanzasCounter:null,_clientProcessedStanzasCounter:null,_clientSentStanzasCounter:null,_originalXMLOutput:null,_requestHandler:null,_incomingHandler:null,_requestResponseIntervalCount:0,_unacknowledgedStanzas:[],_acknowledgedStanzaListeners:[],addAcknowledgedStanzaListener:function(e){this._acknowledgedStanzaListeners.push(e)},enable:function(){this._c.send(h.$build("enable",{xmlns:this._NS,resume:!1})),this._c.flush(),this._c.pause()},requestAcknowledgement:function(){this._requestResponseIntervalCount=0,this._c.send(h.$build("r",{xmlns:this._NS}))},getOutgoingCounter:function(){return this._clientSentStanzasCounter},getIncomingCounter:function(){return this._clientProcessedStanzasCounter},init:function(e){this._c=e,h.Strophe.addNamespace("SM",this._NS),this._originalXMLOutput=this._c.xmlOutput,this._c.xmlOutput=this.xmlOutput.bind(this)},statusChanged:function(e){e!==h.Strophe.Status.CONNECTED&&e!==h.Strophe.Status.DISCONNECTED||(this._serverProcesssedStanzasCounter=0,this._clientProcessedStanzasCounter=0,this._clientSentStanzasCounter=0,this._isStreamManagementEnabled=!1,this._requestResponseIntervalCount=0,this._unacknowledgedStanzas=[],this._requestHandler&&this._c.deleteHandler(this._requestHandler),this._incomingHandler&&this._c.deleteHandler(this._incomingHandler),this._requestHandler=this._c.addHandler(this._handleServerRequestHandler.bind(this),this._NS,"r"),this._incomingHandler=this._c.addHandler(this._incomingStanzaHandler.bind(this)))},xmlOutput:function(e){for(var t,n=0;n<e.children.length;n++)t=e.children[n],(h.Strophe.isTagEqual(t,"iq")||h.Strophe.isTagEqual(t,"presence")||h.Strophe.isTagEqual(t,"message"))&&this._increaseSentStanzasCounter(t);return this._originalXMLOutput.call(this._c,e)},_incomingStanzaHandler:function(e){if(h.Strophe.isTagEqual(e,"enabled")&&e.getAttribute("xmlns")===this._NS&&(this._isStreamManagementEnabled=!0,this._c.resume()),(h.Strophe.isTagEqual(e,"iq")||h.Strophe.isTagEqual(e,"presence")||h.Strophe.isTagEqual(e,"message"))&&(this._increaseReceivedStanzasCounter(),this.autoSendCountOnEveryIncomingStanza&&this._answerProcessedStanzas()),h.Strophe.isTagEqual(e,"a")){var t=parseInt(e.getAttribute("h"));this._handleAcknowledgedStanzas(t,this._serverProcesssedStanzasCounter),this._serverProcesssedStanzasCounter=t,0<this.requestResponseInterval&&(this._requestResponseIntervalCount=0)}return!0},_handleAcknowledgedStanzas:function(e,t){var n=e-t;n<0&&this._throwError("New reported stanza count lower than previous. New: "+e+" - Previous: "+t),n>this._unacknowledgedStanzas.length&&this._throwError("Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledge Count: "+n+" - Unacknowledge Stanza Count: "+this._unacknowledgedStanzas.length+" - New: "+e+" - Previous: "+t);for(var s=0;s<n;s++)for(var r=this._unacknowledgedStanzas.shift(),o=0;o<this._acknowledgedStanzaListeners.length;o++)this._acknowledgedStanzaListeners[o](r);this.logging&&this._unacknowledgedStanzas.length},_handleServerRequestHandler:function(){return this._answerProcessedStanzas(),!0},_answerProcessedStanzas:function(){this._isStreamManagementEnabled&&this._c.send(h.$build("a",{xmlns:this._NS,h:this._clientProcessedStanzasCounter}))},_increaseSentStanzasCounter:function(e){this._isStreamManagementEnabled&&(this._unacknowledgedStanzas.push(this.returnWholeStanza?e:e.getAttribute("id")),this._clientSentStanzasCounter++,0<this.requestResponseInterval&&(this._requestResponseIntervalCount++,this._requestResponseIntervalCount===this.requestResponseInterval&&this.requestAcknowledgement()))},_increaseReceivedStanzasCounter:function(){this._isStreamManagementEnabled&&this._clientProcessedStanzasCounter++},_throwError:function(e){throw new Error(e)}}),h.Strophe.addConnectionPlugin("chatstates",{init:function(e){this._connection=e,h.Strophe.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates")},statusChanged:function(e){},addActive:function(e){return e.c("active",{xmlns:h.Strophe.NS.CHATSTATES}).up()},_notificationReceived:function(e){var t=e.getElementsByTagName("composing"),n=e.getElementsByTagName("paused");e.getAttribute("from");return t.length,n.length,!0},sendActive:function(e,t,n){this._sendNotification(e,t,"active",n)},sendComposing:function(e,t,n){this._sendNotification(e,t,"composing",n)},sendPaused:function(e,t,n){this._sendNotification(e,t,"paused",n)},sendInactive:function(e,t){this._sendNotification(e,t,"inactive")},sendGone:function(e,t){this._sendNotification(e,t,"gone")},_sendNotification:function(e,t,n,s){t||(t="chat"),r.isFalsy(s)?this._connection.send(h.$msg({to:e,from:this._connection.jid,type:t}).c(n,{xmlns:h.Strophe.NS.CHATSTATES})):this._connection.send(h.$msg({to:e,from:this._connection.jid,type:t}).c("body",JSON.stringify(s)).up().c(n,{xmlns:h.Strophe.NS.CHATSTATES}))}}),h.Strophe.addConnectionPlugin("receipts",{_conn:null,_msgQueue:{},_retries:{},_resendCount:10,_resendTime:9e3,init:function(e){this._conn=e,h.Strophe.addNamespace("RECEIPTS","urn:xmpp:receipts")},statusChanged:function(e){if(e===h.Strophe.Status.CONNECTED||e===h.Strophe.Status.ATTACHED){var t=this;setTimeout(function(){t.resendQueue()},5e3)}},sendMessage:function(e){var t=this._conn.getUniqaueId();e.tree().setAttribute("id",t);var n=h.Strophe.xmlElement("request",{xmlns:h.Strophe.NS.RECEIPTS});return e.tree().appendChild(n),this._msgQueue[t]=e,this._retries[t]=0,this._conn.send(e),this.resendMessage(t),t},resendMessage:function(e){var t=this;setTimeout(function(){if(t._msgQueue[e]){if(!t._conn.connected)return void t.resendMessage(e);if(t._retries[e]++,t._retries[e]>t._resendCount)return;t._msgQueue[e].tree().setAttribute("from",t._conn.jid),t._conn.send(t._msgQueue[e]),t.resendMessage(e)}},this._resendTime)},addReceiptHandler:function(t,e,n,s){var r=this;this._conn.addHandler(function(e){return r._processReceipt(e),t(e)},h.Strophe.NS.RECEIPTS,"message",e,null,n,s)},_processReceipt:function(e,t){void 0===t&&(t=0);var n=e.getAttribute(f.DELIVERY_RECEIPTS.ID),s=h.Strophe.getBareJidFromJid(e.getAttribute(f.MessageConstatnts.XMPP_KEYS.FROM)),r=p.getUidFromJid(s),o=f.MessageConstatnts.XMPP_KEYS.TYPE_USER,i=f.MessageConstatnts.RECEIVER_TYPE.USER,a=e.getElementsByTagName("request"),u=e.getElementsByTagName("received");if(e.getAttribute(f.MessageConstatnts.XMPP_KEYS.TYPE)==f.MessageConstatnts.XMPP_KEYS.TYPE_GROUP&&(i=f.MessageConstatnts.RECEIVER_TYPE.GROUP,s=p.getFullJidForGroup(e.getAttribute(f.MessageConstatnts.XMPP_KEYS.FROM))),0<a.length){var c=h.$msg({to:s,type:o,from:this._conn.jid,id:this._conn.getUniqueId()}),d=h.Strophe.xmlElement("delivered",{type:i,receiverId:r,xmlns:h.Strophe.NS.RECEIPTS,id:n});c.tree().appendChild(d),this._conn.send(c)}if(0<u.length){var l=u[0].getAttribute(f.DELIVERY_RECEIPTS.ID);l&&(delete this._msgQueue[l],delete this._retries[l])}},resendQueue:function(){if(this._conn.connected)for(var e in this._msgQueue)this._msgQueue.hasOwnProperty(e)&&this._conn.send(this._msgQueue[e]);else{var t=this;setTimeout(function(){t.resendQueue()},5e3)}},getUnreceivedMsgs:function(){var e=[];for(var t in this._msgQueue)this._msgQueue.hasOwnProperty(t)&&e.push(this._msgQueue[t]);return e},clearMessages:function(){this._msgQueue={}}})},function(e,t,n){"use strict";n.r(t);var s=function(){var s={base:"https://twemoji.maxcdn.com/2/",ext:".png",size:"72x72",className:"emoji",convert:{fromCodePoint:function(e){var t="string"==typeof e?parseInt(e,16):e;if(t<65536)return o(t);return o(55296+((t-=65536)>>10),56320+(1023&t))},toCodePoint:l},onerror:function(){this.parentNode&&this.parentNode.replaceChild(S(this.alt,!1),this)},parse:function(e,t){t&&"function"!=typeof t||(t={callback:t});return("string"==typeof e?function(e,i){return d(e,function(e){var t,n,s=e,r=m(e),o=i.callback(r,i);if(r&&o){for(n in s="<img ".concat('class="',i.className,'" ','draggable="false" ','alt="',e,'"',' src="',o,'"'),t=i.attributes(e,r))t.hasOwnProperty(n)&&0!==n.indexOf("on")&&-1===s.indexOf(" "+n+"=")&&(s=s.concat(" ",n,'="',t[n].replace(a,u),'"'));s=s.concat("/>")}return s})}:function(e,t){var n,s,r,o,i,a,u,c,d,l,h,p,f,g=function e(t,n){var s,r,o=t.childNodes,i=o.length;for(;i--;)s=o[i],3===(r=s.nodeType)?n.push(s):1!==r||"ownerSVGElement"in s||C.test(s.nodeName.toLowerCase())||e(s,n);return n}(e,[]),E=g.length;for(;E--;){for(r=!1,o=document.createDocumentFragment(),i=g[E],a=i.nodeValue,c=0;u=_.exec(a);){if((d=u.index)!==c&&o.appendChild(S(a.slice(c,d),!0)),h=u[0],p=m(h),c=d+h.length,f=t.callback(p,t),p&&f){for(s in(l=new Image).onerror=t.onerror,l.setAttribute("draggable","false"),n=t.attributes(h,p))n.hasOwnProperty(s)&&0!==s.indexOf("on")&&!l.hasAttribute(s)&&l.setAttribute(s,n[s]);l.className=t.className,l.alt=h,l.src=f,r=!0,o.appendChild(l)}l||o.appendChild(S(h,!1)),l=null}r&&(c<a.length&&o.appendChild(S(a.slice(c),!0)),i.parentNode.replaceChild(o,i))}return e})(e,{callback:t.callback||i,attributes:"function"==typeof t.attributes?t.attributes:c,base:"string"==typeof t.base?t.base:s.base,ext:t.ext||s.ext,size:t.folder||(n=t.size||s.size,"number"==typeof n?n+"x"+n:n),className:t.className||s.className,onerror:t.onerror||s.onerror});var n},replace:d,test:function(e){_.lastIndex=0;var t=_.test(e);return _.lastIndex=0,t}},t={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},_=/(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddb0-\uddb3])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[\u0023\u002a\u0030-\u0039]\ufe0f?\u20e3|(?:[\u00a9\u00ae\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\udeeb\udeec\udef4-\udef9]|\ud83e[\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd40-\udd45\udd47-\udd70\udd73-\udd76\udd7a\udd7c-\udda2\uddb4\uddb7\uddc0-\uddc2\uddd0\uddde-\uddff]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,n=/\uFE0F/g,r=String.fromCharCode(8205),a=/[&<>'"]/g,C=/^(?:iframe|noframes|noscript|script|select|style|textarea)$/,o=String.fromCharCode;return s;function S(e,t){return document.createTextNode(t?e.replace(n,""):e)}function i(e,t){return"".concat(t.base,t.size,"/",e,t.ext)}function m(e){return l(e.indexOf(r)<0?e.replace(n,""):e)}function u(e){return t[e]}function c(){return null}function d(e,t){return String(e).replace(_,t)}function l(e,t){for(var n=[],s=0,r=0,o=0;o<e.length;)s=e.charCodeAt(o++),r?(n.push((65536+(r-55296<<10)+(s-56320)).toString(16)),r=0):55296<=s&&s<=56319?r=s:n.push(s.toString(16));return n.join(t||"-")}}();t.default=s},function(e,t,n){"use strict";t.__esModule=!0;var s=function(){function e(){this.RECEIPT_TYPE={READ_RECEIPT:"read",DELIVERY_RECEIPT:"delivery"},this.receiptType=this.RECEIPT_TYPE.DELIVERY_RECEIPT}return e.prototype.getReceiverType=function(){return this.receiverType},e.prototype.setReceiverType=function(e){this.receiverType=e},e.prototype.getSender=function(){return this.sender},e.prototype.setSender=function(e){this.sender=e},e.prototype.getReceiver=function(){return this.receiver},e.prototype.setReceiver=function(e){this.receiver=e},e.prototype.getTimestamp=function(){return this.timestamp},e.prototype.setTimestamp=function(e){this.timestamp=e},e.prototype.getMessageId=function(){return this.messageId},e.prototype.setMessageId=function(e){this.messageId=e},e.prototype.getReceiptType=function(){return this.receiptType},e.prototype.setReceiptType=function(e){void 0===e&&(e=this.RECEIPT_TYPE.DELIVERY_RECEIPT),this.receiptType=e},e}();t.MessageReceipt=s},function(e,t,n){"use strict";t.__esModule=!0;var s=n(0),r=function(){function t(e){e.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.EXTENSION)&&(this.fileEextension=e[s.ATTACHMENTS_CONSTANTS.KEYS.EXTENSION]),e.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.MIME_TYPE)&&(this.fileMimeType=e[s.ATTACHMENTS_CONSTANTS.KEYS.MIME_TYPE]),e.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.NAME)&&(this.fileName=e[s.ATTACHMENTS_CONSTANTS.KEYS.NAME]),e.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.SIZE)&&(this.fileSize=e[s.ATTACHMENTS_CONSTANTS.KEYS.SIZE]),e.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.URL)&&(this.fileUrl=e[s.ATTACHMENTS_CONSTANTS.KEYS.URL])}return t.prototype.createFileFromJSON=function(e){return new t(e)},t.prototype.toJSON=function(e){return JSON.stringify(e)},t.prototype.getFileExtension=function(){return this.fileEextension},t.prototype.setFileExtension=function(e){this.fileEextension=e},t.prototype.getFileMimeType=function(){return this.fileMimeType},t.prototype.setFileMimeType=function(e){this.fileMimeType=e},t.prototype.getFileName=function(){return this.fileName},t.prototype.setFileName=function(e){this.fileName=e},t.prototype.getFileSize=function(){return this.fileSize},t.prototype.setFileSize=function(e){this.fileSize=e},t.prototype.getFileUrl=function(){return this.fileUrl},t.prototype.setFileUrl=function(e){this.fileUrl=e},t}();t.Attachment=r},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=n(8),s=function(){function e(e,t,n,s){r.isFalsy(e)||(this.jid=e,this.uid=o.getUidFromJid(e),r.isFalsy(s)||(this.priority=s),r.isFalsy(t)||(this.status=t),r.isFalsy(n)||(this.lastActiveAt=n))}return e.prototype.getUid=function(){return this.uid},e.prototype.setUid=function(e){this.uid=e},e.prototype.getJid=function(){return this.jid},e.prototype.setJid=function(e){this.jid=e},e.prototype.getPriority=function(){return this.priority},e.prototype.setPriority=function(e){this.priority=e},e.prototype.getStatus=function(){return this.status},e.prototype.setStatus=function(e){this.status=e},e.prototype.getLastActiveAt=function(){return this.lastActiveAt},e.prototype.setLastActiveAt=function(e){this.lastActiveAt=e},e.prototype.getStatusMessage=function(){return this.statusMessage},e.prototype.setStatusMessage=function(e){this.statusMessage=e},e}();t.UserPresence=s},function(e,t,n){!function(h){"use strict";var n,c,a={}.hasOwnProperty,r=function(e,t){return function(){return e.apply(t,arguments)}};h.Strophe.addConnectionPlugin("muc",{_connection:null,rooms:{},roomNames:[],init:function(e){return this._connection=e,this._muc_handler=null,h.Strophe.addNamespace("MUC_OWNER",h.Strophe.NS.MUC+"#owner"),h.Strophe.addNamespace("MUC_ADMIN",h.Strophe.NS.MUC+"#admin"),h.Strophe.addNamespace("MUC_USER",h.Strophe.NS.MUC+"#user"),h.Strophe.addNamespace("MUC_ROOMCONF",h.Strophe.NS.MUC+"#roomconfig"),h.Strophe.addNamespace("MUC_REGISTER","jabber:iq:register")},join:function(d,e,t,n,s,r,o,i){var a,u,l;return u=this.test_append_nick(d,e),a=h.$pres({from:this._connection.jid,to:u}).c("x",{xmlns:h.Strophe.NS.MUC}),null!=o&&(a=a.c("history",o).up()),null!=r&&a.cnode(h.Strophe.xmlElement("password",[],r)),null!=i&&a.up().cnode(i),null==this._muc_handler&&(this._muc_handler=this._connection.addHandler((l=this,function(e){var t,n,s,r,o,i,a,u,c;if(!(t=e.getAttribute("from")))return!0;if(i=t.split("/")[0],!l.rooms[i])return!0;if(d=l.rooms[i],n={},"message"===e.nodeName)n=d._message_handlers;else if("presence"===e.nodeName&&0<(c=e.getElementsByTagName("x")).length)for(s=0,o=c.length;s<o;s++)if(a=c[s],(u=a.getAttribute("xmlns"))&&u.match(h.Strophe.NS.MUC)){n=d._presence_handlers;break}for(r in n)(0,n[r])(e,d)||delete n[r];return!0}))),this.rooms.hasOwnProperty(d)||(this.rooms[d]=new c(this,d,e,r),n&&this.rooms[d].addHandler("presence",n),t&&this.rooms[d].addHandler("message",t),s&&this.rooms[d].addHandler("roster",s),this.roomNames.push(d)),this._connection.send(a)},leave:function(e,t,n,s){var r,o,i,a;return r=this.roomNames.indexOf(e),delete this.rooms[e],0<=r&&(this.roomNames.splice(r,1),0===this.roomNames.length&&(this._connection.deleteHandler(this._muc_handler),this._muc_handler=null)),a=this.test_append_nick(e,t),i=this._connection.getUniqueId(),o=h.$pres({type:"unavailable",id:i,from:this._connection.jid,to:a}),null!=s&&o.c("status",s),null!=n&&this._connection.addHandler(n,null,"presence",null,i),this._connection.send(o),i},message:function(e,t,n,s,r,o){var i,a,u;return u=this.test_append_nick(e,t),r=r||(null!=t?"chat":"groupchat"),o=o||this._connection.getUniqueId(),(i=h.$msg({to:u,from:this._connection.jid,type:r,id:o}).c("body").t(n)).up(),null!=s&&(i.c("html",{xmlns:h.Strophe.NS.XHTML_IM}).c("body",{xmlns:h.Strophe.NS.XHTML}).h(s),0===i.node.childNodes.length?(a=i.node.parentNode,i.up().up(),i.node.removeChild(a)):i.up().up()),i.c("x",{xmlns:"jabber:x:event"}).c("composing"),this._connection.send(i),o},groupchat:function(e,t,n,s){return this.message(e,null,t,n,void 0,s)},invite:function(e,t,n){var s,r;return r=this._connection.getUniqueId(),s=h.$msg({from:this._connection.jid,to:e,id:r}).c("x",{xmlns:h.Strophe.NS.MUC_USER}).c("invite",{to:t}),null!=n&&s.c("reason",n),this._connection.send(s),r},multipleInvites:function(e,t,n){var s,r,o,i,a;for(i=this._connection.getUniqueId(),r=h.$msg({from:this._connection.jid,to:e,id:i}).c("x",{xmlns:h.Strophe.NS.MUC_USER}),s=0,o=t.length;s<o;s++)a=t[s],r.c("invite",{to:a}),null!=n&&(r.c("reason",n),r.up()),r.up();return this._connection.send(r),i},directInvite:function(e,t,n,s){var r,o,i;return i=this._connection.getUniqueId(),r={xmlns:"jabber:x:conference",jid:e},null!=n&&(r.reason=n),null!=s&&(r.password=s),o=h.$msg({from:this._connection.jid,to:t,id:i}).c("x",r),this._connection.send(o),i},queryOccupants:function(e,t,n){var s,r;return s={xmlns:h.Strophe.NS.DISCO_ITEMS},r=h.$iq({from:this._connection.jid,to:e,type:"get"}).c("query",s),this._connection.sendIQ(r,t,n)},configure:function(e,t,n){var s,r;return s=h.$iq({to:e,type:"get"}).c("query",{xmlns:h.Strophe.NS.MUC_OWNER}),r=s.tree(),this._connection.sendIQ(r,t,n)},cancelConfigure:function(e){var t,n;return t=h.$iq({to:e,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}),n=t.tree(),this._connection.sendIQ(n)},saveConfiguration:function(e,t,n,s){var r,o,i,a,u;if(i=h.$iq({to:e,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_OWNER}),void 0!==h.Strophe.x&&void 0!==h.Strophe.x.Form&&t instanceof h.Strophe.x.Form)t.type="submit",i.cnode(t.toXML());else for(i.c("x",{xmlns:"jabber:x:data",type:"submit"}),o=0,a=t.length;o<a;o++)r=t[o],i.cnode(r).up();return u=i.tree(),this._connection.sendIQ(u,n,s)},createInstantRoom:function(e,t,n){var s;return s=h.$iq({to:e,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this._connection.sendIQ(s.tree(),t,n)},createConfiguredRoom:function(e,t,n,s){var r,o,i;for(r in(o=h.$iq({to:e,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"})).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),t)a.call(t,r)&&(i=t[r],o.c("field",{var:r}).c("value").t(i).up().up());return this._connection.sendIQ(o.tree(),n,s)},setTopic:function(e,t){var n;return n=h.$msg({to:e,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(t),this._connection.send(n.tree())},_modifyPrivilege:function(e,t,n,s,r){var o;return o=h.$iq({to:e,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_ADMIN}).cnode(t.node),null!=n&&o.c("reason",n),this._connection.sendIQ(o.tree(),s,r)},modifyRole:function(e,t,n,s,r,o){var i;return i=h.$build("item",{nick:t,role:n}),this._modifyPrivilege(e,i,s,r,o)},kick:function(e,t,n,s,r){return this.modifyRole(e,t,"none",n,s,r)},voice:function(e,t,n,s,r){return this.modifyRole(e,t,"participant",n,s,r)},mute:function(e,t,n,s,r){return this.modifyRole(e,t,"visitor",n,s,r)},op:function(e,t,n,s,r){return this.modifyRole(e,t,"moderator",n,s,r)},deop:function(e,t,n,s,r){return this.modifyRole(e,t,"participant",n,s,r)},modifyAffiliation:function(e,t,n,s,r,o){var i;return i=h.$build("item",{jid:t,affiliation:n}),this._modifyPrivilege(e,i,s,r,o)},ban:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"outcast",n,s,r)},member:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"member",n,s,r)},revoke:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"none",n,s,r)},owner:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"owner",n,s,r)},admin:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"admin",n,s,r)},changeNick:function(e,t){var n,s;return s=this.test_append_nick(e,t),n=h.$pres({from:this._connection.jid,to:s,id:this._connection.getUniqueId()}),this._connection.send(n.tree())},setStatus:function(e,t,n,s){var r,o;return o=this.test_append_nick(e,t),r=h.$pres({from:this._connection.jid,to:o}),null!=n&&r.c("show",n).up(),null!=s&&r.c("status",s),this._connection.send(r.tree())},registrationRequest:function(e,a,t){var n;return n=h.$iq({to:e,from:this._connection.jid,type:"get"}).c("query",{xmlns:h.Strophe.NS.MUC_REGISTER}),this._connection.sendIQ(n,function(e){var t,n,s,r,o,i;for((n=e.getElementsByTagName("field")).length,r={required:[],optional:[]},o=0,i=n.length;o<i;o++)t=n[o],s={var:t.getAttribute("var"),label:t.getAttribute("label"),type:t.getAttribute("type")},0<t.getElementsByTagName("required").length?r.required.push(s):r.optional.push(s);return a(r)},t)},submitRegistrationForm:function(e,t,n,s){var r,o,i;for(o in(r=h.$iq({to:e,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_REGISTER})).c("x",{xmlns:"jabber:x:data",type:"submit"}),r.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up(),t)i=t[o],r.c("field",{var:o}).c("value").t(i).up().up();return this._connection.sendIQ(r,n,s)},listRooms:function(e,t,n){var s;return s=h.$iq({to:e,from:this._connection.jid,type:"get"}).c("query",{xmlns:h.Strophe.NS.DISCO_ITEMS}),this._connection.sendIQ(s,t,n)},test_append_nick:function(e,t){var n,s;return s=h.Strophe.escapeNode(h.Strophe.getNodeFromJid(e)),n=h.Strophe.getDomainFromJid(e),s+"@"+n+(null!=t?"/"+t:"")}}),c=function(){function i(e,t,n,s){this.client=e,this.name=t,this.nick=n,this.password=s,this._roomRosterHandler=r(this._roomRosterHandler,this),this._addOccupant=r(this._addOccupant,this),this.roster={},this._message_handlers={},this._presence_handlers={},this._roster_handlers={},this._handler_ids=0,this.client.muc&&(this.client=this.client.muc),this.name=h.Strophe.getBareJidFromJid(this.name),this.addHandler("presence",this._roomRosterHandler)}return i.prototype.join=function(e,t,n){return this.client.join(this.name,this.nick,e,t,n,this.password)},i.prototype.leave=function(e,t){return this.client.leave(this.name,this.nick,e,t),delete this.client.rooms[this.name]},i.prototype.message=function(e,t,n,s){return this.client.message(this.name,e,t,n,s)},i.prototype.groupchat=function(e,t){return this.client.groupchat(this.name,e,t)},i.prototype.invite=function(e,t){return this.client.invite(this.name,e,t)},i.prototype.multipleInvites=function(e,t){return this.client.invite(this.name,e,t)},i.prototype.directInvite=function(e,t){return this.client.directInvite(this.name,e,t,this.password)},i.prototype.configure=function(e){return this.client.configure(this.name,e)},i.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)},i.prototype.saveConfiguration=function(e){return this.client.saveConfiguration(this.name,e)},i.prototype.queryOccupants=function(e,t){return this.client.queryOccupants(this.name,e,t)},i.prototype.setTopic=function(e){return this.client.setTopic(this.name,e)},i.prototype.modifyRole=function(e,t,n,s,r){return this.client.modifyRole(this.name,e,t,n,s,r)},i.prototype.kick=function(e,t,n,s){return this.client.kick(this.name,e,t,n,s)},i.prototype.voice=function(e,t,n,s){return this.client.voice(this.name,e,t,n,s)},i.prototype.mute=function(e,t,n,s){return this.client.mute(this.name,e,t,n,s)},i.prototype.op=function(e,t,n,s){return this.client.op(this.name,e,t,n,s)},i.prototype.deop=function(e,t,n,s){return this.client.deop(this.name,e,t,n,s)},i.prototype.modifyAffiliation=function(e,t,n,s,r){return this.client.modifyAffiliation(this.name,e,t,n,s,r)},i.prototype.ban=function(e,t,n,s){return this.client.ban(this.name,e,t,n,s)},i.prototype.member=function(e,t,n,s){return this.client.member(this.name,e,t,n,s)},i.prototype.revoke=function(e,t,n,s){return this.client.revoke(this.name,e,t,n,s)},i.prototype.owner=function(e,t,n,s){return this.client.owner(this.name,e,t,n,s)},i.prototype.admin=function(e,t,n,s){return this.client.admin(this.name,e,t,n,s)},i.prototype.changeNick=function(e){return this.nick=e,this.client.changeNick(this.name,nick)},i.prototype.setStatus=function(e,t){return this.client.setStatus(this.name,this.nick,e,t)},i.prototype.addHandler=function(e,t){var n;switch(n=this._handler_ids++,e){case"presence":this._presence_handlers[n]=t;break;case"message":this._message_handlers[n]=t;break;case"roster":this._roster_handlers[n]=t;break;default:return this._handler_ids--,null}return n},i.prototype.removeHandler=function(e){return delete this._presence_handlers[e],delete this._message_handlers[e],delete this._roster_handlers[e]},i.prototype._addOccupant=function(e){var t;return t=new n(e,this),this.roster[t.nick]=t},i.prototype._roomRosterHandler=function(e){var t,n,s,r,o;switch(t=i._parsePresence(e),r=t.nick,s=t.newnick||null,t.type){case"error":return!0;case"unavailable":s&&(t.nick=s,this.roster[r]&&this.roster[s]&&(this.roster[r].update(this.roster[s]),this.roster[s]=this.roster[r]),this.roster[r]&&!this.roster[s]&&(this.roster[s]=this.roster[r].update(t))),delete this.roster[r];break;default:this.roster[r]?this.roster[r].update(t):this._addOccupant(t)}for(n in o=this._roster_handlers)(0,o[n])(this.roster,this)||delete this._roster_handlers[n];return!0},i._parsePresence=function(e){var t,n,s,r,o,i,a,u,c,d;for((s={}).nick=h.Strophe.getResourceFromJid(e.getAttribute("from")),s.type=e.getAttribute("type"),s.states=[],u=e.childNodes,r=0,i=u.length;r<i;r++)switch((t=u[r]).nodeName){case"error":s.errorcode=t.getAttribute("code"),s.error=null!=(c=t.childNodes[0])?c.nodeName:void 0;break;case"status":s.status=t.textContent||null;break;case"show":s.show=t.textContent||null;break;case"x":if(t.getAttribute("xmlns")===h.Strophe.NS.MUC_USER)for(d=t.childNodes,o=0,a=d.length;o<a;o++)switch((n=d[o]).nodeName){case"item":s.affiliation=n.getAttribute("affiliation"),s.role=n.getAttribute("role"),s.jid=n.getAttribute("jid"),s.newnick=n.getAttribute("nick");break;case"status":n.getAttribute("code")&&s.states.push(n.getAttribute("code"))}}return s},i}(),function(){function e(e){this.parse=r(this.parse,this),null!=e&&this.parse(e)}e.prototype.parse=function(e){var t,n,s,r,o,i,a,u,c,d,l,h,p;for(h=e.getElementsByTagName("query")[0].childNodes,this.identities=[],this.features=[],this.x=[],o=0,c=h.length;o<c;o++)switch(s=h[o],n=s.attributes,s.nodeName){case"identity":for(i={},a=0,d=n.length;a<d;a++)t=n[a],i[t.name]=t.textContent;this.identities.push(i);break;case"feature":this.features.push(s.getAttribute("var"));break;case"x":if("FORM_TYPE"===!s.childNodes[0].getAttribute("var")||"hidden"===!s.childNodes[0].getAttribute("type"))break;for(p=s.childNodes,u=0,l=p.length;u<l;u++)(r=p[u]).attributes.type||this.x.push({var:r.getAttribute("var"),label:r.getAttribute("label")||"",value:r.firstChild.textContent||""})}return{identities:this.identities,features:this.features,x:this.x}}}(),n=function(){function e(e,t){this.room=t,this.update=r(this.update,this),this.admin=r(this.admin,this),this.owner=r(this.owner,this),this.revoke=r(this.revoke,this),this.member=r(this.member,this),this.ban=r(this.ban,this),this.modifyAffiliation=r(this.modifyAffiliation,this),this.deop=r(this.deop,this),this.op=r(this.op,this),this.mute=r(this.mute,this),this.voice=r(this.voice,this),this.kick=r(this.kick,this),this.modifyRole=r(this.modifyRole,this),this.update(e)}return e.prototype.modifyRole=function(e,t,n,s){return this.room.modifyRole(this.nick,e,t,n,s)},e.prototype.kick=function(e,t,n){return this.room.kick(this.nick,e,t,n)},e.prototype.voice=function(e,t,n){return this.room.voice(this.nick,e,t,n)},e.prototype.mute=function(e,t,n){return this.room.mute(this.nick,e,t,n)},e.prototype.op=function(e,t,n){return this.room.op(this.nick,e,t,n)},e.prototype.deop=function(e,t,n){return this.room.deop(this.nick,e,t,n)},e.prototype.modifyAffiliation=function(e,t,n,s){return this.room.modifyAffiliation(this.jid,e,t,n,s)},e.prototype.ban=function(e,t,n){return this.room.ban(this.jid,e,t,n)},e.prototype.member=function(e,t,n){return this.room.member(this.jid,e,t,n)},e.prototype.revoke=function(e,t,n){return this.room.revoke(this.jid,e,t,n)},e.prototype.owner=function(e,t,n){return this.room.owner(this.jid,e,t,n)},e.prototype.admin=function(e,t,n){return this.room.admin(this.jid,e,t,n)},e.prototype.update=function(e){return this.nick=e.nick||null,this.affiliation=e.affiliation||null,this.role=e.role||null,this.jid=e.jid||null,this.status=e.status||null,this.show=e.show||null,this},e}()}(n(10))},function(e,t,n){var s,r;s=[n(10)],void 0===(r=function(e){var r,o,i;return r=e.Strophe,e.$build,o=e.$iq,e.$msg,e.$pres,i=function(e,t,n){var s=o(t?{type:e,to:t}:{type:e});return s.c("vCard",{xmlns:r.NS.VCARD}),n&&s.cnode(n),s},r.addConnectionPlugin("vcard",{_connection:null,init:function(e){return this._connection=e,r.addNamespace("VCARD","vcard-temp")},get:function(e,t,n){var s=i("get",t);return this._connection.sendIQ(s,e,n)},set:function(e,t,n,s){var r=i("set",n,t);return this._connection.sendIQ(r,e,s)}}),e}.apply(t,s))||(e.exports=r)},function(e,t,n){"use strict";t.__esModule=!0;var s=n(3),r=n(0),o=n(8),i=function(){function e(){}return e.transformVCard=function(e){var t={};return t[r.UserConstants.NAME]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.NAME)[0])),t[r.UserConstants.UID]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.UID)[0])),t[r.UserConstants.AVATAR]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.AVATAR)[0])),t[r.UserConstants.LINK]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.LINK)[0])),t[r.UserConstants.STATUS]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.STATUS)[0])),t[r.UserConstants.LAST_ACTIVE_AT]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.LAST_ACTIVE_AT)[0])),t[r.UserConstants.ROLE]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.ROLE)[0])),t[r.UserConstants.USER_NAME]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.USER_NAME)[0])),new s.User(t)},e}();t.VCardController=i},function(e,t,n){"use strict";t.__esModule=!0;var s=n(33),r=n(3),o=n(0),i=n(1),a=function(){function e(){}return e.trasformJSONGroupMember=function(t){var e,n;try{return e=new s.GroupMember(t[o.GroupMemersConstans.KEYS.UID]),n=new r.User({uid:t[o.GroupMemersConstans.KEYS.UID]}),Object.assign(e,t),Object.assign(n,t[o.GroupMemersConstans.KEYS.USER]),e.setUser(n),e}catch(e){return i.Logger.error("GroupMembersController:trasformJSONGroupMember",{e:e,groupMember:t}),t}},e}();t.GroupMembersController=a},function(e,t,n){"use strict";t.__esModule=!0;var s=n(18),a=n(1),u=n(4),c=n(5),o=n(3),d=n(7),l=n(10),r=n(6),h=n(20),p=n(19),f=n(11),g=n(9),E=n(23),_=n(0),C=n(16),S=n(24),m=n(25),T=n(14),A=n(17),I=n(21),y=n(26),R=n(15),M=n(49),v=n(31),N=n(32),O=n(34),P=n(35),L=d.XMPPConnectionHelper.getInstance(),i=function(){function i(e){"undefined"!=typeof document||"undefined"!=typeof navigator&&navigator.product,i.appId=e,i.messagesStore=g.MessagesStore.getInstance(),i.localStorage=r.LocalStorage.getInstance(),i.userStore=m.UserStore.getInstance()}return i.setAuthToken=function(e){i.authToken=e},i.prototype.getAuthToken=function(){return i.authToken},i.getAppId=function(){return i.appId},i.prototype.getApiKey=function(){return i.apiKey},i.init=function(e,t){void 0===e&&(e=""),"object"==typeof e&&e.hasOwnProperty("appId")&&(e=e.appId),a.isFalsy(e)?t&&t(void 0,new u.CometChatException(y.INIT_ERROR.NO_APP_ID)):this.getInstance(e),t&&t()},i.getInstance=function(e,t){return this.cometChat||(this.cometChat=new i(e)),this.cometChat},i.login=function(){for(var n,s=this,r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if("object"==typeof r[0]){var t=r[0];r[0].hasOwnProperty("authToken")?(r[0]=t.authToken,r[1]?r[1]=r[1]:r[1]=void 0):r[0].hasOwnProperty("username")&&r[0].hasOwnProperty("apiKey")&&(r[1]?r[2]=r[1]:r[2]=void 0,r[0]=t.username,r[1]=t.apiKey)}3==r.length?(n=r[2],(a.isFalsy(r[0])||a.isFalsy(r[1]))&&n&&n(void 0,new u.CometChatException(y.ERRORS.PARAMETER_MISSING))):2==r.length?(n=r[1],a.isFalsy(r[0])&&n(void 0,new u.CometChatException(y.ERRORS.PARAMETER_MISSING))):n(void 0,new u.CometChatException(y.ERRORS.PARAMETER_MISSING)),a.isFalsy(this.getAppId())?n(void 0,new u.CometChatException(y.LOGIN_ERROR.NOT_INITIALIZED)):i.localStorage.get("user").then(function(t){if(3!=r.length)return i.authToken=r[0],i.isSecure=!0,s.getLoggedinUser().then(function(e){null!=t&&t.uid!==e.uid?i.messagesStore.clearStore().then(function(){i.userStore.clearStore().then(function(){i.localStorage.clearStore().then(function(){(i.user=new o.Me(e)).setAuthToken(r[0]),i.setAuthToken(r[0]),i.XMPPLogin(i.user,n)})})}):(s.user=new o.Me(e),s.user.setAuthToken(r[0]),s.setAuthToken(r[0]),s.XMPPLogin(s.user,n))},function(e){n(void 0,new u.CometChatException(e.error))});i.isSecure=!1,i.apiKey=r[1];var e=r[0];null!=t&&t.uid!==r[0]?s.messagesStore.clearStore().then(function(){i.userStore.clearStore().then(function(){i.localStorage.clearStore().then(function(){i.generateAuthToken(e).then(function(e){i.user=new o.Me(e),i.setAuthToken(i.user.getAuthToken()),i.getLoggedinUser().then(function(e){(i.user=new o.Me(e)).setAuthToken(i.authToken),i.setAuthToken(i.user.getAuthToken()),i.XMPPLogin(i.user,n)},function(e){n(void 0,new u.CometChatException(e.error))})},function(e){n(void 0,new u.CometChatException(e))})})})}):a.isFalsy(i.authToken)?a.isFalsy(e)||(a.isFalsy(i.apiKey)?n(void 0,new u.CometChatException(y.LOGIN_ERROR.UNAUTHORISED)):s.generateAuthToken(e).then(function(e){s.user=new o.Me(e),s.setAuthToken(i.user.getAuthToken()),s.getLoggedinUser().then(function(e){s.user=new o.Me(e),s.user.setAuthToken(i.authToken),s.setAuthToken(s.user.getAuthToken()),s.XMPPLogin(s.user,n)},function(e){n(void 0,new u.CometChatException(e.error))})},function(e){n(void 0,new u.CometChatException(e))})):s.XMPPLogin(s.user,n)})},i.sendMessage=function(e){var s=this;if(!(e instanceof p.TextMessage||e instanceof h.MediaMessage))if(e[_.MessageConstatnts.KEYS.ATTATCHMENT]){var t=_.MessageConstatnts.TYPE.FILE;a.isImage(e[_.MessageConstatnts.KEYS.ATTATCHMENT])?t=_.MessageConstatnts.TYPE.IMAGE:a.isAudio(e[_.MessageConstatnts.KEYS.ATTATCHMENT])?t=_.MessageConstatnts.TYPE.AUDIO:a.isVideo(e[_.MessageConstatnts.KEYS.ATTATCHMENT])&&(t=_.MessageConstatnts.TYPE.VIDEO),e=new h.MediaMessage(e[_.MessageConstatnts.KEYS.RECEIVER],e[_.MessageConstatnts.KEYS.ATTATCHMENT],t,e[_.MessageConstatnts.KEYS.RECEIVER_TYPE])}else e=new p.TextMessage(e[_.MessageConstatnts.KEYS.RECEIVER],e[_.MessageConstatnts.KEYS.TEXT],_.MessageConstatnts.TYPE.TEXT,e[_.MessageConstatnts.KEYS.RECEIVER_TYPE]);return new Promise(function(t,n){return c.makeApiCall("sendMessage",{},e,e instanceof h.MediaMessage).then(function(e){s.messagesStore.storeMessages([f.MessageController.trasformJSONMessge(e.data)]),t(f.MessageController.trasformJSONMessge(e.data))},function(e){n(new u.CometChatException(e.error))})})},i.sendDirectMessage=function(e){return Object.assign(e,{receiverType:_.MessageConstatnts.RECEIVER_TYPE.USER}),this.sendMessage(e)},i.sendGroupMessage=function(e){return Object.assign(e,{receiverType:_.MessageConstatnts.RECEIVER_TYPE.GROUP}),this.sendMessage(e)},i.sendMediaMessage=function(e){return this.sendMessage(e)},i.startTyping=function(s,r,o){return void 0===r&&(r=this.RECEIVER_TYPE.USER),new Promise(function(t,n){a.isFalsy(s)&&n(new u.CometChatException(y.ERRORS.PARAMETER_MISSING)),a.getAppSettings().then(function(e){switch(r){case _.XMPP.CONVERSATION.TYPE.CHAT:L.sendTypingStarted(a.format(_.XMPP.bare_jid_string,i.getAppId(),s,e[_.APP_SETTINGS.KEYS.CHAT_HOST]),r,o);break;case _.XMPP.CONVERSATION.TYPE.GROUP_CHAT:L.sendTypingStarted(a.format(_.XMPP.muc_jid_string,i.getAppId(),s,e[_.APP_SETTINGS.KEYS.GROUP_SERVICE],e[_.APP_SETTINGS.KEYS.CHAT_HOST]),r,o)}t(!0)},function(e){n(e)})})},i.endTyping=function(t,n){a.getAppSettings().then(function(e){switch(n){case _.XMPP.CONVERSATION.TYPE.CHAT:L.sendTypingPaused(a.format(_.XMPP.bare_jid_string,i.getAppId(),t,e[_.APP_SETTINGS.KEYS.CHAT_HOST]),n);break;case _.XMPP.CONVERSATION.TYPE.GROUP_CHAT:L.sendTypingPaused(a.format(_.XMPP.muc_jid_string,i.getAppId(),t,e[_.APP_SETTINGS.KEYS.GROUP_SERVICE],e[_.APP_SETTINGS.KEYS.CHAT_HOST]),n)}},function(e){a.Logger.error("sendIsTyping",e)})},i.getPreviousMessagesByTimestamp=function(e,s){return new Promise(function(t,n){a.isFalsy(s)?n(new u.CometChatException(JSON.parse(a.format(JSON.stringify(_.PARAMETER_ERROR.PARAMETER_REQUIRED),"TIMESTAMP","TIMESTAMP","timestamp")))):f.MessageController.getAllMessage(e,s,_.MessageConstatnts.PAGINATION.CURSOR_FILEDS.SENT_AT,_.MessageConstatnts.PAGINATION.AFFIX.PREPEND).then(function(e){return t(e)},function(e){return n(e)})})},i.getPreviousMessagesById=function(e,s){return new Promise(function(t,n){a.isFalsy(s)?n(new u.CometChatException(JSON.parse(a.format(JSON.stringify(_.PARAMETER_ERROR.PARAMETER_REQUIRED),"ID","ID","id")))):f.MessageController.getAllMessage(e,s,_.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,_.MessageConstatnts.PAGINATION.AFFIX.PREPEND).then(function(e){return t(e)},function(e){return n(e)})})},i.getNextMessagesByTimestamp=function(e,s){return new Promise(function(t,n){a.isFalsy(s)?n(new u.CometChatException(JSON.parse(a.format(JSON.stringify(_.PARAMETER_ERROR.PARAMETER_REQUIRED),"TIMESTAMP","TIMESTAMP","timestamp")))):f.MessageController.getAllMessage(e,s,_.MessageConstatnts.PAGINATION.CURSOR_FILEDS.SENT_AT,_.MessageConstatnts.PAGINATION.AFFIX.APPEND).then(function(e){return t(e)},function(e){return n(e)})})},i.getNextMessagesById=function(e,s){return new Promise(function(t,n){a.isFalsy(s)?n(new u.CometChatException(JSON.parse(a.format(JSON.stringify(_.PARAMETER_ERROR.PARAMETER_REQUIRED),"ID","ID","id")))):f.MessageController.getAllMessage(e,s,_.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,_.MessageConstatnts.PAGINATION.AFFIX.APPEND).then(function(e){return t(e)},function(e){return n(e)})})},i.getUser=function(e){return new Promise(function(r,t){"object"==typeof e&&e.hasOwnProperty("uid")&&(e=e.uid),c.makeApiCall("user",{uid:e}).then(function(e){var s=E.UsersController.trasformJSONUser(e.data),t=[];t.push(a.format(_.XMPP.username_string,i.getAppId(),e.data[_.UserConstants.UID])),d.XMPPConnectionHelper.getInstance().getPresenceInfo(t,function(n){t.map(function(e,t){s.setLastActiveAt(n[t].getLastActiveAt()),s.setStatus(n[t].getStatus()),r(s)})})}).catch(function(e){t(new u.CometChatException(e.error))})})},i.getLoggedinUser=function(){return new Promise(function(t,n){c.makeApiCall("getMyDetails").then(function(e){t(e.data)}).catch(function(e){n(e)})})},i.createGroup=function(s){return new Promise(function(t,n){if(!(s instanceof C.Group)){var e=void 0;if(!s.hasOwnProperty(_.GroupConstants.KEYS.GUID))return void n(new u.CometChatException(y.ERRORS.PARAMETER_MISSING));if(!s.hasOwnProperty(_.GroupConstants.KEYS.NAME))return void n(new u.CometChatException(y.ERRORS.PARAMETER_MISSING));if(e=new C.Group(s[_.GroupConstants.KEYS.GUID],s[_.GroupConstants.KEYS.NAME],""),s.hasOwnProperty(_.GroupConstants.KEYS.TYPE))if(s[_.GroupConstants.KEYS.TYPE].toLocaleLowerCase()==_.GroupType.Password){if(!s.hasOwnProperty(_.GroupConstants.KEYS.PASSWORD))return void n(new u.CometChatException(y.GROUP_CREATION_ERRORS.EMPTY_PASSWORD));e.setType(_.GROUP_TYPE.PASSWORD),e.setPassword(s[_.GroupConstants.KEYS.PASSWORD])}else e.setType(s[_.GroupConstants.KEYS.TYPE]);else e.setType(_.GROUP_TYPE.PUBLIC);s.hasOwnProperty(_.GroupConstants.KEYS.ICON)&&e.setIcon(s[_.GroupConstants.KEYS.ICON]),s.hasOwnProperty(_.GroupConstants.KEYS.DESCRIPTION)&&e.setDescription(s[_.GroupConstants.KEYS.DESCRIPTION]),s=e}c.makeApiCall("createGroup",{},s).then(function(e){L.joinMuc(s),t(S.GroupsController.trasformJSONGroup(e.data))},function(e){n(new u.CometChatException(e.error))})})},i.getGroup=function(e){return"object"==typeof e&&e.hasOwnProperty("guid")&&(e=e.guid),new Promise(function(t,n){c.makeApiCall("getGroup",{guid:e}).then(function(e){t(S.GroupsController.trasformJSONGroup(e.data))},function(e){n(new u.CometChatException(e.error))})})},i.joinGroup=function(e,r,o){return void 0===r&&(r=_.GroupType.Public),void 0===o&&(o=""),new Promise(function(t,n){var s;"object"==typeof e&&(e.hasOwnProperty(_.GroupConstants.KEYS.GUID)?(e.hasOwnProperty(_.GroupConstants.KEYS.TYPE)&&(r=e[_.GroupConstants.KEYS.TYPE],e[_.GroupConstants.KEYS.TYPE].toLocaleLowerCase()===_.GroupType.Password&&e.hasOwnProperty(_.GroupConstants.KEYS.PASSWORD)&&(o=e[_.GroupConstants.KEYS.PASSWORD])),e=e[_.GroupConstants.KEYS.GUID]):n(new u.CometChatException(y.ERRORS.PARAMETER_MISSING))),s=a.isFalsy(o)?new C.Group(e,"name",r):new C.Group(e,"name",r,o),c.makeApiCall("joinGroup",s,s).then(function(e){L.joinMuc(s),t(S.GroupsController.trasformJSONGroup(e.data[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA][_.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][_.ActionConstatnts.ACTION_KEYS.ENTITY]))},function(e){n(new u.CometChatException(e.error))})})},i.updateGroup=function(s){return new Promise(function(t,n){if(!(s instanceof C.Group)){var e=void 0;if(!s.hasOwnProperty(_.GroupConstants.KEYS.GUID))return void n(new u.CometChatException(y.ERRORS.PARAMETER_MISSING));e=new C.Group(_.GroupConstants.KEYS.GUID,"",""),s.hasOwnProperty(_.GroupConstants.KEYS.TYPE)?e.setType(s[_.GroupConstants.KEYS.TYPE]):(s[_.GroupConstants.KEYS.TYPE]=_.GROUP_TYPE.PUBLIC,e.setType[_.GROUP_TYPE.PUBLIC]),s.hasOwnProperty(_.GroupConstants.KEYS.NAME)&&e.setName(s[_.GroupConstants.KEYS.NAME]),s.hasOwnProperty(_.GroupConstants.KEYS.ICON)&&e.setIcon(s[_.GroupConstants.KEYS.ICON]),s.hasOwnProperty(_.GroupConstants.KEYS.DESCRIPTION)&&e.setDescription(s[_.GroupConstants.KEYS.DESCRIPTION]),s=e}c.makeApiCall("updateGroup",s,s).then(function(e){t(S.GroupsController.trasformJSONGroup(e.data))},function(e){n(new u.CometChatException(e.error))})})},i.deleteGroup=function(e){return new Promise(function(t,n){c.makeApiCall("deleteGroup",{guid:e}).then(function(e){t(!0)},function(e){n(new u.CometChatException(e.error))})})},i.leaveGroup=function(s){return new Promise(function(t,n){c.makeApiCall("leaveGroup",{guid:s}).then(function(e){L.leaveMuc(s),g.MessagesStore.getInstance().storeMessages([f.MessageController.trasformJSONMessge(e.data)]),t(!0)},function(e){n(new u.CometChatException(e.error))})})},i.kickGroupMember=function(e,s){return new Promise(function(t,n){c.makeApiCall("kickGroupMembers",{guid:e,uid:s}).then(function(e){g.MessagesStore.getInstance().storeMessages([f.MessageController.trasformJSONMessge(e.data)]),t(!0)},function(e){n(new u.CometChatException(e.error))})})},i.updateGroupMemberScope=function(e,s,r){return new Promise(function(t,n){c.makeApiCall("changeScopeOfMember",{guid:e,uid:s},{scope:r}).then(function(e){g.MessagesStore.getInstance().storeMessages([f.MessageController.trasformJSONMessge(e.data)]),t(!0)},function(e){n(new u.CometChatException(e.error))})})},i.banGroupMember=function(e,s){return new Promise(function(t,n){c.makeApiCall("banGroupMember",{guid:e,uid:s}).then(function(e){g.MessagesStore.getInstance().storeMessages([f.MessageController.trasformJSONMessge(e.data)]),t(!0)},function(e){n(new u.CometChatException(e.error))})})},i.unbanGroupMember=function(e,s){return new Promise(function(t,n){c.makeApiCall("unbanGroupMember",{guid:e,uid:s}).then(function(e){g.MessagesStore.getInstance().storeMessages([f.MessageController.trasformJSONMessge(e.data)]),t(!0)},function(e){n(new u.CometChatException(e.error))})})},i.initiateCall=function(t){return new Promise(function(n,s){a.isFalsy(JSON.parse(JSON.stringify(t)).sender)?a.isFalsy(I.CallController.getInstance().getActiveCall())?(t.setStatus(_.CallConstants.CALL_STATUS.INITIATED),c.makeApiCall("createCallSession",{},t).then(function(t){var e=A.Call.callFromJSON(t[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);I.CallController.getInstance().initiateCall(e).then(function(e){g.MessagesStore.getInstance().storeMessages([e]),n(Object.assign(e,t[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))}).catch(function(e){s(e)})},function(e){s(new u.CometChatException(e.error))})):s(new u.CometChatException(_.CALL_ERROR.ERROR_IN_CALLING)):I.CallController.getInstance().initiateCall(t).then(function(e){n(Object.assign(t))}).catch(function(e){s(e)})})},i.acceptCall=function(s){return new Promise(function(n,t){var e={};e[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.ONGOING,c.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);I.CallController.getInstance().onCallStarted(Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA])),g.MessagesStore.getInstance().storeMessages([Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA])]),n(Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},function(e){t(new u.CometChatException(e.error))})})},i.rejectCall=function(e,t){switch(t){case _.CallConstants.CALL_STATUS.REJECTED:return this.rejectIncomingCall(e);case _.CallConstants.CALL_STATUS.CANCELLED:return this.cancelCall(e);case _.CallConstants.CALL_STATUS.BUSY:return this.sendBusyResponse(e);default:a.Logger.log("Default case",t)}},i.endCall=function(s){return new Promise(function(n,e){var t={};t[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.ENDED,c.makeApiCall("usudo pdateCallSession",{sessionid:s},t).then(function(e){a.Logger.log("calling Log",{response:e});var t=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);g.MessagesStore.getInstance().storeMessages([Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA])]),I.CallController.getInstance().endCall(),n(Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},function(e){a.Logger.log("calling Log",{error:e});var t=I.CallController.getInstance().getActiveCall();t.setStatus(_.CallConstants.CALL_STATUS.ENDED),g.MessagesStore.getInstance().storeMessages(t),n(t),I.CallController.getInstance().endCall()})})},i.getActiveCall=function(){return I.CallController.getInstance().getActiveCall()},i.startCall=function(e,t,n){I.CallController.getInstance().startCall(t,n)},i.rejectIncomingCall=function(s){return new Promise(function(n,t){var e={};e[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.REJECTED,c.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);g.MessagesStore.getInstance().storeMessages([Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA])]),n(Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},function(e){t(new u.CometChatException(e.error))})})},i.cancelCall=function(s){return new Promise(function(n,t){var e={};e[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.CANCELLED,c.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);g.MessagesStore.getInstance().storeMessages([Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA])]),I.CallController.getInstance().endCallSession(),n(Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},function(e){t(new u.CometChatException(e.error))})})},i.sendBusyResponse=function(s){return new Promise(function(n,t){var e={};e[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.BUSY,c.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);g.MessagesStore.getInstance().storeMessages([Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA])]),n(Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},function(e){t(new u.CometChatException(e.error))})})},i.sendUnansweredResponse=function(s){return new Promise(function(n,t){var e={};e[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.UNANSWERED,c.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);d.XMPPConnectionHelper.getInstance().trigerMessageHandler(Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA])),g.MessagesStore.getInstance().storeMessages([Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA])]),n(Object.assign(t,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},function(e){t(new u.CometChatException(e.error))})})},i.addMessageListener=function(e,t){L.addMessageEventListener(e,t)},i.removeMessageListener=function(e){L.removeMessageEventListener(e)},i.addCallListener=function(e,t){L.addCallEventListener(e,t)},i.removeCallListener=function(e){L.removeCallEventListener(e)},i.addUserListener=function(e,t){L.addUserEventListener(e,t)},i.removeUserListener=function(e){L.removeUserEventListener(e)},i.addGroupListener=function(e,t){L.addGroupEventListener(e,t)},i.removeGroupListener=function(e){L.removeGroupEventListener(e)},i.generateAuthToken=function(e){return new Promise(function(t,n){c.makeApiCall("authToken",{uid:e}).then(function(e){t(e.data)}).catch(function(e){e.hasOwnProperty("error")?n(new u.CometChatException(e.error)):n(new u.CometChatException(e))})})},i.XMPPLogin=function(t,n){var s=this,r=!0;L.XMMPLogin(t.getUid(),t.getWsChannel().secret,function(e){switch(e){case l.Strophe.Status.CONNFAIL:return n(void 0,new u.CometChatException(y.LOGIN_ERROR.XMPP_CONNECTION_FAIL)),s.getAppSettings().then(function(e){});case l.Strophe.Status.CONNECTED:s.localStorage.set("user",t),n(new o.User(t));break;case l.Strophe.Status.DISCONNECTED:r&&s.XMPPLogin(t,n);break;case l.Strophe.Status.DISCONNECTING:r=!1,a.Logger.info("Connection","Disconnecting");break;case l.Strophe.Status.AUTHFAIL:n(void 0,new u.CometChatException(y.LOGIN_ERROR.XMPP_CONNECTION_FAIL))}})},i.getAppSettings=function(){return new Promise(function(t,n){c.makeApiCall("appSettings").then(function(e){r.LocalStorage.getInstance().set("app_settings",e.data),t(e.data)},function(e){n(new u.CometChatException(e.error))})})},i.logout=function(){var s=this;return new Promise(function(t,n){c.makeApiCall("userLogout").then(function(e){d.XMPPConnectionHelper.getInstance().XMPPDisconnect(),s.clearCache(),s.apiKey=void 0,s.user=void 0,s.authToken=void 0,t(e.data)},function(e){n(new u.CometChatException(e.error))})})},i.clearCache=function(){this.messagesStore.clearStore(),this.userStore.clearStore(),this.localStorage.clearStore()},i.TextMessage=p.TextMessage,i.MediaMessage=h.MediaMessage,i.Action=R.Action,i.Call=A.Call,i.Group=C.Group,i.AppUser=o.User,i.UserMessagesRequest=M.MessagesRequest,i.UserMessagesRequestBuilder=M.DefaultMessagesRequestBuilder,i.GroupMessagesRequest=M.MessagesRequest,i.GroupMessagesRequestBuilder=M.DefaultGroupMessagesRequestBuilder,i.MessagesRequest=M.MessagesRequest,i.MessagesRequestBuilder=M.DefaultMessagesRequestBuilder,i.DMessagesRequest=P.DefaultMessagesRequest,i.DMessagesRequestBuilder=P.DefaultMessagesRequestBuilder,i.UsersRequest=O.UsersRequest,i.UsersRequestBuilder=O.UsersRequestBuilder,i.GroupsRequest=v.GroupsRequest,i.GroupsRequestBuilder=v.GroupsRequestBuilder,i.GroupMembersRequest=N.GroupMembersRequest,i.GroupMembersRequestBuilder=N.GroupMembersRequestBuilder,i.BannedMembersRequest=N.GroupMembersRequest,i.BannedMembersRequestBuilder=N.GroupOutCastMembersRequestBuilder,i.MessageListener=T.MessageEventListener,i.UserListener=T.UserEventListener,i.GroupListener=T.GroupEventListener,i.OngoingCallListener=T.UserCallEventListener,i.CallListener=T.CallEventListener,i.MESSAGE_TYPE=_.MessageConstatnts.TYPE,i.CATEGORY_MESSAGE=_.MessageConstatnts.CATEGORY.MESSAGE,i.CATEGORY_ACTION=_.MessageConstatnts.CATEGORY.ACTION,i.CATEGORY_CALL=_.MessageConstatnts.CATEGORY.CALL,i.ACTION_TYPE=_.ActionConstatnts.ACTIONS,i.CALL_TYPE=_.CallConstants.CALL_TYPE,i.RECEIVER_TYPE=_.MessageConstatnts.RECEIVER_TYPE,i.CALL_STATUS=_.CallConstants.CALL_STATUS,i.CallController=I.CallController,i.GROUP_MEMBER_SCOPE=_.GROUP_MEMBER_SCOPE,i.GROUP_TYPE=_.GROUP_TYPE,i.MESSAGE_REQUEST=_.MessageConstatnts.PAGINATION.CURSOR_FILEDS,i.isCall=!1,i.endpointFactory=new s.EndpointFactory,i}();t.CometChat=i},function(e,t,n){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var d=n(5),l=n(11),r=n(1),i=n(9),a=n(0),u=function(){function t(e){this.fetchingInProgress=!1,this.limit=t.DEFAULT_LIMIT,this.cursorValue=0,this.cursorAffix=a.MessageConstatnts.PAGINATION.CURSOR_AFFIX_DEFAULT,this.cursorField=a.MessageConstatnts.PAGINATION.CURSOR_FIELD_DEFAULT,this.isGroupRequest=!1,this.messageStore=i.MessagesStore.getInstance(),r.isFalsy(e)||(this.limit=e.limit,this.listId=e.listId,this.cursorField=e.cursorField,this.cursorValue=e.cursorValue,this.isGroupRequest=e.isGroupRequest)}return t.prototype.fetchPrevious=function(){var c=this;return new Promise(function(a,u){c.fetchingInProgress?(c.fetchingInProgress=!0,u([])):c.messageStore.get(c.listId).then(function(t){c.fetchingInProgress=!0;var e=[];if(0==c.cursorValue)try{c.cursorValue=Math.max.apply(Math,Object.keys(t))+1}catch(e){c.cursorValue=1}t&&(e=Object.keys(t).filter(function(e){if(parseInt(t[e][c.cursorField])<c.cursorValue)return e}));var n=0,s=[];if(e.reverse().map(function(e){n++,parseInt(c.cursorValue.toString())>=parseInt(t[e][c.cursorField])&&n<=c.limit&&(c.cursorValue=t[e][c.cursorField],c.updateCursor(c.cursorValue),s=s.concat([l.MessageController.trasformJSONMessge(t[e])]))}).length<=c.limit){var r=[],o="getUserMessages",i={listId:c.listId};return c.isGroupRequest&&(o="getGroupMessages"),d.makeApiCall(o,i,c.createData()).then(function(e){0<e.data.length?(e.data.map(function(e){c.updateCursor(e[c.cursorField]),r.push(l.MessageController.trasformJSONMessge(e))}),c.messageStore.storeMessages(r),a(s.concat(r).reverse())):0<s.length?a(s.slice().reverse()):a([]),c.fetchingInProgress=!1},function(e){u(e),c.fetchingInProgress=!1})}a(s.slice().reverse()),c.fetchingInProgress=!1})})},t.prototype.createData=function(){var e={};return e[a.MessageConstatnts.PAGINATION.KEYS.PER_PAGE]=this.limit,e[a.MessageConstatnts.PAGINATION.KEYS.CURSOR_AFFIX]=this.cursorAffix,e[a.MessageConstatnts.PAGINATION.KEYS.CURSOR_FIELD]=this.cursorField,e[a.MessageConstatnts.PAGINATION.KEYS.CURSOR_VALUE]=this.cursorValue,e},t.prototype.updateCursor=function(e){(this.cursorValue>e||0==this.cursorValue)&&(this.cursorValue=e)},t.MAX_LIMIT=1,t.DEFAULT_LIMIT=1,t}();t.MessagesRequest=u;var c=function(){function e(e,t,n){this.isGroupRequest=!1,this.cursorField=n,this.cursorValue=t,this.listId=e}return e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setSearchKeyWord=function(e){return this.searchKeyWord=e,this},e.prototype.build=function(){return new u(this)},e}(),h=function(t){function e(){var e=t.call(this)||this;return e.isGroupRequest=!1,e.limit=30,e.cursorField=a.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,e.cursorValue=0,e}return o(e,t),e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setGUID=function(e){return this.isGroupRequest=!0,this.listId=e,this},e.prototype.setUID=function(e){return this.isGroupRequest=!1,this.listId=e,this},e.prototype.setSearchKeyWord=function(e){return this.searchKeyWord=e,this},e.prototype.build=function(){return new u(this)},e}(t.MessagesRequestBuilder=c);t.DefaultMessagesRequestBuilder=h;var p=function(r){function e(e,t,n){var s=r.call(this,e,t,n)||this;return s.isGroupRequest=!0,s.isGroupRequest=!0,s}return o(e,r),e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.build=function(){return new u(this)},e}(c);t.GroupMessagesRequestBuilder=p;var f=function(n){function e(e){var t=n.call(this)||this;return t.isGroupRequest=!0,t.isGroupRequest=!0,t}return o(e,n),e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.build=function(){return new u(this)},e}(h);t.DefaultGroupMessagesRequestBuilder=f}])});